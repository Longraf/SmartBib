"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kuk__Linq(){for(var e=[],t=1;t<1e6;t++)e.push({ID:t,Name:"er"+t+"geg",Val:2*t});var n=window.performance.now(),r=e.Where(function(e){return e.Val<1e3}).Select(function(e){return e.ID}).Where(function(e){return e%3===0}).FirstOrDefault();console.log("prto",window.performance.now()-n,r),n=window.performance.now();var o=Lure.Linq(e).Where(function(e){return e.Val<1e3}).Select(function(e){return e.ID}).Where(function(e){return e%3===0}).FirstOrDefault();console.log("linq",window.performance.now()-n,o)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Date.prototype.Format=function(e,t){return Lure.Date.Format(this,e,t)},Array.prototype.Select=function(e){for(var t=[],n=0;n<this.length;n++)"string"==typeof e?t.push(this[n][e]):t.push(e(this[n],n));return t},Array.prototype.ToDictionary=function(e,t){for(var n={},r=0;r<this.length;r++)n[e(this[r],r)]=t(this[r],r);return n},Array.prototype.Where=function(e){for(var t=[],n=0;n<this.length;n++)e(this[n],n)&&t.push(this[n]);return t},Array.prototype.FirstOrDefault=function(e){for(var t=0;t<this.length;t++)if(null!==this[t]&&"undefined"!=typeof this[t])return this[t];return"undefined"==typeof e?null:e},Array.prototype.First=function(){return this[0]},Array.prototype.Last=function(){return this[this.length-1]},Array.prototype.ToList=function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e},Array.prototype.Sort=function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++);return this},Array.prototype.GroupBy=function(e){var t=this.reduce(function(t,n){return(t[n[e]]=t[n[e]]||[]).push(n),t},{}),n=[];for(var r in t)t.hasOwnProperty(r)&&(t[r].Key=r,n.push(t[r]));return n},NodeList.prototype.Select=Array.prototype.Select,NodeList.prototype.Where=Array.prototype.Where,NodeList.prototype.ToDictionary=Array.prototype.ToDictionary,NodeList.prototype.ToList=Array.prototype.ToList,HTMLCollection.prototype.Select=Array.prototype.Select,HTMLCollection.prototype.Where=Array.prototype.Where,HTMLCollection.prototype.ToDictionary=Array.prototype.ToDictionary,HTMLCollection.prototype.ToList=Array.prototype.ToList;var Lure=function(){var LureClass=function(){function LureClass(){var _this=this;_classCallCheck(this,LureClass),this.Plugin={Regis5ter:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};return"undefined"!=typeof this[e]&&"Register"===e?this.System.ShowError('[Lure] Plugin name "'+e+'" is not allowed.'):(this.Plugin[e]=t,n?this[e]=this.Plugin[e][n]:this[e]=this.Plugin[e],void r.call(this))}.bind(this)},this.System={Error:function(e,t){Lure.System.ShowError(e),console.error(t?t:e)},Warn:function(e){Lure.System.ShowWarn(e),console.warn(e)},Success:function(e){Lure.System.ShowSuccess(e)},Notice:function(e,t){Lure.System.ShowNotice(e),t&&console.log(t)},ShowError:function(e){Lure.System._ShowError||(Lure.System._ShowError=new Lure.CustomLog),Lure.System._ShowError.AddLine(e)},ShowWarn:function(e){Lure.System._ShowWarn||(Lure.System._ShowWarn=new Lure.CustomLog({Style:{backgroundColor:"darkorange"}})),Lure.System._ShowWarn.AddLine(e)},ShowSuccess:function(e){Lure.System._ShowSuccess||(Lure.System._ShowSuccess=new Lure.CustomLog({Style:{backgroundColor:"#45c971",color:"#fff"}})),Lure.System._ShowSuccess.AddLine(e)},ShowNotice:function(e){Lure.System._ShowNotice||(Lure.System._ShowNotice=new Lure.CustomLog({Style:{backgroundColor:"#00598e",color:"#FFF"}})),Lure.System._ShowNotice.AddLine(e)}},this.Diagnostics={Perf:function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_classCallCheck(this,e),this.Started=performance.now(),this.Stepped=this.Started,this.Enabled=t}return _createClass(e,[{key:"Elapsed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Perf";if(!this.Enabled)return 0;this.Stepped=window.performance.now();var t=(this.Stepped-this.Started).toFixed(2);return console.info("["+e+"]: "+t+"ms"),t}},{key:"Perf",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Perf",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=window.performance.now();if(!this.Enabled)return 0;var r=40-e.length,o=(n-this.Stepped).toFixed(4);return t&&console.info("%c["+e+"]:"+" ".repeat(r>0?r:1)+" "+o+"ms","color: #3583a7"),this.Stepped=window.performance.now(),o}},{key:"Reset",value:function(){return this.Started=performance.now(),this.Stepped=this.Started,0}}]),e}()},this.Controller={TreeBuilder:function(){function e(t){var n=t.Target,r=void 0===n?null:n,o=t.Data,i=void 0===o?[]:o,a=t.ListElement,s=void 0===a?null:a,l=t.Drop,u=void 0!==l&&l,c=t.SubSelector,d=void 0===c?null:c,h=t.SubSelectorHandler,f=void 0===h?function(){}:h,p=t.BeforeBuild,m=void 0===p?function(){}:p,y=t.AfterBuild,g=void 0===y?function(){}:y,v=t.Owner,L=void 0===v?null:v;_classCallCheck(this,e),this.isController=!0,this.Content=Lure.Select(r),this.Target=this.Content,this.Owner=L,this._Data=i,this.SubSelector=d,this.SubSelectorHandler=f.bind(this.Owner?this.Owner:this),this.BeforeBuild=m.bind(this.Owner?this.Owner:this),this.AfterBuild=g.bind(this.Owner?this.Owner:this);var S=u?"mtb-sub_tree dropable":"mtb-sub_tree",C=0,b=null===s?this.Content.innerHTML:s;null===this.SubSelector&&(this.SubSelector=".mtb-sub_tree",b=b.replace(/^([\s\S]*)(<\/\w+>)$/,function(e,t,n){return n='<div class="'+S+'"></div>'+n,t+n})),this.LineBuilder=Lure.Compile(b,!0);var w=this,D=0,T=function N(e,t,n){D++;var r={$lvl:C,$key:t,$index:D,$j:n},o=Lure.CreateElementFromString(w.LineBuilder.call(w.Owner,e,r));o.classList.add("mtb-branch");for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];if(Array.isArray(a)){C++;for(var s=0;s<a.length;s++)if(null===w.SubSelector)o.appendChild(N(a[s],i,s));else{o.classList.add("mtb-has_tree"),u&&o.classList.add("dropable");var l=o.querySelector(w.SubSelector);l.appendChild(N(a[s],i,s))}C--}}return o},_=function(){if(w.BeforeBuild(),Array.isArray(w._Data)){w.Content.innerHTML="",C++;for(var e=0;e<w._Data.length;e++)w.Content.appendChild(T(w._Data[e],"root",0));C--}else w.Content.appendChild(T(w._Data,"root",0));C=0,D=0,w.AfterBuild()};_(this._Data),this.Refresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w._Data;w._Data=e,_()}}return _createClass(e,[{key:"Data",get:function(){return this._Data},set:function(e){this._Data=e}}]),e}()},this.Settings={_Locale:"ru",get Locale(){return this._Locale},set Locale(e){Lure.CultureInfo[e]?(Lure.Culture=Lure.CultureInfo[e],this._Locale=e):Lure.System.ShowError('[SetLocale] Error. Locale "'+e+'" is unknown')},LocaleSort:"en",Controller:{Common:{Undefined:"???"},Templator:{Pagination:{PageSize:-1,DataLength:-1,DataCount:-1,PageGet:null,isGetAllButton:!0,isGetAllCount:!0,isGetMoreButton:!0,isGetMoreCount:!0,isRefreshButton:!0},isDataClone:!1,isEmptyVisible:!0}},Dialog:{Blur:"l-blur",BlurTarget:".body",Wrapper:"l-dialog-wrapper"},Confirm:{Wrapper:"l-dialog-wrapper-transparent"},Common:{CSSButtonBusy:"l-busy"}},this.CultureInfo={en:{Lang:{Change:"Change",Remove:"Remove",GetMore:"Get more",GetAll:"Get all",Refresh:"Refresh",YouHaveNoPermission:"You have no permission",Ok:"Ok",Cancel:"Cancel"},DateFormat:"MM.DD.YYYY",DateFormatFull:"MM.DD.YYYY HH:mm:ss",MonthNames:["January","February","March","April","May","June","Jule","August","September","October","November","December"],MonthNamesBanded:["January","February","March","April","May","June","Jule","August","September","October","November","December"],MonthNamesShort:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],WeekDays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],WeekDaysShort:["mo","tu","we","th","fr","sa","su"]},ru:{Lang:{Change:"Изменить",Remove:"Удалить",GetMore:"Загрузить еще",GetAll:"Загрузить все",Refresh:"Обновить",YouHaveNoPermission:"Недостаточно прав",Ok:"Ок",Cancel:"Отмена"},DateFormat:"DD.MM.YYYY",DateFormatFull:"DD.MM.YYYY HH:mm:ss",MonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],MonthNamesBanded:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],MonthNamesShort:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],WeekDays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],WeekDaysShort:["пн","вт","ср","чт","пт","сб","вс"]}},this.Culture={Lang:{Change:"Изменить",Remove:"Удалить"},DateFormat:"DD.MM.YYYY",DateFormatFull:"DD.MM.YYYY HH:mm:ss",MonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],MonthNamesBanded:["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],MonthNamesShort:["янв.","фев.","мар.","апр.","май","июн.","июл.","авг.","сен.","окт.","ноя.","дек."],WeekDays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],WeekDaysShort:["пн","вт","ср","чт","пт","сб","вс"]},this.ContentList={_Root:[],_Typed:[]},this._Dialog={List:[],Add:function(e){Lure._Dialog.List.indexOf(e)<0&&Lure._Dialog.List.push(e)},Remove:function(e){var t=Lure._Dialog.List.indexOf(e);t>-1&&Lure._Dialog.List.splice(t,1)},get zIndex(){return Lure._Dialog.List.length<1?10:Lure._Dialog.List.Select(function(e){return parseInt(window.getComputedStyle(e).zIndex)}).sort(function(e,t){return e<t}).First()}},this._DialogCount=0,this._ConfirmCount=0,this.PropTypes={GetType:function(e){return Lure.GetType(e)},Check:function(e,t){for(var n in e)Lure.PropTypes.CheckProp(t,e[n],n)},CheckProp:function(e,t,n){Lure.SetProperty(e,n,Lure.PropTypes.TryParse(t,Lure.GetProperty(e,n),n))},TryParse:function(e,t,n){var r=void 0;switch(e){case Lure.PropTypes.Number:return r=parseFloat(t),!Number.isNaN(r)&&Lure.isNumeric(t)||(console.warn("[Lure.PropTypes] "+n+" "+t+" is not a Number"),r=0),r;case Lure.PropTypes.Int:return r=parseInt(t),!Number.isNaN(r)&&Lure.isNumeric(t)||(console.warn("[Lure.PropTypes] "+n+" "+t+" is not Int"),r=0),r;case Lure.PropTypes.UInt:return r=parseInt(t),(Number.isNaN(r)||r<0||!Lure.isNumeric(t))&&(console.warn("[Lure.PropTypes] "+n+" "+t+" is not UInt"),r=0),r;case Lure.PropTypes.Bool:return"true"!==t&&"True"!==t||(t=!0),"false"!==t&&"False"!==t||(t=!1),t!==!0&&t!==!1&&(console.warn("[Lure.PropTypes] "+n+" "+t+" is not Bool"),t=!1),t;case Lure.PropTypes.Date:return Lure.Date(t).Date}return t},Number:"number",Float:"number",Int:"int",UInt:"uint",Bool:"boolean",String:"string",Text:"text",Function:"function",Date:"date",List:"list",Array:"list",NodeList:"list",Object:"object"},this.Array={Remove:function(e,t){for(var n=e.length-1;n>=0;--n)t(e[n],n)&&e.splice(n,1);return e}},this.Object={Clone:function(e){return JSON.parse(JSON.stringify(e))},Copy:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return Object},GetProperty:function(e,t){if(""===t)return e;var n=t.replace(/\[([^\]]+)\]/g,".$1");n="."===n.substring(0,1)?n.substring(1):n,n=n.split(".");var r=0,o=e;for(r;r<n.length-1;r++)o=o[n[r]];return void 0===o||null===o?(console.warn("[Lure.Object.GetProperty] Property '"+t+"' is unreachable",e),null):o[n[r]]},SetProperty:function(e,t,n){if(""===t)return e=n;var r=t.replace(/\[([^\]]+)\]/g,".$1");r="."===r.substring(0,1)?r.substring(1):r,r=r.split(".");var o=0,i=e;for(o;o<r.length-1;o++)i=i[r[o]];return i[r[o]]=n,e},isEmpty:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(!t||"object"===("undefined"==typeof e?"undefined":_typeof(e)))&&!(e&&Object.keys(e).length>0)}},this.Blob={SaveAs:function(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=window.URL.createObjectURL(e),n.download=t,n.click(),window.URL.revokeObjectURL(n.href)},ToBase64:function(e){return new Promise(function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onloadend=function(){t(r.result)},r.onerror=n})}},this.DOM={ShowWithAnimation:function(e,t){var n=Lure.GetDurationAnimation(t,e);e.style.display="",e.classList.add(t),setTimeout(function(){e.classList.remove(t)},n)},HideWithAnimation:function(e,t){var n=Lure.GetDurationAnimation(t,e);e.classList.add(t),setTimeout(function(){e.style.display="none",e.classList.remove(t)},n)},GetLineID:function(e){return parseInt(e.dataset.line)},Print:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=window.open("","PRINT"),r="",o=0;o<document.styleSheets.length;o++)if(document.styleSheets[o].href){var i=void 0;if(document.styleSheets[o].rules?i=document.styleSheets[o].rules:document.styleSheets[o].cssRules&&(i=document.styleSheets[o].cssRules),!i)continue;for(var a=0;a<i.length;a++)i[a].cssText.indexOf("@")<0&&(r+=i[a].cssText)}r="@media print{\n                        "+r+"\n                        .button-print{display:none!important}\n                        "+t+"\n                    }\n                    @media screen{\n                        "+r+"\n                        .button-print{display:none!important}\n                        "+t+"\n                    }",n.document.write("<html><head><title>"+document.title+"</title>"),n.document.write("<style>"+r+"</style>"),n.document.write("</head><body>"),n.document.write(e.innerHTML),n.document.write("</body></html>"),n.document.close(),n.focus(),n.print(),n.close()},Swap:function(e,t){var n=e.parentNode.insertBefore(document.createTextNode(""),e);t.parentNode.insertBefore(e,t),n.parentNode.insertBefore(t,n),n.parentNode.removeChild(n)}},this.String={_KeyBD:{En:["q","w","e","r","t","y","u","i","o","p","[","]","a","s","d","f","g","h","j","k","l",";","'","z","x","c","v","b","n","m",",",".","/","Q","W","E","R","T","Y","U","I","O","P","{","}","A","S","D","F","G","H","J","K","L",":",'"',"|","Z","X","C","V","B","N","M","<",">","?"],Ru:["й","ц","у","к","е","н","г","ш","щ","з","х","ъ","ф","ы","в","а","п","р","о","л","д","ж","э","я","ч","с","м","и","т","ь","б","ю",".","Й","Ц","У","К","Е","Н","Г","Ш","Щ","З","Х","Ъ","Ф","Ы","В","А","П","Р","О","Л","Д","Ж","Э","/","Я","Ч","С","М","И","Т","Ь","Б","Ю",","]},Capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},QuoteScreen:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"string"!=typeof e?e:t?e.replace(/"/g,"&quot;"):e.replace(/"/g,'"')},ReplaceAsync:function(e,t,n){e=String(e);var r=[],o=0;if("[object RegExp]"===Object.prototype.toString.call(t)){t.global&&(t.lastIndex=o);for(var i=void 0;i=t.exec(e);){var a=i.concat([i.index,i.input]);if(r.push(e.slice(o,i.index),n.apply(null,a)),o=t.lastIndex,!t.global)break;0===i[0].length&&t.lastIndex++}}else t=String(t),o=e.indexOf(t),r.push(e.slice(0,o),n.apply(null,[t,o,e])),o+=t.length;return r.push(e.slice(o)),Promise.all(r).then(function(e){return e.join("")})},KeyboardSwitch:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Ru",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"En";t=Lure.String.Capitalize(t),n=Lure.String.Capitalize(n);for(var r="",o=0;o<e.length;o++){var i=Lure.String._KeyBD[t].indexOf(e[o]);r+=i>=0?Lure.String._KeyBD[n][i]:e[o]}return r},Random:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="",r=0;r<e;r++){var o=Lure.GetRandom(35,0),i=o.toString(36);t&&o>23&&(i=i.toUpperCase()),n+=i}return n}},this.Input={GetCursorPosition:function(e){var t={Start:-1,End:-1};if("selectionStart"in e&&document.activeElement===e)t.Start=e.selectionStart,t.End=e.selectionEnd;else if(e.createTextRange){var n=document.selection.createRange();if(n.parentElement()===e){var r=e.createTextRange();r.moveToBookmark(sel.getBookmark());for(var o=0;r.compareEndPoints("EndToStart",r)>0;r.moveEnd("character",-1))o++;for(r.setEndPoint("StartToStart",e.createTextRange());r.compareEndPoints("EndToStart",rng)>0;)t.Start++,t.End++,r.moveEnd("character",-1)}}return t}},this.Button={Lock:function(e){e=Lure.Select(e),e.disabled=!0,e.classList.add(Lure.Settings.Common.CSSButtonBusy)},Unlock:function(e){e=Lure.Select(e),e.disabled=!1,e.classList.remove(Lure.Settings.Common.CSSButtonBusy)},Release:function(e){e=Lure.Select(e),e.disabled=!1,e.classList.remove(Lure.Settings.Common.CSSButtonBusy)}},this.Cookie={Get:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},Set:function(e,t,n){n=n?n:{},n.expires&&(n.expires=Lure.Date(n.expires).Date.toUTCString());var r=e+"="+t;n.path=void 0!==n.path?n.path:"/";for(var o in n)n.hasOwnProperty(o)&&(r+="; "+o+" = "+(n[o]!==!0?n[o]:""));document.cookie=r},Remove:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";Lure.Cookie.Set(e,"",{expires:new Date(0),path:t})}},this.User={ID:-1,Roles:[],SubRoles:{}},this._EventClone=function(e){function t(){}var n=new t;for(var r in e){var o=Object.getOwnPropertyDescriptor(e,r);!o||o.writable&&o.configurable&&o.enumerable&&!o.get&&!o.set?n[r]=e[r]:Object.defineProperty(n,r,o)}return Object.setPrototypeOf(n,e),n},this.ApiCall=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;return n.then(function(e){t.Success?t.Success.call(e):null,t.Finally?t.Finally.call(e):null}),n["catch"](function(e){t.Catch?t.Catch.call(e):null,t.Finally?t.Finally.call(e):null}),n},this.Call=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.then(function(n){return t.Then?t.Then(n):null,t.Finally?t.Finally(n):null,e})["catch"](function(n){return t.Catch?t.Catch(n):console.error("[api.call]"+n),t.Finally?t.Finally(n):null,e})},this.AsyncToggle=function(e,t,n,r,o,i,a,s,l){return l&&clearTimeout(l),r.call(e,t),i&&n.classList.remove(i),i===a?(setTimeout(function(){a&&n.classList.add(a),l=setTimeout(function(){o.call(e,t)},s)}),l):(a&&n.classList.add(a),l=setTimeout(function(){o.call(e,t)},s))},this.GetDurationAnimation=function(CSSAnimation){var HTMLElement=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,isNull=!1;HTMLElement||(isNull=!0,HTMLElement=document.createElement("div"),document.body.appendChild(HTMLElement)),CSSAnimation&&HTMLElement.classList.add(CSSAnimation);var Style=window.getComputedStyle(HTMLElement),Duration=eval(Style.transitionDuration.replace("ms","*1").replace("s","*1000")),DurationAnim=eval(Style.animationDuration.replace("ms","*1").replace("s","*1000"));return Duration<DurationAnim&&(Duration=DurationAnim),CSSAnimation&&HTMLElement.classList.remove(CSSAnimation),isNull&&HTMLElement.remove(),Duration},this.GetProperty=this.Object.GetProperty,this.SetProperty=this.Object.SetProperty,this.GetType=function(e){return Lure.isNumeric(e)?"number":e instanceof Date||e instanceof Lure._Date?"date":e instanceof Function?"function":e instanceof Array||e instanceof NodeList?"array":e instanceof Node?"node":e instanceof Object?"object":null===e?null:"undefined"==typeof e?"undefined":_typeof(e)},this.CreateElementFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=document.createDocumentFragment(),r=document.createElement(t);for(r.innerHTML=e;r.childNodes[0];)n.appendChild(r.childNodes[0]);return n.childNodes.Where(function(e){return e.nodeName.indexOf("text")<0}).First()},this.CreateElementsFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=document.createDocumentFragment(),r=document.createElement(t);for(r.innerHTML=e;r.childNodes[0];)n.appendChild(r.childNodes[0]);if(n.childNodes.length>0){for(var o=[],i=0;i<n.childNodes.length;i++)o.push(n.childNodes[i]);return o.Where(function(e){return e.nodeName.indexOf("text")<0})}return null},this.Clone=function(e){return JSON.parse(JSON.stringify(e))},this.Clone2=function(e){var t=!1;if(e instanceof Array){t=[];for(var n=0;n<e.length;n++)"object"===Lure.GetType(e[n])||"array"===Lure.GetType(e[n])?t[n]=Lure.Clone2(e[n]):t[n]=e[n]}else{t={};for(var r in e)e.hasOwnProperty(r)&&("object"===Lure.GetType(e[r])||"array"===Lure.GetType(e[r])?t[r]=Lure.Clone2(e[r]):t[r]=e[r]instanceof Function?e[r]:JSON.parse(JSON.stringify(e[r])))}return t},this.CheckDirty=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!t)return!1;var r=!0;if(e instanceof Array){if(n&&e.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(e[o]instanceof Object){if(r=Lure.CheckDirty(e[o],t[o],n),!r)return!1}else if(e[o]!==t[o])return!1}else{if(!(e instanceof Object))return e===t;if(n&&Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(e[i]instanceof Object){if(r=Lure.CheckDirty(e[i],t[i],n),!r)return!1}else if(e[i]!==t[i])return!1}return r},this.CloneNode=function(e){var t=e.cloneNode();if(e.childNodes.length>0)for(var n=0;n<e.childNodes.length;n++)t.appendChild(Lure.CloneNode(e.childNodes[n]));return t},this.Select=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return""===e||null===e?null:e instanceof Node&&null===e.parentNode?null:e instanceof Node?e:t.querySelector(e)},this.SelectAll=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return"undefined"==typeof e?[]:"undefined"!=typeof e.tagName||e===document?[e]:t.querySelectorAll(e)},this.AddEventListenerGlobal=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,o=arguments[4];r.addEventListener(e,function(i){var a=i.target,s=!1,l=Lure._EventClone(i),u=r.querySelectorAll(t);if(u[0]===a&&(l.currentTarget=a,s=!0),!s)for(var c=0;c<u.length;c++)if(u[c].contains(a)){s=!0,l.currentTarget=a.closest(t);break}if(l.target.classList.contains("l-edit-editor")&&"click"===e)return void i.stopPropagation();if(s){var d={},h=l.currentTarget.dataset.id,f=l.currentTarget.dataset.line;if(h&&(d.ID=parseInt(h)),f)d.LineID=parseInt(f);else{var p=l.currentTarget.closest(".l-t-line");p&&(d.LineID=parseInt(p.dataset.line))}n.call(o?o:l.currentTarget,l,d)}})},this.DocumentSelectionClear=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},this.isVisible=function(e){var t=_this._isVisible(e);if(t)for(;e.parentElement;){if(!_this._isVisible(e))return!1;e=e.parentElement}return t},this._isVisible=function(e){var t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&0!==parseFloat(t.opacity)&&parseFloat(t.height)+parseFloat(t.minHeight)!==0&&parseFloat(t.width)+parseFloat(t.minWidth)!==0&&("body"===e.tagName.toLowerCase()||null!==e.offsetParent&&"fixed"!==t.display)},this.GetFileText=function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.onload=function(){t(r.response)},r.onerror=function(){n(new Error("XMLHttpRequest Error: "+this.statusText))},e=e.indexOf("..")>-1?e.replace("..",document.location.protocol+"//"+document.location.host):document.location.href.substring(0,document.location.href.lastIndexOf("/")+1)+e,console.log("Lure.GetFileText",e),r.open("GET",e),r.send()})},this.GetTextWidth=function(e,t,n){return void 0===this.c&&(this.c=document.createElement("canvas"),this.ctx=this.c.getContext("2d")),this.ctx.font=n+" "+t,this.ctx.measureText(e).width},this.GetInlineSize=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1rem",n="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",r=document.createElement("div");for(var o in e.style)try{""!==e.style[o]&&e.style[o].indexOf(":")>0&&(r.style[o]=e.style[o])}catch(i){}document.all?r.style.setAttribute("cssText",n):r.setAttribute("style",n),r.style.fontSize=t,r.innerHTML=e.innerHTML,parent.document.body.appendChild(r);var a={width:r.clientWidth,height:r.clientHeight};return parent.document.body.removeChild(r),a},this.GetInlineSize1=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"12px",n=performance.now(),r="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",o=document.createElement("div");for(var i in e.style)try{""!==e.style[i]&&e.style[i].indexOf(":")>0&&(o.style[i]=e.style[i])}catch(a){}document.all?o.style.setAttribute("cssText",r):o.setAttribute("style",r),o.style.fontSize=t,o.innerHTML=e.innerHTML,parent.document.body.appendChild(o);var s=getComputedStyle(o),l=performance.now(),u={width:Lure.GetTextWidth(e.innerText,s.getPropertyValue("font-family"),s.getPropertyValue("font-size")),height:12};return Lure.Perf(l,"--size"),parent.document.body.removeChild(o),console.log("sizes",u,s),Lure.Perf(n,"--calxXwidth"),u};var CounterID=0;this.GetID=function(){return CounterID++,CounterID},this.GetLastID=function(){return CounterID},this.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this.PrintElement=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=window.open("","PRINT"),r="",o=0;o<document.styleSheets.length;o++)if(document.styleSheets[o].href){var i=void 0;if(document.styleSheets[o].rules?i=document.styleSheets[o].rules:document.styleSheets[o].cssRules&&(i=document.styleSheets[o].cssRules),!i)continue;for(var a=0;a<i.length;a++)i[a].cssText.indexOf("@")<0&&(r+=i[a].cssText)}r="@media print{\n                        "+r+"\n                        .button-print{display:none!important}\n                        "+t+"\n                    }\n                    @media screen{\n                        "+r+"\n                        .button-print{display:none!important}\n                        "+t+"\n                    }",n.document.write("<html><head><title>"+document.title+"</title>"),n.document.write("<style>"+r+"</style>"),n.document.write("</head><body>"),n.document.write(e.innerHTML),n.document.write("</body></html>"),n.document.close(),n.focus(),n.print(),n.close()},this.Perf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Perf",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Math.floor(100*(window.performance.now()-e))/100;return console.log("%c["+t+"]: "+r+"ms",n),r},this.Confirm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Achtung",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=(n.Error,n.CaptionColor),o=void 0===r?"":r,i=n.CaptionBackground,a=void 0===i?"":i,s=n.ButtonAgreeText,l=void 0===s?Lure.Culture.Lang.Ok:s,u=n.ButtonCancelText,c=void 0===u?Lure.Culture.Lang.Cancel:u,d=n.OnAgree,h=void 0===d?function(){}:d,f=n.OnCancel,p=void 0===f?null:f;document.activeElement.blur();var m=Lure._Dialog.zIndex,y=document.createElement("div");y.classList.add("lure-confirm"),Lure.Settings.DialogAnimation&&y.classList.add(Lure.Settings.DialogAnimation);var g=document.createElement("div");g.classList.add("cd-caption"),g.innerHTML=e,g.style.color=o,g.style.background=a,y.appendChild(g);var v=document.createElement("div");v.classList.add("cd-text"),v.innerHTML=t,y.appendChild(v);var L=document.createElement("div");L.classList.add("cd-buttons"),y.appendChild(L);var S=document.createElement("div");if(S.classList.add("button","cd-button","btn-diag-confirm"),S.innerHTML=l,S.onclick=function(){Lure._ConfirmCount--,null!==h&&void 0!==h&&h(),Lure.Settings.Dialog.Blur&&Lure._ConfirmCount<1&&Lure.Select(Lure.Settings.Dialog.BlurTarget).classList.remove(Lure.Settings.Dialog.Blur),Lure._Dialog.Remove(y),b.remove(),y.remove()},y.getElementsByClassName("cd-buttons")[0].appendChild(S),null!==p){var C=document.createElement("div");C.classList.add("button","cd-button","btn-diag-cancel"),C.innerHTML=c,C.onclick=function(){Lure._ConfirmCount--,null!==p&&p(),Lure.Settings.Dialog.Blur&&Lure._ConfirmCount<1&&Lure.Select(Lure.Settings.Dialog.BlurTarget).classList.remove(Lure.Settings.Dialog.Blur),Lure._Dialog.Remove(y),b.remove(),y.remove()},y.getElementsByClassName("cd-buttons")[0].appendChild(C)}var b=document.createElement("div");b.classList.add(Lure.Settings.Dialog.Wrapper),Lure.Settings.Confirm.Wrapper&&b.classList.add(Lure.Settings.Confirm.Wrapper),b.style.zIndex=m+1,y.style.zIndex=m+2,Lure._Dialog.Add(y),Lure.Settings.Confirm.Wrapper&&document.body.appendChild(b),document.body.appendChild(y),Lure._ConfirmCount++,Lure.Settings.Dialog.Blur&&(b.style.background="none",Lure.Select(Lure.Settings.Dialog.BlurTarget).classList.add(Lure.Settings.Dialog.Blur))},this.NoFeature=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==e&&(e='"'+e+'"'),Lure.Confirm("Error","Sorry, function "+e+" is not available yet")},this.ErrorHint=function(e,t){t||(t="Поле не может быть пустым");var n=document.createElement("div");n.classList.add("lure-error-hint"),n.innerHTML=t,e.parentElement.style.position="relative",e.parentElement.appendChild(n),n.style.display="block";try{n.animate({opacity:[0,1]},{duration:300})}catch(r){}setTimeout(function(){try{n.animate({opacity:[1,0]},{duration:300}).onfinish=function(){n.style.display="none"}}catch(t){n.style.display="none"}setTimeout(function(){e.parentElement&&(e.parentElement.style.position=""),n.remove()},500)},2e3)},this.RoundBy=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ceil",r=e%t;return 0===r?e:"ceil"===n?e-r+t:"floor"===n?e-r:e-r+(r/t<.5?0:t)},this.GetNumberOrder=function(e){var t=e.toString().split(".");if(0!==parseInt(t[0]))return t=t[0].length,t-1;var n=t[1]?t[1].match(/[^0]/):null;return n=n?n.index+1:1,-n},this.GetRandom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.round(Math.random()*(e-t)+t)},this.SaveBlob=this.Blob.SaveAs}return _createClass(LureClass,[{key:"Version",get:function(){return"v2.1.17"}}]),LureClass}();return new LureClass}();Lure.Settings.Locale=navigator.language.substring(0,2),Lure.Settings.LocaleSort=Lure.Settings.Locale,document.addEventListener("DOMContentLoaded",function(){Lure.DOM.ScrollBarWidth=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;return e.parentNode.removeChild(e),t-r}()}),Lure.__Linq=function(){function e(t){_classCallCheck(this,e),this._Arr=t,this._Delegates=[]}return _createClass(e,[{key:"Where",value:function(e){return this._Delegates.push({d:e,t:0}),this}},{key:"Select",value:function(e){return this._Delegates.push({d:e,t:1}),this}},{key:"FirstOrDefault",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=0;t<this._Arr.length;t++){for(var n=!1,r=this._Arr[t],o=0;o<this._Delegates.length;o++){var i=this._Delegates[o];if(0===i.t&&!i.d(r,t)){n=!0;break}r=this._Delegates[o].d(r,t)}if(!n)return r}return e}},{key:"ToList",value:function(){for(var e=new Array(this._Arr.length),t=0,n=0;n<this._Arr.length;n++){for(var r=!1,o=this._Arr[n],i=0;i<this._Delegates.length;i++){var a=this._Delegates[i];if(0===a.t&&!a.d(o,n)){r=!0;break}o=this._Delegates[i].d(o,n)}r||(e[t]=o,t++)}return e.slice(0,t)}}]),e}(),Lure.Linq=function(e){return new Lure.__Linq(e)};
"use strict";Lure.Application={Entry:null,isRun:!1,Content:[],Run:function(){if(Lure.Application.isRun)return Lure.System.ShowWarn("Lure Application is already run");var t="LureRoute"+Lure.User.ID;Lure.Route.Enabled&&!document.location.hash&&localStorage.getItem(t)&&(document.location.hash=localStorage.getItem(t),localStorage.setItem(t,"")),Lure.Application.isRun=!0;for(var e=0;e<Lure.Application.Content.length;e++)if(!Lure.Application.Content[e].Parent){Lure.Application.Content[e]._Init&&Lure.Application.Content[e]._Init();try{}catch(n){console.error('Error in "'+Lure.Application.Content[e].Name+'"',Lure.Application.Content[e],"\n",n)}}var o=0;try{o=Lure.Route.Run()}catch(n){console.warn("[Lure.Application] RunByRoute error. Wrong route or not enough permission")}if(Lure.Application.Entry&&o<1){Lure.Route._PopState=!1;var r=Lure._Content.List.Where(function(t){return t.Name===Lure.Application.Entry}).FirstOrDefault();console.log("Lure.Application.Entry",Lure.Application.Entry,r),r&&r.Show()}Lure.Route.Enabled&&Lure.Route.Init(),console.log("[Lure.Application.Run]")}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Lure.Editable={isEnabled:!1,ListenEditable:function(e,t){var a=t.Type;e.AddEventListener("click","."+Lure.Settings.Editable.ClassEditable+' .l-edit[data-controller="'+t.ID+'"]',function(r){r.target.classList.contains("l-edit-btn-edit")?(Lure.Editable.RemoveEdits(e),r.target.classList.contains("l-edit-"+a)&&Lure.Editable.AddEdits.call(e,r.target.parentElement.parentElement.parentElement,t,a)):r.target.classList.contains("l-edit-btn-save")&&r.target.classList.contains("l-edit-"+a)&&Lure.Editable.Save.call(e,r.target.parentElement.parentElement.parentElement,t)}),e.AddEventListener("dblclick","."+Lure.Settings.Editable.ClassEditable+'[data-controller="'+t.ID+'"]',function(r){(r.target===r.currentTarget||r.target.classList.contains("l-edit-value"))&&(Lure.Editable.RemoveEdits(e),null!==Lure.Select(".l-edit-"+a,r.currentTarget)&&Lure.Editable.AddEdits.call(e,r.currentTarget,t,a))}),e.AddEventListener("input","."+Lure.Settings.Editable.ClassEditable+' .l-edit-textbox[data-controller="'+t.ID+'"]',function(e){if(e.currentTarget.classList.contains("l-edit-"+a)){var r=e.currentTarget.parentElement.parentElement,i=e.currentTarget.dataset.line,l=e.currentTarget.dataset.property;l=l.replace("$item","").replace(".$this","").replace("$this","");var n=e.currentTarget.value,o=e.currentTarget.max,d=e.currentTarget.min;o&&parseFloat(o)<n&&(n=parseFloat(o)),d&&parseFloat(d)>n&&(n=parseFloat(d)),""===l?t.isLineBuilder?t._DataPrivateDict[i].Data=n:t._DataPrivate=n:Lure.SetProperty(t.isLineBuilder?t._DataPrivateDict[i].Data:t._DataPrivate,l,n),Lure.Editable.CheckChanges(r,t,l,i)}}),e.AddEventListener("keyup","."+Lure.Settings.Editable.ClassEditable+'  .l-edit-textbox[data-controller="'+t.ID+'"]',function(r){if(13===r.keyCode&&"textarea"!==r.target.tagName.toLowerCase()&&r.target.classList.contains("l-edit-"+a))return Lure.Editable.Save.call(e,r.target.parentElement.parentElement,t)}),e.AddEventListener("change","."+Lure.Settings.Editable.ClassEditable+'  .l-edit-select[data-controller="'+t.ID+'"]',function(e){if(e.target.classList.contains("l-edit-"+a)){var r=e.currentTarget.parentElement.parentElement,i=r.dataset.property;i=i.replace("$item","").replace(".$this","").replace("$this","");var l=e.currentTarget.dataset.line;Lure.SetProperty(t.isLineBuilder?t._DataPrivateDict[l].Data:t._DataPrivate,i,e.currentTarget.value),t.PropTypes[i]&&Lure.PropTypes.CheckProp(t.isLineBuilder?t._DataPrivateDict[l].Data:t._DataPrivate,t.PropTypes[i],i),Lure.Editable.CheckChanges(r,t,i,l)}}),"proto"!==t.Type&&e.AddEventListener("click","."+Lure.Settings.Editable.ClassRemovable+'  .l-edit-btn-remove:not(.active)[data-controller="'+t.ID+'"]',function(e){e.currentTarget.classList.add("active");var a=e.currentTarget.dataset.line;Lure.Call(t.Remove(a),{Finally:function(){e.currentTarget.classList.remove("active")}})}),Lure.Editable.isEnabled||(document.addEventListener("click",function(e){e.target.classList.contains("l-edit")&&Lure.SelectAll(".l-edit, .l-edit-editing").length>0||Lure.Editable.RemoveEdits()}),Lure.Editable.isEnabled=!0),e.isListenEditable=!0},ListenRemovable:function(e){Lure.AddEventListenerGlobal("click",".removable-icon",function(t){var a=t.currentTarget.closest(".removable").dataset.line;e.Remove(a)},e.Content)},GetPropertyName:function(e){var t=e.dataset.line;return t>-1?"["+t+"]."+e.dataset.property:e.dataset.property},EditableForceRefresh:function(e){var t=e.Content,a="."+Lure.Settings.Editable.ClassEditableForce;"proto"===e.Type&&(a="."+Lure.Settings.Editable.ClassEditableForce+'[data-line="null"]');for(var r=Lure.SelectAll(a,t),i=0;i<r.length;i++)r[i].classList.remove(Lure.Settings.Editable.ClassChanged),Lure.Editable.AddEdits(r[i],e,e.Type)},CheckChanges:function(e,t,a,r){Lure.GetProperty(t.isLineBuilder?t._DataDict[r].Data:t._Data,a)!==Lure.GetProperty(t.isLineBuilder?t._DataPrivateDict[r].Data:t._DataPrivate,a)?e.classList.add("l-edit-changed"):e.classList.remove("l-edit-changed")},RemoveWaiting:function(e){for(var t=Lure.SelectAll("."+Lure.Settings.Editable.ClassWaiting,e?e.Content:document),a=0;a<t.length;a++)t[a].classList.remove(Lure.Settings.Editable.ClassWaiting)},RemoveEdits:function(e){for(var t=Lure.SelectAll(".l-edit-editing:not(.l-edit-datepick):not(."+Lure.Settings.Editable.ClassEditableForce+")",e?e.Content:document),a=0;a<t.length;a++)t[a].innerHTML=t[a]._innerHTML,t[a].classList.remove(Lure.Settings.Editable.ClassEditing),t[a].classList.remove(Lure.Settings.Editable.ClassChanged)},AddEdits:function AddEdits(EditableElement,Controller,CType){if(!EditableElement.classList.contains("editable-special")){EditableElement.classList.add("l-edit-editing"),EditableElement._innerHTML=EditableElement.innerHTML;var LineID=Controller.isLineBuilder?parseInt(EditableElement.dataset.line):"proto",Property=EditableElement.dataset.property;Property=Property.replace("$item","").replace(".$this","").replace("$this","");var ControllerData=Controller.isLineBuilder?Controller._DataDict[LineID].Data:Controller._Data,ControllerDataPrivate=Controller.isLineBuilder?Controller._DataPrivateDict[LineID].Data:Controller._DataPrivate;if(!Controller.Owner.isContent||Controller.Owner.HasPermissionWrite&&Controller.Owner.HasElementWritePermission(EditableElement,ControllerData)){var SaveButton='<div class="l-edit l-edit-controls"><div class="l-edit l-edit-icon l-edit-btn-save l-edit-'+CType+'" data-controller="'+Controller.ID+'" data-line="'+LineID+'"></div></div>';if(EditableElement.dataset.object){for(var string_Select='<div class="l-row l-flex-between l-flexa-center l-flex-100"><select class="select l-select l-edit l-edit-editor l-edit-select l-edit-'+CType+'"  data-controller="'+Controller.ID+'" data-property="'+Property+'" data-line="'+LineID+'">',SelectData=eval(EditableElement.dataset.object),PropertyValue=EditableElement.dataset.value,PropertyShow=EditableElement.dataset.present,i=0;i<SelectData.length;i++){var item=SelectData[i];string_Select+=("undefined"==typeof item?"undefined":_typeof(item))===_typeof({})?'<option class="l-edit" value="'+Lure.GetProperty(item,PropertyValue)+'" '+(Lure.GetProperty(item,PropertyValue)===Lure.GetProperty(ControllerData,Property)?"selected":"")+' data-controller="'+Controller.ID+'" data-property="'+Property+'" data-line="'+LineID+'">'+Lure.GetProperty(item,PropertyShow)+"</option>":'<option class="l-edit" value="'+item+'" '+(item===Lure.GetProperty(ControllerData,Property)?"selected":"")+' data-controller="'+Controller.ID+'" data-property="'+Property+'" data-line="'+LineID+'">'+item+"</option>"}string_Select+="</select>"+SaveButton+"</div></div>",EditableElement.innerHTML=string_Select}else{var EditType=Controller.PropTypes[Property],EditMin=EditableElement.dataset.min,EditMax=EditableElement.dataset.max,isRichText=EditType===Lure.PropTypes.Text;if(EditType=EditType?EditType:"text",EditType=EditType===Lure.PropTypes.String?"text":EditType,EditType===Lure.PropTypes.Date){if(!EditableElement.LurePeriodPicker){var DatePlace=Lure.Select(".l-edit-value",EditableElement);DatePlace.classList.remove("l-edit"),EditableElement.classList.add("l-edit-datepick"),EditableElement.classList.add("l-edit-"+CType),EditableElement.dataset.controller=Controller.ID,Controller.isLineBuilder&&(EditableElement.dataset.line=LineID),EditableElement.dataset.property=Property,EditableElement.LurePeriodPicker=new Lure.PeriodPicker({Target:DatePlace,TargetImmutable:!0,NoRange:!0,Min:EditMin?Lure.Date(EditMin).Date:null,Max:EditMax?Lure.Date(EditMax).Date:null,DateTarget:Lure.GetProperty(ControllerData,Property),OnConfirm:function(){if("proto"===LineID)Lure.SetProperty(Controller._DataPrivate,Property,this.Date);else{var e=Controller.GetPrivateDataItemByLineID(LineID);Lure.SetProperty(e.Data,Property,this.Date)}Lure.Editable.Save(EditableElement,Controller)}})}return EditableElement.LurePeriodPicker.Min=EditMin?Lure.Date(EditMin).Date:null,EditableElement.LurePeriodPicker.Max=EditMax?Lure.Date(EditMax).Date:null,EditableElement.LurePeriodPicker.Date=Lure.GetProperty(ControllerData,Property),EditableElement.LurePeriodPicker.Show()}EditMin=EditMin?'min="'+EditMin+'"':"",EditMax=EditMax?'max="'+EditMax+'"':"","uint"===EditType&&(""===EditMin||EditMin<0)&&(EditMin='min="0"'),isRichText?EditableElement.innerHTML='<div class="l-row l-flex-between l-flexa-center l-flex-100"><textarea class="textbox l-textbox l-edit l-edit-editor l-edit-textbox l-edit-'+CType+'" '+(EditType?'data-type="'+EditType+'"':"")+" "+EditMin+" "+EditMax+' data-controller="'+Controller.ID+'" data-property="'+Property+'" data-line="'+LineID+'">'+Lure.GetProperty(ControllerData,Property)+"</textarea>"+SaveButton+"</div>":EditableElement.innerHTML='<div class="l-row l-flex-between l-flexa-center l-flex-100"><input class="textbox l-textbox l-edit l-edit-editor l-edit-textbox l-edit-'+CType+'" type="'+(EditType.indexOf("int")>-1?"number":EditType)+'" '+(EditType?'data-type="'+EditType+'"':"")+" "+EditMin+" "+EditMax+' value="'+Lure.String.QuoteScreen(Lure.GetProperty(ControllerData,Property),!0)+'"  data-controller="'+Controller.ID+'" data-property="'+Property+'"  data-line="'+LineID+'"> '+SaveButton+"</div>",Lure.Settings.Editable.AutoFocus&&Lure.Select(".l-edit-editor",EditableElement).focus(),Lure.Settings.Editable.AutoSelect&&Lure.Select(".l-edit-editor",EditableElement).select()}}}},Save:function(e,t){var a=t.isLineBuilder?e.dataset.line:"proto",r=e.dataset.property;r=r.replace("$item","").replace(".$this","").replace("$this","");var i=t.isLineBuilder?t._DataPrivateDict[a].Data:t._DataPrivate,l=t.isLineBuilder?t._DataDict[a].Data:t._Data,n=Lure.GetProperty(i,r),o=Lure.GetProperty(l,r),d=Lure.Select(".l-edit-editor",e);return d&&(d.value=n),n===o?Lure.Editable.RemoveEdits(t.Owner):(e.classList.remove("l-edit-editing"),e.classList.remove("l-edit-changed"),e.classList.add("l-edit-waiting"),e.classList.contains(Lure.Settings.Editable.ClassEditableForce)||(e.innerHTML=e._innerHTML,Lure.Select(".l-edit-value",e).innerHTML=t.PropFormat[r]?t.PropFormat[r](n,i):n),"proto"===t.Type?t.OnChange(r,n,o).then(function(){e.classList.remove("l-edit-waiting"),t.SetProperty(r,Lure.GetProperty(i,r),!1)})["catch"](function(a){e.classList.remove("l-edit-waiting"),Lure.Select(".l-edit-value",e).innerHTML=t.PropFormat[r]?t.PropFormat[r](o,l):o,console.error('[Lure.Proto] Save Error. Property: "'+r+'", Value: "'+n+'"',"\n",t,"\n",a)}):"controller"===t.Type?t.LineSave(t._DataDict[a],r,n,a).then(function(){e.classList.remove("l-edit-waiting"),""===r?t._DataDict[a].Data=Lure.GetProperty(t._DataPrivateDict[a].Data,r):Lure.SetProperty(t._DataDict[a].Data,r,Lure.GetProperty(t._DataPrivateDict[a].Data,r)),t.OnChange("save",t._DataDict[a],r)})["catch"](function(l){e.classList.remove("l-edit-waiting"),Lure.Select(".l-edit-value",e).innerHTML=t.PropFormat[r]?t.PropFormat[r](o):o,console.error('[Lure.Templator] Save Error. LineID: "'+a+'", Property: "'+r+'", Value: "'+Lure.GetProperty(i,r)+'"',l,"\n",t)}):void 0)}},Lure.Settings.Editable={_CSSEditable:"editable",_ClassEditable:"editable",get ClassEditable(){return this._ClassEditable},set ClassEditable(e){this._ClassEditable=e,Lure._CompileSmart.RegExp.Editable=new RegExp("<[^>]+class=['\"][\\w\\d\\s-{}]*("+e+")[\\w\\d\\s-{}]*['\"][^>]*>([^<]*)<[^>]+>/"),Lure._CompileSmart.RegExp.EditRemove=new RegExp("<[^>]+class=['\"][\\w\\d\\s-{}]*("+this._ClassEditable+"|"+this._ClassRemovable+")[\\w\\d\\s-{}]*['\"][^>]*>([^<]*)<[^>]+>","g")},_ClassRemovable:"removable",get ClassRemovable(){return this._ClassRemovable},set ClassRemovable(e){this._ClassRemovable=e,Lure._CompileSmart.RegExp.Editable=new RegExp("<[^>]+class=['\"][\\w\\d\\s-{}]*("+e+")[\\w\\d\\s-{}]*['\"][^>]*>([^<]*)<[^>]+>/"),Lure._CompileSmart.RegExp.EditRemove=new RegExp("<[^>]+class=['\"][\\w\\d\\s-{}]*("+this._ClassEditable+"|"+this._ClassRemovable+")[\\w\\d\\s-{}]*['\"][^>]*>([^<]*)<[^>]+>","g")},ClassEditableForce:"editable-force",CSSEditableForce:"editable-force",CSSEditing:"l-edit-editing",CSSChanged:"l-edit-changed",CSSWaiting:"l-edit-waiting",ClassEditing:"l-edit-editing",ClassChanged:"l-edit-changed",ClassWaiting:"l-edit-waiting",AutoSelect:!0,AutoFocus:!0};
"use strict";Lure._CompileSmart={RegexpOperator:new RegExp("{{#(each|if|endeach|endif)[^}]*}}","i"),RegExp:{SpaceKiller:new RegExp("<\\/[\\w-]+>[^\\s]*(\\s{2,}[^\\S]*)<","g"),_Parser:new RegExp("<[\\s\\S]*?>([\\s\\S]*)<[\\s\\S]*>"),DataLine:new RegExp("<[\\w ]+ [\\s\\S]*?({{#data-line}})[\\s\\S]*?>","gi"),LineID:new RegExp("{{#LineID}}","gi"),If:new RegExp("{{#if\\s+([^}]+)}}([\\s\\S]*?){{#endif}}","gi"),IfInline:new RegExp("{{#if[\\s]*(\\([\\s\\S]+?\\)[\\s\\S]*?:[\\s\\S]*?)}}","gi"),IfInlineSelect:new RegExp("{{#if([\\s\\S]*?)\\?[\\s\\S]*?}}","gi"),Each:new RegExp("{{#each\\s+([^}]+)}}","gi"),EditRemove:new RegExp("<[^>]+class=['\"][\\w\\d\\s-#{()}.='\":?\\\\>]*(editable|removable)[\\w\\d\\s-#{()}.='\":?\\\\>]*['\"][^>]*>([^<]*)<[^>]+>","g"),Editable:new RegExp("<[^>]+class=['\"][\\w\\d\\s-#{()}.='\":?\\\\>]*(editable)[\\w\\d\\s-#{()}.='\":?\\\\>]*['\"][^>]*>([^<]*)<[^>]+>"),Removable:new RegExp("<[^>]+class=['\"][\\w\\d\\s-#{()}.='\":?\\\\>]*(removable)[\\w\\d\\s-#{()}.='\":?\\\\>]*['\"][^>]*>([^<]*)<[^>]+>"),EditableInEach:new RegExp("{{#each\\s+([^}]+)}}[\\s\\S]*<[^>]+class=['\"][\\w\\d\\s-{}]*(editable|removable)[\\w\\d\\s-{}]*['\"][^>]*>([^<]*)<[^>]+>[\\s\\S]*{{#endeach}}","g"),Expression:new RegExp("{{([^#}]+)}}","g")},CompilePart:{PlaceEditable:function(e,r,t,n,i){if(e.indexOf("data-property=")>-1)return e;var l=i?'data-controller="'+i.ID+'"':"",a=Lure._CompileSmart.RegExp.Editable.exec(e),o=Lure._CompileSmart.RegExp.Removable.exec(e),u=null!==o?'<div class="l-edit l-edit-icon l-edit-'+i.Type+' l-edit-btn-remove" '+l+' data-line="{{__LineID}}" title="'+Lure.Culture.Lang.Remove+'"></div>':"",p=null!==a?'<div class="l-edit l-edit-icon l-edit-'+i.Type+' l-edit-btn-edit"   '+l+' data-line="{{__LineID}}" title="'+Lure.Culture.Lang.Change+'"></div>':"";return e=e.replace(/<[\s\S]+?(>)/,function(e,r){return e.replace(r,' data-line={{__LineID}} data-property="'+(n?n+"[{{j}}].":"")+t.replace("{{","").replace("}}","")+'" '+l+">")}),i.isEditable=!!a||i.isEditable,i.isRemovable=!!o||i.isRemovable,e.replace(new RegExp(">[^<]*("+t.replace(/\$/g,"\\$")+")[^>]*</"),function(e,r){return e.replace(r,'<div class="l-edit-container l-row l-flex-between l-flexa-center l-flex-100"><div class="l-edit l-edit-value" data-line="{{__LineID}}" '+l+">"+t+'</div><div class="l-edit l-edit-controls">'+p+u+"</div></div>")})},MakeEditable:function(e,r,t){return e.replace(Lure._CompileSmart.RegExp.EditRemove,function(e,n,i){return Lure._CompileSmart.CompilePart.PlaceEditable(e,n,i,r,t)})},Editable:function(e,r){return e=e.replace(Lure._CompileSmart.RegExp.EditableInEach,function(e,t,n){var i=e.match(/{{#each\s+([^}]+)}}/)[1];return Lure._CompileSmart.CompilePart.MakeEditable(e,i,r)}),e=Lure._CompileSmart.CompilePart.MakeEditable(e,!1,r)},If:function(e,r){return e.replace(/#IF/g,"#if").replace(/#ENDIF/g,"#endif").replace(Lure._CompileSmart.RegExp.If,function(e,t,n){return t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/#less/gi,"<").replace(/#more/gi,">").replace(/&amp;/g,"&").replace(/\\'/g,'"').replace(/#or/gi," || ").replace(/#and/gi," && "),'`+\n/* OUTER "IF" */\n(function($this){\nif ('+Lure._CompileSmart.CompilePart.Prepare(t,r)+") {\n    return `"+n+"`;\n}\nreturn '';\n}).call(this, $this)+`"})},IfInline:function(e){return e=e.replace(Lure._CompileSmart.RegExp.IfInline,function(e,r){return r=r.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/#less/gi,"<").replace(/#more/gi,">").replace(/&amp;/g,"&").replace(/\\'/g,'"').replace(/#or/gi," || ").replace(/#and/gi," && "),'`+\n/* LOCAL "IF" */\n(function(){\n    return ('+r+"); \n    return '';}).call(this)+`"})},Each:function(e,r){var t="    ",n=e.match(Lure._CompileSmart.RegExp.Each),i=0;if(null!==n)for(var l=n.length-1;l>=0;l--){var a=n[l],o=!1;i++;var u=e.indexOf(a),p=e.indexOf("{{#endeach}}",u),c=e.slice(0,u).match(Lure._CompileSmart.RegExp.Each);c=null!==c?c.length:0;var m=e.slice(0,u).match(/{{#endeach}}/g);m=null!==m?m.length:0,c>m&&(o=!0,i=0);var s=e.slice(u,p+12),d=s.slice(a.length,s.length-12),g=a.replace(/{{#each\s+([\s\S]+)}}/,function(e,r){return r});g=Lure._CompileSmart.CompilePart.CheckProperty(g,r);var f="`+"+t.repeat(i)+"/* EACH */(function(inner, $parent){                                                                   \r\n"+t.repeat(i)+'    if (!inner || inner === "'+Lure.Settings.Controller.Common.Undefined+'" || (Object.keys(inner).length === 0 && inner.constructor === Object && isNaN(inner)))   \r\n'+t.repeat(i)+'        return "";                                                                                     \r\n'+t.repeat(i)+'    let string_result= "";                                                                             \r\n'+t.repeat(i)+"    for(let j = 0; j < inner.length; j++){                                                             \r\n"+t.repeat(i)+"        let $this = inner[j];                                                                          \r\n"+t.repeat(i)+"        let o = inner[j];                                                                              \r\n"+t.repeat(i)+"        string_result = string_result + `"+Lure._CompileSmart.CompilePart.Prepare(d,r)+"`; \r\n"+t.repeat(i)+"    }                                                                                                  \r\n"+t.repeat(i)+"    return string_result;                                                                              \r\n"+t.repeat(i)+"}).call(this,"+g+', {$parent: typeof $parent !== "undefined"?$parent:null, $this: $this, i: i} ) +`         ';e=e.replace(s,f)}return e},CheckProperty:function(e,r){function t(e){var t=e,n="",i="",l="";null!==t.match(/^\(([^(]*)$/)&&(t=t.substring(1),n="("),/^([^)]*)\)$/.test(t)&&(t=t.substring(0,t.length-1),i=")"),0===t.trim().indexOf("!")&&(l="!",t=t.replace("!",""));var a=t.indexOf("$item")>-1||t.indexOf("$this")>-1||t.indexOf("$parent")>-1,o=t.indexOf("$index")>-1||t.indexOf("$j")>-1||t.indexOf("$key")>-1||t.indexOf("$lvl")>-1||t.indexOf("$g.")>-1||0===t.trim().indexOf("this."),u="?"===t||t.indexOf("=")>-1||t.indexOf(">")>-1||t.indexOf("<")>-1,p=null!==t.match(/^["'\\][\s\S]*["'\\]$/),c="i"===t||"j"===t||"__LineID"===t,m=!isNaN(t);return a||o||c||m||p||u?t.indexOf("$g.")>-1?n+l+t.replace("$g.",""):e:r&&r.PropFormat&&r.PropFormat[t]?n+l+('__Controller.PropFormat["'+t+'"].call(this, o.'+t+", $this)")+i:n+("((typeof o."+t+" !== 'undefined')? "+l+"o."+t+':"'+Lure.Settings.Controller.Common.Undefined+'")')+i}return e=e.replace(/[^\-+\/%*]+/g,function(e){var r=e.match(/&/g);if(null!==r){for(var n=0;n<r.length;n++)e=n<r.length-1?e.replace("&","$parent"):e.replace("&","$parent.$this");return e}return t(e)}),e=e.replace(/\\'/g,"'"),e="("+e+")"},CheckPropertyE:function(e,r){function t(e){return e.trim().length>0&&i.indexOf(e.split(".")[0])<0&&!Lure.isNumeric(e)}function n(e){p?(a+=e,m+=a,a="",p=!1):(t(a)&&(a=r&&r.PropFormat&&r.PropFormat[a]?"this."+Lure.String.Capitalize(r.Type)+'.PropFormat["'+a+'"].call(this, o.'+a+", $this)":"((typeof o."+a+"!==typeof void 0)?o."+a+':"'+Lure.Settings.Controller.Common.Undefined+'")'),m+=a,a=""," "!==e&&(m+=e))}for(var i=["this","$item","$this","$parent","$g","__LineID","i","j","$index","$j","$key","$lvl"],l=0,a="",o="+-*/^<>?:|&%= ,",u="`\"'",p=!1,c=!1,m="",s=0;s<e.length;s++){var d=e.charAt(s);if(u.indexOf(d)>0){if(!p){p=!0,a+=d;continue}if(d===a.charAt(0)&&s>0&&"\\"!==e.charAt(s-1)){n(d);continue}if(d===a.charAt(0)&&s>0&&"\\"===e.charAt(s-1)){a=a.substring(0,a.length-1),a+=a.charAt(0);continue}}p?a+=d:o.indexOf(d)<0?"("!==d||p?")"!==d||p?a+=d:(l>0&&l--,n(d)):s>0&&o.indexOf(e.charAt(s-1))<0?(c=!0,l++,n(d)):m+=d:n(d)}return n(""),m},Prepare:function(e,r){return e.replace(Lure._CompileSmart.RegExp.Expression,function(e,t){return"${"+Lure._CompileSmart.CompilePart.CheckProperty(t,r)+"}"})},FnString:function(){return"if (!p)\n    p = {};\nvar i = p.i ? p.i : 0;\nvar j = p.j ? p.j : 0;\nvar length = p.length;\nvar __LineID = typeof p.LineID !== 'undefined' ? p.LineID : null;\nvar __Controller = p.Controller;\nvar $this = o;\nvar $item = o;\nvar $num = i+1;\nvar $denum = length-i;\n//TreeBuilder's\nvar $index = p.$index;\nvar $key = p.$key;\nvar $lvl = p.$lvl;\nvar $j   = p.$j;\nvar string_Result = \"\";\nif (o === undefined || (!p.RenderAnyway && Object.keys(o).length === 0 && o.constructor === Object && isNaN(o)) ) \n    return '';\nreturn `"}},Compile:function(e,r){var t=Lure._CompileSmart.CompilePart.FnString();e=e.replace(Lure._CompileSmart.RegExp.LineID,"{{__LineID}}"),e=e.replace(Lure._CompileSmart.RegExp.DataLine,function(e,r){return e.replace(r,'data-line="{{__LineID}}"')}),e=e.replace(/[\n]+/g," ").replace(/[ ]{2,}/g," "),e=e.replace(/'/g,"\\'"),e=e.replace(Lure._CompileSmart.IfInlineSelect,function(e,r){return e.replace(r,"&lt;")}),e=Lure._CompileSmart.CompilePart.Editable(e,r),e=Lure._CompileSmart.CompilePart.IfInline(e,r),e=Lure._CompileSmart.CompilePart.If(e,r),e=Lure._CompileSmart.CompilePart.Each(e,r),e=Lure._CompileSmart.CompilePart.Prepare(e,r),t+=e+"`;",t=t.replace(/`/g,"'").replace(/\${([^}]*)}/g,function(e,r){return"'+"+r+"+'"});var n=void 0;try{n=new Function("o","p",t),n({},{})}catch(i){console.info(t),console.error(i)}return n},GetContentElements:function(e){var r=Lure.SelectAll("*:not(g):not(path):not(clipPath):not(text):not(br)",e).Where(function(){return!0});return r.push(e),r},TagScreen:function(e){return e.replace(/</g,"lt;").replace(/>/g,"gt;")},TagUnscreen:function(e){return e.replace(/lt;/g,"<").replace(/gt;/g,">")},TableScreen:function(e){return e.replace(/<\/?(tr|td|th|thead|tbody|table)[^>]*>/gi,function(e,r){return e.replace(r,"l-"+r)})},TableUnscreen:function(e){return e.replace(/<\/?(l-tr|l-td|l-th|l-thead|l-tbody|l-table)[^>]*>/gi,function(e,r){return e.replace("l-","")})},FilterEachIf:function(e){for(var r=[],t=[],n=Lure._CompileSmart.RegExp.Each.exec(e),i=Lure._CompileSmart.RegExp.If.exec(e);null!==n;)r.push(n),n=Lure._CompileSmart.RegExp.Each.exec(e);for(;null!==i;)t.push(i),i=Lure._CompileSmart.RegExp.If.exec(e);var l=0;if(r.length>0)for(var a=r.length-1;a>=0;a--){var o=r[a],u=!1,p=o.index,c=e.indexOf("{{#endeach}}",p),m=e.slice(0,p).match(Lure._CompileSmart.RegExp.Each);m=null!==m?m.length:0;var s=e.slice(0,p).match(/{{#endeach}}/g);if(s=null!==s?s.length:0,l>0)for(var d=l,g=0;g<d;g++)c=e.indexOf("{{#endeach}}",c+12),l--;m>s&&(u=!0,l+=m-s);var f=e.slice(p,c+12);e=e.replace(f,Lure._CompileSmart.TagScreen(f))}if(l=0,null!==t)for(var L=t.length-1;L>=0;L--){var h=t[L],C=!1,S=h.index,E=e.indexOf("{{#endif}}",S),v=e.slice(0,S).match(Lure._CompileSmart.RegExp.Each);v=null!==v?v.length:0;var _=e.slice(0,S).match(/{{#endif}}/g);if(_=null!==_?_.length:0,l>0)for(var x=l,b=0;b<x;b++)E=e.indexOf("{{#endif}}",E+10),l--;v>_&&(C=!0,l+=v-_);var I=e.slice(S,E+10);e=e.replace(I,Lure._CompileSmart.TagScreen(I))}return e},FilterOpetators:function(e){var r=e;return r.replace(/{{#(each|if)[\w\s.()]*?}}([\s\S]*?){{#end(each|if)}}/gi,function(e,r,t){return e.replace(t,Lure._CompileSmart.TagScreen(t))})},GenField:function(e,r){for(var t=(r.ID,e.attributes),n={LSElementID:e.attributes["data-lsmarti"].value,Attributes:{},InnerHTML:null},i=0,l=0;l<t.length;l++)t[l].value.indexOf("{{")>-1&&(n.Attributes[t[l].name]=Lure._CompileSmart.Compile(t[l].value,r),i++);var a=e.innerHTML.replace(/[\s]*/g,""),o=(e.childNodes.length<1||e.childNodes.length<2&&e.childNodes[0]&&"text"===e.childNodes[0].constructor.name.toLowerCase())&&a.indexOf("{{")>-1,u="{{#each"===a.substring(0,7).toLowerCase()||"{{#if"===a.substring(0,5).toLowerCase();if(o||u){if(e.classList.contains(Lure.Settings.Editable.ClassEditable)||e.classList.contains(Lure.Settings.Editable.ClassRemovable))e=Lure.CreateElementFromString(Lure._CompileSmart.CompilePart.Editable(e.outerHTML,r)),n.InnerHTML=Lure._CompileSmart.Compile(e.innerHTML,r);else{var p=Lure._CompileSmart.TagUnscreen(e.innerHTML);e.innerHTML="",n.InnerHTML=Lure._CompileSmart.Compile(p,r)}i++}return i>0?n:null},GenFields:function(e,r){for(var t=[],n=0;n<e.length;n++){var i=Lure._CompileSmart.GenField(e[n],r);i&&t.push(i)}return t},SetUp:function(e){return e.replace(/<[\w-_]+ ?/g,function(e){return e+' data-lsmarti="'+Lure.GetID()+'" '})}},Lure.Compile=function(e,r){return Lure._CompileSmart.Compile(e,r)},Lure.CompileSmart=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e=Lure._CompileSmart.FilterEachIf(e),e=Lure._CompileSmart.FilterOpetators(e),e=Lure._CompileSmart.TableScreen(e),e=Lure._CompileSmart.SetUp(e);var t=Lure.CreateElementFromString(e),n=Lure._CompileSmart.Compile(Lure._CompileSmart.TagUnscreen(e),r).bind(r.Owner),i=Lure._CompileSmart.GetContentElements(t),l=Lure._CompileSmart.GenFields(i,r),a=r?r.Target.tagName:"div",o={_Components:l,_Compiled:n,Template:Lure._CompileSmart.TagUnscreen(e),GetContext:function(e,t){for(var n=[],i=0;i<l.length;i++){n[i]={LSElementID:l[i].LSElementID,InnerHTML:l[i].InnerHTML},n[i].Attributes={};for(var a in l[i].Attributes)n[i].Attributes[a]=l[i].Attributes[a]}var o={_Components:n,_TargetElement:t,_LureContent:e,Refresh:function(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=this._Components,n=0;n<t.length;n++)if(t[n].LSElement&&this._TargetElement.contains(t[n].LSElement)||(t[n].LSElement=Lure.Select('[data-lsmarti="'+t[n].LSElementID+'"]',this._TargetElement),t[n].LSElement=null!==t[n].LSElement?t[n].LSElement:this._TargetElement,t[n].LSElement=t[n].LSElement.dataset.lsmarti===t[n].LSElementID?t[n].LSElement:null),t[n].LSElement){t[n].InnerHTML&&(t[n].LSElement.innerHTML=t[n].InnerHTML.call(this._LureContent,e,r));for(var i in t[n].Attributes)if(t[n].Attributes.hasOwnProperty(i))if("value"===i)t[n].LSElement.value=t[n].Attributes[i].call(this._LureContent,e,r);else if("checked"===i||"disabled"===i||"selected"===i){var l=t[n].Attributes[i].call(this._LureContent,e,r);Lure.PropTypes.TryParse(Lure.PropTypes.Bool,l)||"key"===l.toLowerCase()?t[n].LSElement[i]=!0:t[n].LSElement[i]=!1}else t[n].LSElement.setAttribute(i,t[n].Attributes[i].call(this._LureContent,e,r))}}};return r.isLineBuilder||(o.FieldAdd=function(e){e.setAttribute("data-lsmarti",Lure.GetID());var t=Lure._CompileSmart.GenField(e,r);t&&(t.LSElement=e,this._Components.push(t))}),o},GenElement:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Lure.CreateElementFromString(Lure._CompileSmart.TableUnscreen(n(e,r)),a)},GenLine:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Lure._CompileSmart.TableUnscreen(n(e,r))}};return o};
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();Lure.Controller.TemplatorProto=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.Target,a=void 0===i?null:i,n=r.Content,o=void 0===n?null:n,s=r.Data,l=void 0===s?{}:s,u=r.DataClone,h=void 0!==u&&u,c=r.Owner,f=void 0===c?null:c,p=r.OnChange,d=void 0===p?function(){return Promise.resolve(!0)}:p,D=r.BeforeBuild,v=void 0===D?function(){}:D,C=r.AfterBuild,y=void 0===C?function(){}:C,_=r.PropTypes,P=void 0===_?{}:_,L=r.PropFormat,b=void 0===L?{}:L;_classCallCheck(this,t),this.ID=Lure.GetID(),this.Type="proto",this.Owner=f?f:this,this.OnChange=d.bind(this.Owner),this.Settings={},this.Settings.isDataClone=h,this.isEditable=!1,this.Target=Lure.Select(a,f?f.Target:document),this._Data=null,this._DataPrivate=null,this._DataInit=function(t){t&&(e._Data=e.Settings.isDataClone?Lure.Clone(t):t,e._DataPrivate=Lure.Clone(e._Data))},this.Data=l,this.PropTypes=P,this.PropFormat=b,this._SmartRender=Lure.CompileSmart(o,this),this._Refresh=function(t){e.Data=t,Lure.PropTypes.Check(e.PropTypes,e._Data),v.call(e),e.Context.Refresh(e.Data,{LineID:null,Controller:e}),Lure.Editable.EditableForceRefresh(e);var r=e.Owner._PermissionRules;r&&r.Check(),y.call(e)},this.isEditable&&Lure.Editable.ListenEditable(this.Owner,this)}return _createClass(t,[{key:"Refresh",value:function(t){this._Refresh(t)}},{key:"SetProperty",value:function(t,e){Lure.SetProperty(this._Data,t,e),this.PropTypes[t]&&Lure.PropTypes.CheckProp(this._Data,this.PropTypes[t],t),Lure.SetProperty(this._DataPrivate,t,Lure.Object.Clone(Lure.GetProperty(this._Data,t))),this._Refresh()}},{key:"GetProperty",value:function(t){return t?Lure.GetProperty(this._Data,t):this._Data}},{key:"FieldAdd",value:function(t){this.Context.FieldAdd(t)}},{key:"Data",get:function(){return this._Data},set:function(t){this._DataInit(t)}},{key:"isController",get:function(){return!1}}]),t}();
"use strict";function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(i,r){try{var o=t[i](r),s=o.value}catch(l){return void n(l)}return o.done?void e(s):Promise.resolve(s).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();Lure.Controller.Templator=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.Target,i=void 0===a?null:a,r=n.Data,o=void 0===r?[]:r,s=n.DataClone,l=void 0!==s&&s,u=n.PropTypes,D=void 0===u?{}:u,c=n.PropFormat,h=void 0===c?{}:c,g=n.ListElement,d=void 0===g?".list_element":g,f=(n.ListElementEmpty,n.EmptyMessage),_=void 0===f?"":f,v=n.EmptyVisible,p=void 0===v||v,P=n.Pagination,L=void 0===P?{}:P,S=n.LineSave,m=void 0===S?function(e){return Promise.resolve(e)}:S,C=n.LineAdd,R=void 0===C?function(e){return Promise.resolve(e)}:C,y=n.LineRemove,O=void 0===y?function(e){return Promise.resolve(e)}:y,b=n.NoBuild,E=void 0!==b&&b,I=n.BeforeBuild,G=void 0===I?function(){}:I,M=n.AfterBuild,A=void 0===M?function(){}:M,w=n.AfterAdd,B=void 0===w?function(){}:w,k=n.OnChange,T=void 0===k?function(){}:k,x=n.Owner,F=void 0===x?null:x;n.Debug;if(_classCallCheck(this,e),this.ID=Lure.GetID(),this.Type="controller",this.isEditable=!1,this.isRemovable=!1,this._NoBuild=E,this.Owner=F?F:this,this.Content=F?F.Select(i):Lure.Select(i),this.Target=this.Content,!this.Target)throw new Error("[Lure.Controller] Error. Target is null ("+i+') in "'+(F?F.Name:"null")+'"');this.Target.classList.add("l-t-content"),this.Settings=Lure.Clone(Lure.Settings.Controller.Templator),this.Settings.Pagination.PageSize="undefined"!=typeof L.PageSize?L.PageSize:this.Settings.Pagination.PageSize,this.Settings.Pagination.PageGet="undefined"!=typeof L.PageGet?L.PageGet:this.Settings.Pagination.PageGet,this.Settings.Pagination.DataCount="undefined"!=typeof L.DataCount?L.DataCount:this.Settings.Pagination.DataCount,this.Settings.Pagination.isGetAllButton="undefined"!=typeof L.isGetAllButton?L.isGetAllButton:this.Settings.Pagination.isGetAllButton,this.Settings.Pagination.isGetAllCount="undefined"!=typeof L.isGetAllCount?L.isGetAllCount:this.Settings.Pagination.isGetAllCount,this.Settings.Pagination.isGetMoreButton="undefined"!=typeof L.isGetMoreButton?L.isGetMoreButton:this.Settings.Pagination.isGetMoreButton,this.Settings.Pagination.isGetMoreCount="undefined"!=typeof L.isGetMoreCount?L.isGetMoreCount:this.Settings.Pagination.isGetMoreCount,this.Settings.Pagination.isRefreshButton="undefined"!=typeof L.isRefreshButton?L.isRefreshButton:this.Settings.Pagination.isRefreshButton,this.Settings.isDataClone=l,this.Settings.isEmptyVisible=p?p:this.Settings.isEmptyVisible,this.ListElement=d,this.EmptyMessage=_,this.LineSave=m.bind(this.Owner),this.LineAdd=R.bind(this.Owner),this.LineRemove=O.bind(this.Owner),this.OnChange=T.bind(this.Owner),this.AfterAdd=B.bind(this.Owner),this.PropTypes=D,this.PropFormat=h,this._Data=null,this.BeforeBuild=G.bind(this.Owner),this.AfterBuild=A.bind(this.Owner),this._DataPrivate=null,this._DataRender=null,this._DataItems=null,this._GetCurrentData=function(){return t._DataRender},this._DataInit=function(e){e&&(t._DataSet=t.Settings.isDataClone?Lure.Clone(e):e,t._Data=t._DataSet.Select(function(e,t){return{LineID:t,Data:e}}),t._DataDict=t._Data.ToDictionary(function(e){return e.LineID},function(e){return e}),t._DataPrivate=Lure.Clone(t._Data),t._DataPrivateDict=t._DataPrivate.ToDictionary(function(e){return e.LineID},function(e){return e}),t._DataRender=t._Data.slice(0))},this._DataAppend=function(e){for(var n=t._Data.Last().LineID+1,a=0;a<e.length;a++){var i=t._DataSet.push(t.Settings.isDataClone?Lure.Clone(e[a]):e[a])-1,r=n+a,o={LineID:r,Data:t._DataSet[i]};t._Data.push(o),t._DataDict[r]=o,t._DataRender.push(o),t._DataPrivate.push(Lure.Clone({LineID:r,Data:Lure.Clone(t._DataSet[i])})),t._DataPrivateDict[r]=t._DataPrivate[i]}},this._DataPrepend=function(e){for(var n=t._Data[0].LineID-1,a=e.length-1;a>=0;a--){t._DataSet.unshift(t.Settings.isDataClone?Lure.Clone(e[a]):e[a]);var i=n-a,r={LineID:i,Data:t._DataSet[0]};t._Data.unshift(r),t._DataDict[i]=r,t._DataRender.unshift(r),t._DataPrivate.unshift(Lure.Clone({LineID:i,Data:Lure.Clone(t._DataSet[0])})),t._DataPrivateDict[i]=t._DataPrivate[0]}},this.Data=o;var W=0,z=0;this.isPageReverseOnce=!1;var N=0,j=!1,V=null,H=null,Z=1;this._NextPage=function(){W>=t._DataRender.length?t.Settings.Pagination.PageGet.call(t.Owner,W,t.Settings.Pagination.PageSize).then(function(e){(e.length<t.Settings.Pagination.PageSize||t._Data.length+t.Settings.Pagination.PageSize===t.Settings.Pagination.DataCount)&&(j=!0),t.Append(e)}):(!t.Settings.Pagination.PageGet&&W+t.Settings.Pagination.PageSize>=t._DataRender.length&&(j=!0),q())},this._NextAll=function(){j=!0,W>=t._DataRender.length?t.Settings.Pagination.PageGet.call(t.Owner,W,t.Settings.Pagination.DataCount-W).then(function(e){t.Append(e)}):q()},this._SetEditProperty=function(e,n){Lure.SetProperty(t._DataPrivate,e,n);var a=e.replace(/\[[\d]+\]\./,"");t.PropTypes[a]&&Lure.PropTypes.CheckProp(t._DataPrivate,t.PropTypes[a],e)},this._GetEditProperty=function(e){return Lure.GetProperty(t._DataPrivate,e)},this._Filter=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V;return V=e,"function"!=typeof e?(t._DataRender=t._Data.slice(0),void t.Refresh()):(t._DataRender=t._Data.Where(function(t){return e(t.Data)}),t.Refresh(),void(H&&(Z*=-1,t._Sort())))},this._Sort=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H;return Z=H===e&&Z>0?-1:1,H=e,"function"!=typeof e?(V||(t._DataRender=t._Data.slice(0),t.Refresh()),Promise.resolve(0)):(t._DataRender.sort(function(t,n){return e(t.Data,n.Data)*Z}),W=0,q(),Promise.resolve(Z))},this._Add=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=t.Settings.DataClone?Lure.Clone(e):e;var a=Lure.Select(".l-t-empty",t.Content);null!==a&&a.remove();var i=n?0:t._Data.length,r=0;t._Data.length>0&&n?r=Math.min.apply(null,t._Data.Select(function(e){return e.LineID}))-1:t._Data.length>0&&!n&&(r=Math.max.apply(null,t._Data.Select(function(e){return e.LineID}))+1);var o={LineID:r,Data:e};o.DOM=t._SmartRender.GenElement(e,{i:i,length:t._Data.length+1,LineID:o.LineID,Controller:t}),o.DOM.classList.add(Lure.Settings.Editable.ClassWaiting);var s=t.Owner._PermissionRules;return s&&s.CheckLine(o.DOM,o.DOM.Data),n&&t._DataRender.length>0?t.Content.insertBefore(o.DOM,t._DataRender[0].DOM):t.Content.appendChild(o.DOM),Lure.Call(t.LineAdd(o),{Then:function(){W++,o.DOM.classList.remove(Lure.Settings.Editable.ClassWaiting),n?t._Data.unshift(o):t._Data.push(o),n?t._DataRender.unshift(o):t._DataRender.push(o),n?t._DataPrivate.unshift(Lure.Clone(o)):t._DataPrivate.push(Lure.Clone(o)),t._DataDict[o.LineID]=o,t._DataPrivateDict[o.LineID]=n?t._DataPrivate.First():t._DataPrivate.Last(),V&&t.Filter(),H&&!V&&t._Sort(),t.OnChange("add",o)},Catch:function(t){o.DOM.remove(),console.error("[Lure.Templator] Add error item: ",e,"\n",t)}})},this._Remove=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Lure.GetType(e),i=void 0,r=void 0;if(Lure.isNumeric(e))i=parseInt(e),r=t._Data.Where(function(e){return e.LineID===i}).FirstOrDefault();else if("object"===a){if(r=t._Data.Where(function(t){return t.Data===e}).FirstOrDefault(),null===r)return Promise.reject();if(i=r.LineID,null===i)return Promise.reject()}else{if("function"!==a)return Promise.reject();if(r=t._Data.Where(function(t){return e(t.Data)}).FirstOrDefault(),null===r)return Promise.reject();i=r.LineID}if(null===r)return Promise.reject();var o=r.DOM;if(o.classList.add(Lure.Settings.Editable.CSSWaiting),n){o.remove();var s=t._Data.indexOf(r),l=t._DataRender.indexOf(r);return t._Data.splice(s,1),t._DataPrivate.splice(s,1),t._DataRender.splice(l,1),0===t._Data.length&&t.Refresh(),t.OnChange("remove",i),Promise.resolve("local")}return api.call(t.LineRemove(r,o),{Then:function(){o.remove();var e=t._Data.indexOf(r),n=t._DataRender.indexOf(r);t._Data.splice(e,1),t._DataPrivate.splice(e,1),t._DataRender.splice(n,1),0===t._Data.length&&t.Refresh(),t.OnChange("remove",i)},Catch:function(e){o.classList.remove(Lure.Settings.Editable.CSSWaiting),e&&e instanceof Error&&console.error("[Lure.Templator] Remove Error. LineID: "+i,e),e&&console.log("[Lure.Templator] Removing Canceled. LineID: "+i,e)}})},this._Edit=function(e,n,a){var i=t._DataDict[e].DOM;return i.classList.add(Lure.Settings.Editable.ClassWaiting),Lure.Call(t.LineSave(t._DataDict[e],n,a,e),{Then:function(){Lure.SetProperty(t._DataDict[e].Data,n,a),t.OnChange("save",t._DataDict[e],n)},Catch:function(i){console.error('[Lure.Templator] Save Error. LineID: "'+e+'", Property: "'+n+'", Value: "'+a+'"'+i,"\n",t)},Finally:function(){i.classList.remove(Lure.Settings.Editable.CSSWaiting)}})};var $=function(){if(0===W)for(var e=Lure.SelectAll(".l-t-line, .l-t-empty",t.Content),n=0;n<e.length;n++)e[n].remove();if(t.Settings.Pagination.PageSize>0){var a=Lure.Select(".l-t-pagination",t.Content.parentElement);a&&a.remove()}var i=void 0,r=t._DataRender.length;if(N=t.Settings.Pagination.DataCount>0?t.Settings.Pagination.DataCount:t._DataRender.length,t.Settings.Pagination.PageSize>0){t.Settings.Pagination.PageGet||W!==N-t.Settings.Pagination.PageSize||(j=!0);var o=Lure.Select(".l-t-paginator",t.Content);null!==o&&o.remove(),r=j?N:W+t.Settings.Pagination.PageSize,r>N&&(r=N),i=(t.Settings.Pagination.PageGet?t.Settings.Pagination.DataCount:t._DataRender.length)-r,(i>t.Settings.Pagination.PageSize||i<0)&&(i=t.Settings.Pagination.PageSize)}if(0===t._DataRender.length&&t.Settings.isEmptyVisible&&""!==t.EmptyMessage){if(t.Settings.isEmptyVisible&&""!==t.EmptyMessage){var s=t.ListElement.match(/\s?([\w]+) /)[0].replace(/\s/g,""),l=Lure.CreateElementFromString("<"+s+' class="l-t-empty">'+t.EmptyMessage+"</"+s+">",t.Content.tagName);return t.Content.appendChild(l)}!t.Settings.isEmptyVisible&&t.Owner&&t.Owner.Hide()}if(t.isPageReverseOnce&&z>0)for(var u=z;u>=0;u--){t._DataRender[u].DOM=t._SmartRender.GenElement(t._DataRender[u].Data,{i:u,length:r,LineID:t._DataRender[u].LineID,Controller:t}),t._DataRender[u].DOM.setAttribute("data-line",t._DataRender[u].LineID);var D=t.Owner._PermissionRules;D&&D.CheckLine(t._DataRender[u].DOM,t._DataRender[u].Data),t.Content.prepend(t._DataRender[u].DOM)}else for(var c=W;c<r;c++){t._DataRender[c].DOM=t._SmartRender.GenElement(t._DataRender[c].Data,{i:c,length:r,LineID:t._DataRender[c].LineID,Controller:t}),t._DataRender[c].DOM.setAttribute("data-line",t._DataRender[c].LineID);var h=t.Owner._PermissionRules;h&&h.CheckLine(t._DataRender[c].DOM,t._DataRender[c].Data),t.Content.appendChild(t._DataRender[c].DOM)}if(W=r,t.Settings.Pagination.PageSize>0){var g="tbody"===t.Content.tagName.toLowerCase()||"table"===t.Content.tagName.toLowerCase()||"thead"===t.Content.tagName.toLowerCase(),d="div",f="";g&&(d="tr",f=' colspan="'+(Lure.SelectAll("tr:last-child td",t.Content).length+1)+'"');var _=Lure.CreateElementFromString("<"+d+f+' class="l-t-pagination"></'+d+">");if(t.Data.length<t.Settings.Pagination.PageSize||j)t.Settings.Pagination.isRefreshButton&&(_.innerHTML='<button class="button l-button l-t-refresh">'+Lure.Culture.Lang.Refresh+"</button>");else{if(t.Settings.Pagination.isGetMoreButton){var v=Lure.CreateElementFromString('<button class="button l-button l-t-pagination-getmore"><span class="value">'+Lure.Culture.Lang.GetMore+(t.Settings.Pagination.isGetMoreCount?" ("+i+")":"")+'</span><span class="button-loading"></span></button>');v.onclick=function(e){e.currentTarget.disabled=!0,t._NextPage()},_.appendChild(v)}var p=Lure.CreateElementFromString('<button class="button l-button l-t-pagination-getall"><span class="value">'+Lure.Culture.Lang.GetAll+(t.Settings.Pagination.isGetAllCount?" ("+(N-W)+")":"")+'</span><span class="button-loading"></span></button>'),P=t.Settings.Pagination.isGetAllButton&&t.Settings.Pagination.DataCount>0&&t.Settings.Pagination.PageGet,L=t.Settings.Pagination.isGetAllButton&&!t.Settings.Pagination.PageGet;(L||P)&&(p.onclick=function(e){e.currentTarget.disabled=!0,t._NextAll()},_.appendChild(p))}Lure.AddEventListenerGlobal("click",".l-t-refresh",function(){this.Owner.Refresh()},_,t),t.Content.parentElement.appendChild(_),t.isPageReverseOnce=!1}},q=void 0;q="AsyncFunction"===this.BeforeBuild.constructor.name?function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"refresh";return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.BeforeBuild(e);case 2:$(),Lure.Editable.EditableForceRefresh(t),t._DataRender.length>0&&t.AfterBuild(e);case 5:case"end":return n.stop()}},n,t)}));return function(){return e.apply(this,arguments)}}():function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"refresh";t.BeforeBuild(e),$(),Lure.Editable.EditableForceRefresh(t),t._DataRender.length>0&&t.AfterBuild(e)},this.Append=function(e,n){return 0===e.length,t._Data.length<1?(t.Data=e,q("refresh2")):t.isPageReverseOnce?(t._DataPrepend(e),z=e.length-1,q("prepend")):(t._DataAppend(e),void q("append"))},this.BuildWithIt=function(e,n){t.Append(e,n)},this.Redraw=function(){W=0,q()},this.NextPage=function(){t._NextPage()};var J=function(e){e.Context?e.Context._TargetElement=e.DOM:e.Context=t._SmartRender.GetContext(t.Owner,e.DOM),e.Context.Refresh(e.Data,{i:t._DataRender.indexOf(e),length:t._DataRender.length,LineID:e.LineID,Controller:t})},K=function(e){W=0,j=!1,t.Owner&&t.Owner.isContent&&t.Owner.Sort&&null===H&&t.Owner.Sort._Reset(),t.Settings.Pagination.PageGet?(t.Data=[],t._NextPage()):(t.Data=e,q(),H&&(Z*=-1,t._Sort()))},Q=function(e){var n=t._DataRender.Select(function(e){return e.Data}).indexOf(e);J(t._DataRender[n]);var a=t.Owner._PermissionRules;a&&a.CheckLine(t._DataRender[n].DOM,t._DataRender[n].DOM.Data)},U=function(e){var n=t._DataRender.Select(function(e){return e.DOM}).indexOf(e);J(t._DataRender[n])},X=function(e){e=parseInt(e);var n=t._DataRender.Where(function(t){return t.LineID===e}).FirstOrDefault();n&&J(n);var a=t.Owner._PermissionRules;a&&a.CheckLine(n.DOM,n.Data)},Y=function(e){for(var n=t._Data.Where(function(t){return e(t.Data)}).Select(function(e){return e.LineID}),a=0;a<n.length;a++)t.Refresh(n[a])};this._Refresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Lure.GetType(e);switch(t){case null:case"array":K(e);break;case"object":Q(e);break;case"node":U(e);break;case"number":X(e);break;case"function":Y(e)}return Promise.resolve()};var ee=/^[a-zA-Z0-9.,\-_ *#]+$/.test(this.ListElement);if(ee){var te=Lure.Select(d,this.Content);te.classList.add("l-t-line"),this.ListElement=te.outerHTML,te.remove()}else{var ne=this.ListElement.match(/<[^>]+>/)[0],ae=void 0,ie=ne.indexOf('class="');ie<0?ae=ne.substr(0,ne.length-1)+' class="l-t-line"'+ne.substr(ne.length-1):(ie=ne.indexOf('"',ie+8),ae=ne.substr(0,ie)+" l-t-line"+ne.substr(ie)),this.ListElement=this.ListElement.replace(ne,ae)}this.ListElement=this.ListElement.replace(/<[\s\S]+?(>)/,function(e,t){return e.replace(/data-line=('|")[^('|")]*('|")/," ").replace(t,' data-line="{{i}}">')}),this._SmartRender=Lure.CompileSmart(this.ListElement,this),(this.isEditable||this.isRemovable)&&Lure.Editable.ListenEditable(this.Owner,this)}return _createClass(e,[{key:"Refresh",value:function(e){return this._Refresh(e)}},{key:"RefreshOne",value:function(e){return this._RefreshOne(e)}},{key:"Filter",value:function(e,t){return this._Filter(e,t)}},{key:"Sort",value:function(e,t){return this._Sort(e,t)}},{key:"Add",value:function(e,t){return this._Add(e,t)}},{key:"Edit",value:function(e,t,n){return this._Edit(e,t,n)}},{key:"Remove",value:function(e,t){return this._Remove(e,t)}},{key:"SetProperty",value:function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e=parseInt(e);var i=this._Data.Where(function(t){return t.LineID===e}).FirstOrDefault();return i?(Lure.SetProperty(i,t,n),this.PropTypes[t]&&Lure.PropTypes.CheckProp(i,this.PropTypes[t],t),void(a&&this._Refresh(e))):Lure.System.Error("Can not set property of unknown LineID ("+e+")")}},{key:"GetProperty",value:function(e){return Lure.GetProperty(this._Data.Select(function(e){return e.Data}),e)}},{key:"GetItemByLineID",value:function(e){return this._Data.Where(function(t){return t.LineID===e}).Select(function(e){return e.Data}).FirstOrDefault()}},{key:"GetDataItemByLineID",value:function(e){return e=parseInt(e),this._Data.Where(function(t){return t.LineID===e}).FirstOrDefault()}},{key:"GetDataItemByDelegate",value:function(e){return this._Data.Where(function(t){return e(t.Data)}).FirstOrDefault()}},{key:"GetPrivateDataItemByLineID",value:function(e){return void 0===this._DataPrivateDict[e]?null:this._DataPrivateDict[e]}},{key:"Data",get:function(){return this._Data.Select(function(e){return e.Data})},set:function(e){this._DataInit(e)}},{key:"DataItems",get:function(){return this._Data}},{key:"Items",get:function(){return this.Content.children.Where(function(e){return e.classList.contains("l-t-line")})}},{key:"isController",get:function(){return!0}},{key:"isLineBuilder",get:function(){return!0}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Lure.CustomLog=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.Target,i=void 0===n?document.body:n,a=e.Duration,r=void 0===a?500:a,o=e.Timeout,s=void 0===o?5e3:o,u=e.Style,l=void 0===u?{}:u,h=(e.Show,e.Hide,e.isNewInstance),c=void 0!==h&&h;_classCallCheck(this,t),Lure.CustomLog.Count=Lure.CustomLog.Count?Lure.CustomLog.Count++:1,this.Options={Style:{padding:l.padding?l.padding:"10px 20px",marginTop:l.marginTop?l.marginTop:"5px",borderRadius:l.borderRadius?l.borderRadius:"0px",backgroundColor:l.backgroundColor?l.backgroundColor:"#d00",color:l.color?l.color:"#fff"}};var d=void 0;c||(d=Lure.Select("#lure-customlog-1")),(c||null===d)&&(d=document.createElement("div"),d.id="lure-customlog-"+Lure.CustomLog.Count,d.style.position="fixed",d.style.right="5px",d.style.bottom="5px",d.style.zIndex="100"),i.appendChild(d),this.AddLine=function(t){var e=document.createElement("div");e.innerHTML=t;for(var n in this.Options.Style)e.style[n]=this.Options.Style[n];e.style.position="relative",e.style.opacity="0",e.style.transition=r+"ms ease-in";var i=document.createElement("div");i.style.height="5px",i.style.width="100%",i.style.backgroundColor="rgba(0,0,0,0.4)",i.style.position="absolute",i.style.bottom="0",i.style.left="0",i.style.transition=s-50+"ms linear",e.appendChild(i),d.appendChild(e),e.style.opacity="1",setTimeout(function(){i.style.width="0"},50),e.LureTimeout=setTimeout(function(){e.style.opacity="0",setTimeout(function(){e.remove()},r)},s)}},Lure.Settings.Load={Svg:null},Lure.Load=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.Target,i=void 0===n?"body":n,a=(e.SaveOriginalStylePosition,e.BackgroundColor),r=void 0===a?null:a;e.CustomSvg;_classCallCheck(this,t),this._isActive=!1,this.Target=Lure.Select(i);var o=getComputedStyle(this.Target).position.toLowerCase();"absolute"!==o&&"relative"!==o&&(this.Target.style.position="relative"),this.Content=Lure.CreateElementFromString('<div class="lure-loading" style="display: none"></div>'),null!==r&&(this.Content.style.backgroundColor=r);var s=60,u=60;Lure.Settings.Load.Svg?this.Content.innerHTML=Lure.Settings.Load.Svg:this.Content.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">\n                     <path d="'+Lure.Load._DoArc(45,160,s,u)+'" class="lure-arc1" fill="none" stroke="#449b22" stroke-width="5"></path>\n                     <path d="'+Lure.Load._DoArc(40,130,s,u)+'" class="lure-arc2" fill="none" stroke="#61c8de" stroke-width="5"></path>\n                     <path d="'+Lure.Load._DoArc(35,100,s,u)+'" class="lure-arc3" fill="none" stroke="#761c19" stroke-width="5"></path>\n                     <path d="'+Lure.Load._DoArc(30,70,s,u)+'"  class="lure-arc4" fill="none" stroke="#333333" stroke-width="5"></path>\n                   </svg>',this.Target.appendChild(this.Content),this.Timeout=null}return _createClass(t,null,[{key:"_DoArc",value:function(t,e,n,i){for(var a=" M "+(n+t)+" "+i,r=0;r<e;r++){var o=r*(Math.PI/180),s=n+Math.cos(o)*t,u=i+Math.sin(o)*t;a+=" L "+s+" "+u}return a}}]),_createClass(t,[{key:"Show",value:function(){var t=this;this.Content.style.display="",clearTimeout(this.TimeoutHide),this._isActive=!0,this.Timeout=setTimeout(function(){t.Content.style.display="block"},70)}},{key:"Hide",value:function(){var t=this;clearTimeout(this.Timeout),this._isActive=!1,this.TimeoutHide=setTimeout(function(){t.Content.style.display="none"},250)}},{key:"isActive",get:function(){return this._isActive}}]),t}(),Lure._Date=function(){function t(e,n){if(_classCallCheck(this,t),null===e||"undefined"==typeof e)return Lure.System.ShowError("[Lure.Date] Input Date is undefined or null"),console.error(new Error("[Lure.Date] Input Date is undefined or null")),null;if(e instanceof Date)this._Date=new Date(e.valueOf());else if(e instanceof t)this._Date=e._Date;else if(Lure.isNumeric(e)&&!n)this._Date=new Date(parseInt(e));else{var i="DDMMYYYYHHmmss",a=[];n=n?n:Lure.Culture.DateFormatFull;var r=n.replace(/[DMYHms]+/g,function(t,e){if(a.push(t.substring(0,1)),i.indexOf(t)>-1){var n=t.length<2?"0,2":t.length;return"Y"===t&&(n="2,4"),"(\\d{"+n+"})?"}}).replace(/[.-\/ :;]/g,function(t){return t+"?"}),o={Y:0,M:0,D:1,H:0,m:0,s:0},s=0;if(e.replace(new RegExp(r),function(t,e,n,i,r,u,l,h,c){for(var d=[e,n,i,r,u,l,h,c],g=0;g<a.length;g++)o[a[g]]=d[g]?d[g]:o[a[g]],""!==d[g]&&"0"!==d[g]||s++}),o.Y||s++,!o.M&&(o.D||o.H||o.m||o.s)&&s++,(o.M>12||o.H>23||o.m>59||o.s>59)&&s++,this._Date=new Date(o.Y,o.M-1,o.D,o.H,o.m,o.s),!Lure.Date.isDateValid(this._Date)||s>0){var u=e.match(/Date\(([\d]+)(\+\d{4})\)/);u&&(this._Date=new Date(parseInt(u[1]))),s=0}(!Lure.Date.isDateValid(this._Date)||s>0)&&(this._Date=new Date(e)),(!Lure.Date.isDateValid(this._Date)||s>0)&&(Lure.System.ShowError("[Lure.Data] Can not parse properly input Data"),console.error('[Lure.Data] Parse Error. Can not parse properly input Data "'+e+'"'))}}return _createClass(t,[{key:"Format",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lure.Culture.DateFormatFull,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Lure.Date.Format(this._Date,t,e)}},{key:"AddSeconds",value:function(t){return this._Date.setSeconds(this._Date.getSeconds()+t),this}},{key:"AddMinutes",value:function(t){return this._Date.setMinutes(this._Date.getMinutes()+t),this}},{key:"AddHours",value:function(t){return this._Date.setHours(this._Date.getHours()+t),this}},{key:"AddDays",value:function(t){return this._Date.setDate(this._Date.getDate()+t),this}},{key:"AddMonths",value:function(t){var e=this._Date.getDate(),n=new Date(this._Date.getFullYear(),this._Date.getMonth()+t+1,0).getDate();return n>=e?this._Date.setMonth(this._Date.getMonth()+t):(this._Date.setMonth(this._Date.getMonth()+t),this.AddDays(n-e)),this}},{key:"SetDayStart",value:function(){return this._Date.setHours(0,0,0,0),this}},{key:"SetDayEnd",value:function(){return this._Date.setHours(23,59,59,997),this}},{key:"SetWeekStart",value:function(){var t=this._Date.getDay();return t=0!==t?t-1:6,this._Date=this.AddDays(-t).DayStart,this}},{key:"SetWeekEnd",value:function(){var t=this._Date.getDay();return t=0!==t?t-1:6,this._Date=this.AddDays(6-t).DayEnd,this}},{key:"SetMonthStart",value:function(){return this._Date.setDate(1),this._Date.setHours(0,0,0,0),this}},{key:"SetMonthEnd",value:function(){return this._Date.setDate(this.CountDays),this._Date.setHours(23,59,59,997),this}},{key:"SetQuarterStart",value:function(){var t=Math.floor(this.Month/3);return this._Date.setMonth(3*t),this._Date.setDate(1),this._Date.setHours(0,0,0,0),this}},{key:"SetQuarterEnd",value:function(){var t=Math.floor(this.Month/3);return this._Date.setMonth(3*t+2),this._Date.setDate(this.CountDays),this._Date.setHours(23,59,59,997),this}},{key:"SetYearStart",value:function(){return this._Date=new Date(this._Date.getFullYear(),0,1),this}},{key:"SetYearEnd",value:function(){return this._Date=new Date(this._Date.getFullYear(),0,1,23,59,59,997),this}},{key:"CountDays",get:function(){var t=this._Date.getMonth(),e=this._Date.getFullYear();return new Date(e,t+1,0).getDate()}},{key:"DayStart",get:function(){var t=new Date(this._Date.getTime());return t.setHours(0,0,0,0),t}},{key:"DayEnd",get:function(){var t=new Date(this._Date.getTime());return t.setHours(23,59,59,997),t}},{key:"WeekStart",get:function(){var t=this._Date.getDay();return t=0!==t?t-1:6,this.AddDays(-t).DayStart}},{key:"WeekEnd",get:function(){var t=this._Date.getDay();return t=0!==t?t-1:6,this.AddDays(6-t).DayEnd}},{key:"MonthStart",get:function(){var t=new Date(this._Date.getTime());return t.setDate(1),t.setHours(0,0,0,0),t}},{key:"MonthEnd",get:function(){var t=new Date(this._Date.getTime());return t.setDate(Lure.Date(t).CountDays),t.setHours(23,59,59,997),t}},{key:"QuarterStart",get:function(){var t=new Date(this._Date.getTime()),e=Math.floor(t.getMonth()/3);return t.setMonth(3*e),t.setDate(1),t.setHours(0,0,0,0),t}},{key:"QuarterEnd",get:function(){var t=new Date(this._Date.getTime()),e=Math.floor(t.getMonth()/3);return t.setMonth(3*e+2),t.setDate(this.CountDays),t.setHours(23,59,59,997),t}},{key:"YearStart",get:function(){return new Date(this._Date.getFullYear(),0,1)}},{key:"YearEnd",get:function(){return new Date(this._Date.getFullYear(),11,31,23,59,59,997)}},{key:"Date",get:function(){return this._Date}},{key:"Int",get:function(){return this._Date.valueOf()}},{key:"Value",get:function(){return this._Date.valueOf()}},{key:"DateCs",get:function(){return"/Date("+ +this.Value+this.Format("Z")+")/"}},{key:"Milliseconds",get:function(){return this._Date.getMilliseconds()}},{key:"Seconds",get:function(){return this._Date.getSeconds()}},{key:"Minutes",get:function(){return this._Date.getMinutes()}},{key:"Hours",get:function(){return this._Date.getHours()}},{key:"Day",get:function(){return this._Date.getDate()}},{key:"DayOfWeek",get:function(){return this._Date.getDay()}},{key:"Month",get:function(){return this._Date.getMonth()}},{key:"Year",get:function(){return this._Date.getFullYear()}},{key:"isToday",get:function(){return this.isCurrentDay}},{key:"isCurrentDay",get:function(){var t=new Date,e=this._Date.getDate(),n=this._Date.getMonth(),i=this._Date.getFullYear();return e===t.getDate()&&n===t.getMonth()&&i===t.getFullYear()}},{key:"isCurrentMonth",get:function(){var t=this._Date.getMonth(),e=this._Date.getFullYear(),n=new Date;return t===n.getMonth()&&e===n.getFullYear()}}]),t}(),Lure.Date=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=arguments[1];return null===t&&(t=new Date,console.warn("[Lure.Date] Date is null")),new Lure._Date(t,e)},Lure.Date.Format=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD.MM.YYYY HH:mm:ss",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null===t||"undefined"==typeof t)return"";var i=t.getDay();i=0!==i?i-1:7;var a=t.getDate(),r=t.getMonth()+1,o=t.getFullYear(),s=t.getHours(),u=t.getMinutes(),l=t.getSeconds(),h=t.getTimezoneOffset()/-.6,c=4-h.toString().length;return c>0&&(h="0".repeat(c)+h),e=e.replace(/[DdMmYyHhSsZz]/g,"%$&"),e.replace(/%D%D/g,a.toString().length<2?"0"+a:a).replace(/%D/g,a).replace(/%d%d%d%d/g,Lure.Culture.WeekDays[i]).replace(/%d%d%d/g,Lure.Culture.WeekDaysShort[i]).replace(/%M%M%M%M%M/g,Lure.Culture.MonthNamesBanded[r-1]).replace(/%M%M%M%M/g,n?Lure.Culture.MonthNamesBanded[r-1]:Lure.Culture.MonthNames[r-1]).replace(/%M%M%M/g,Lure.Culture.MonthNamesShort[r-1]).replace(/%M%M/g,r.toString().length<2?"0"+r:r).replace(/%M/g,r).replace(/%Y%Y%Y%Y/g,o).replace(/%Y%Y/g,o.toString().substring(2,4)).replace(/%Y/g,o).replace(/%H%H/g,s.toString().length<2?"0"+s:s).replace(/%h%h/g,(s%12).toString().length<2?"0"+s%12:s%12).replace(/%H/g,s).replace(/%h/g,s%12).replace(/%m%m/g,u.toString().length<2?"0"+u:u).replace(/%m/g,u).replace(/%s%s/g,l.toString().length<2?"0"+l:l).replace(/%s/g,l).replace(/%Z/g,"+"+h)},Lure.Date.isDateValid=function(t){return"[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime())},Lure._Draggable=function e(t){function n(t){h=p,f=h.getBoundingClientRect(),y=h.offsetTop-f.y,v=h.offsetLeft-f.x,g=c-h.offsetLeft,D=d-h.offsetTop}var i=this,a=t.Target,r=void 0===a?null:a,o=t.Content,s=void 0===o?null:o,u=t.Options,l=void 0===u?{OnMove:function(){},OnDrop:function(){},Grid:[1,1],Containment:null}:u;_classCallCheck(this,e),this.Target=Lure.Select(r),this.Content=s?Lure.Select(s):this.Target,this.Parent=this.Content.parentElement,this.Content.style.position="absolute",this.Options={Grid:l.Grid?l.Grid:[1,1],isGridHard:!!l.isGridHard&&l.isGridHard,Containment:l.Containment?l.Containment:["auto","auto","auto","auto"]};var h=void 0,c=void 0,d=void 0,g=void 0,D=void 0,p=this.Content,f=this.Content.getBoundingClientRect(),y=this.Content.offsetTop-f.y,v=this.Content.offsetLeft-f.x,m=0,_=0,C=function(t){if(t.pageX&&(c=t.pageX,d=t.pageY),h){var e=h.getBoundingClientRect(),n=h.offsetTop-e.y,a=h.offsetLeft-e.x;m=n-y,_=a-v;var r=c-g+_,o=d-D+m;f=e,i.Options.Grid[0]&&i.Options.isGridHard&&c!==g&&(r=Lure.RoundBy(r,i.Options.Grid[0],c<g)),i.Options.Grid[1]&&i.Options.isGridHard&&d!==D&&(o=Lure.RoundBy(o,i.Options.Grid[1],d<D)),"auto"!==i.Options.Containment[0]&&r<i.Options.Containment[0]&&(r=i.Options.Containment[0]),"auto"!==i.Options.Containment[1]&&o<i.Options.Containment[1]&&(o=i.Options.Containment[1]),"auto"!==i.Options.Containment[2]&&r+h.clientWidth>i.Options.Containment[2]&&(r=i.Options.Containment[2]-h.clientWidth),"auto"!==i.Options.Containment[3]&&o+h.clientHeight>i.Options.Containment[3]&&(o=i.Options.Containment[3]-h.clientHeight),h.style.left=r+"px",h.style.top=o+"px",l.OnMove&&l.OnMove(t)}},L=function(t){if(h){if(h&&!i.Options.isGridHard){var e=c-g+_,n=d-D+m;i.Options.Grid[0]&&c!==g&&(e=Lure.RoundBy(e,i.Options.Grid[0],c<g)),i.Options.Grid[1]&&d!==D&&(n=Lure.RoundBy(n,i.Options.Grid[1],d<D)),"auto"!==i.Options.Containment[0]&&e<i.Options.Containment[0]&&(e=i.Options.Containment[0]),"auto"!==i.Options.Containment[1]&&n<i.Options.Containment[1]&&(n=i.Options.Containment[1]),"auto"!==i.Options.Containment[2]&&e+h.clientWidth>i.Options.Containment[2]&&(e=i.Options.Containment[2]-h.clientWidth),"auto"!==i.Options.Containment[3]&&n+h.clientHeight>i.Options.Containment[3]&&(n=i.Options.Containment[3]-h.clientHeight),h.style.left=e+"px",h.style.top=n+"px"}h=!1,l.OnDrop&&l.OnDrop(t)}};this.Target.addEventListener("mousedown",n),document.addEventListener("mousemove",C),document.addEventListener("mouseup",L),this.Target.LureDraggable=this},Lure.Draggable=function(t,e,n){return new Lure._Draggable({Target:t,Content:e,Options:n})},Lure.Listener=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.Target,i=void 0===n?null:n,a=(e.Type,e.Freq),r=void 0===a?20:a,o=e.Delay,s=void 0===o?0:o,u=e.OnEvent,l=void 0===u?function(){}:u;_classCallCheck(this,t),this.Target=Lure.Select(i),this.Type="resize",this.Freq=r,this.Delay=s,this.OnEvent=l,this._Interval=null,this._TimeOut=null,this.Width=this.Target.clientWidth,this.Height=this.Target.clientHeight,this._Timer=0,this.Run()}return _createClass(t,[{key:"Run",value:function(){var t=this;this.Stop(),this._Interval=setInterval(function(){t._Listen()},this.Freq)}},{key:"Stop",value:function(){clearInterval(this._Interval),clearTimeout(this._TimeOut)}},{key:"_Listen",value:function(){var t=this.Target.clientWidth;if(t!==this.Width)return this.Width=t,this._OnEvent("width");var e=this.Target.clientHeight;return e!==this.Height?(this.Height=e,this._OnEvent("height")):void 0}},{key:"_OnEvent",value:function(){var t=this;clearTimeout(this._TimeOut),this._TimeOut=setTimeout(function(){t.OnEvent()},this.Delay)}}]),t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();"undefined"==typeof Lure&&console.error("[Lure] Lure core is not defined"),"undefined"==typeof Lure.Date&&console.error("[Lure] Lure.Date is not defined"),Lure.PeriodPicker=function(){function t(e){var i=this,n=e.Target,a=void 0===n?null:n,s=e.DateTarget,r=void 0===s?new Date:s,o=e.DateRange,l=void 0===o?null:o,u=e.TargetImmutable,d=void 0!==u&&u,c=e.NoSelect,h=void 0!==c&&c,D=e.NoRange,p=void 0!==D&&D,g=e.NoWeekDays,v=void 0!==g&&g,f=e.WeekSelection,S=void 0===f||f,L=e.Cells,y=void 0===L?[1,3]:L,m=e.Min,C=void 0===m?null:m,_=e.Max,M=void 0===_?null:_,k=e.Format,w=void 0===k?Lure.Culture.DateFormat:k,T=e.Animation,b=void 0===T?null:T,A=e.BeforeShow,x=void 0===A?function(){}:A,E=e.OnConfirm,Y=void 0===E?function(){}:E,H=e.DirectConfirm,F=void 0!==H&&H,R=(e.ButtonConfirm,e.AutoConfirm),O=void 0!==R&&R,W=e.Locale,P=void 0===W?Lure.Settings.Locale:W,$=e.Fullscreen,B=void 0!==$&&$,I=e.ButtonFullscreen,G=void 0===I||I;_classCallCheck(this,t),this.isActive=!1,this.Settings=Lure.Clone(Lure.Settings.PeriodPicker.DefaultSettings),this.Settings.Format=w,this.Settings.isOneDaySelection=p,this.Settings.isAutoConfirm=O,this.Settings.isDirectConfirm=F,this.Settings.isWeekSelection=S&&!this.Settings.isOneDaySelection,this.Settings.isTargetImmutable=d,this.Settings.Lang=Lure.Settings.PeriodPicker.CultureInfo[P],this.Settings.Cells=[y[0],y[1]],this.Min=C,this.Max=M,b&&(b.Show&&(this.Settings.Animation.Show=b.Show),b.Hide&&(this.Settings.Animation.Hide=b.Hide)),this.Settings.Animation._DurationShow=Lure.GetDurationAnimation(this.Settings.Animation.Show,this.Content),this.Settings.Animation._DurationHide=Lure.GetDurationAnimation(this.Settings.Animation.Hide,this.Content),this.DateTarget=r?r:new Date,this._Date=[],l?(l[0]&&l[0]instanceof Date&&(this._Date[0]=Lure.Date(l[0]).DayStart),l[1]&&l[1]instanceof Date&&(this._Date[1]=Lure.Date(l[1]).DayEnd),l[0]>l[1]&&(this._Date=[Lure.Date(l[1]).DayStart,Lure.Date(l[0]).DayEnd])):h?this._Date=[null,null]:this._Date=[Lure.Date(r).DayStart,Lure.Date(r).DayEnd],this.Target=Lure.Select(a),this.Target.classList.add("l-pp-target"),this.Target.classList.add("pointer"),this.Content=Lure.CreateElementFromString('<div class="lure-periodpicker '+(B?"l-pp-fullscreen":"")+'" style="display: none">\n                                <div class="l-pp-head">'+this.Settings.Lang.ChoosePeriod+'</div>\n                                <div class="close l-close black"></div>\n                                <div class="l-pp-controls row">\n                                    '+(G?'<div class="l-pp-btn-fullscreen"></div>':"")+'\n                                </div>\n                                <div class="col">\n                                    <div class="l-pp-work-area row">\n                                        <div class="l-pp-arrow l-pp-arrow-left pointer"></div>\n                                        <div class="l-pp-content"></div>\n                                        <div class="l-pp-arrow l-pp-arrow-right pointer"></div>\n                                    </div>\n                                    <div class="l-pp-bottom row flex-between">\n                                        <div class="null"></div>\n                                        <div class="l-pp-selected-range row">\n                                            <div class="l-pp-input-datestart flex flexa-center">\n                                                <input class="l-textbox" type="text">\n                                            </div>\n                                            <div class="flex flexa-center flex-center" style="width: 30px">\n                                                <div> — </div>\n                                            </div>\n                                            <div class="l-pp-input-dateend flex flexa-center">\n                                                <input class="l-textbox" type="text">\n                                            </div>\n                                        </div>\n                                        <div class="button-holder row flex-end">\n                                            <button class="button btn-l-pp-ok">'+this.Settings.Lang.Ok+"</button>\n                                        </div>\n                                    </div>\n                                </div>\n                              </div>"),document.body.appendChild(this.Content);var N=Lure.Select(".l-pp-head",this.Content),V=Lure.Select(".close",this.Content),U=Lure.Select(".l-pp-btn-fullscreen",this.Content),z=Lure.Select(".btn-l-pp-ok",this.Content),j=Lure.Select(".l-pp-input-datestart input",this.Content),q=Lure.Select(".l-pp-input-dateend input",this.Content),J=Lure.Select(".l-pp-content",this.Content);Lure.Draggable&&Lure.Draggable(N,this.Content);var K=v?"":'<div class="l-pp-weekdays-row row">\n                                            '+(this.Settings.isWeekSelection?'<div class="l-pp-month-cell"> </div>':"")+'\n                                            <div class="l-pp-weekdays-cell">'+Lure.Culture.WeekDaysShort[0]+'</div>\n                                            <div class="l-pp-weekdays-cell">'+Lure.Culture.WeekDaysShort[1]+'</div>\n                                            <div class="l-pp-weekdays-cell">'+Lure.Culture.WeekDaysShort[2]+'</div>\n                                            <div class="l-pp-weekdays-cell">'+Lure.Culture.WeekDaysShort[3]+'</div>\n                                            <div class="l-pp-weekdays-cell">'+Lure.Culture.WeekDaysShort[4]+'</div>\n                                            <div class="l-pp-weekdays-cell dayoff">'+Lure.Culture.WeekDaysShort[5]+'</div>\n                                            <div class="l-pp-weekdays-cell dayoff">'+Lure.Culture.WeekDaysShort[6]+"</div>\n                                          </div>",Q=null,X=0,Z=[null,null],tt={Target:Lure.Compile('{{$g.Lure.Date($this[0]).Format("'+this.Settings.Format+'")}} - {{$g.Lure.Date($this[1]).Format("'+this.Settings.Format+'")}}'),TargetSingle:Lure.Compile('{{$g.Lure.Date($this).Format("'+this.Settings.Format+'")}}'),MonthDay:Lure.Compile('<div class="l-pp-month-cell {{Deny}} {{Selected}} {{SelectedTemp}} {{Day}}" data-value="{{$g.Lure.Date(o.Date).Format(\'DD.MM.YYYY\')}}">{{$g.Lure.Date(o.Date).Format("DD")}}</div>'),MonthRow:Lure.Compile('<div class="l-pp-month-row row">\n                                       '+(this.Settings.isWeekSelection?'<div class="l-pp-week-select">|</div>':"")+"\n                                       {{$this}}\n                                     </div>"),Month:Lure.Compile('<div class="l-pp-month-block">\n                                       '+K+'\n                                       <div class="l-pp-month-name '+(this.Settings.isOneDaySelection?"":"pointer")+'" data-value="{{$g.Lure.Date(o.Date).Format(\'MM.YYYY\')}}">{{$g.Lure.Date(o.Date).Format(\'MMMM YYYY\')}}</div>\n                                       <div class="l-pp-month col">{{Data}}</div>\n                                     </div>'),BuildMonth:function(t){for(var e=new Date(t.getFullYear(),t.getMonth(),1),i=t.getMonth(),n="",a="";e.getMonth()===i;){var s=e.getDay(),r=e>=this._Date[0]&&e<=this._Date[1]&&(0===X||this.Settings.isDirectConfirm||this.Settings.isOneDaySelection)?"selected":"",o="",l="";Z[0]&&1===X&&!this.Settings.isOneDaySelection&&(o=e>=Z[0]&&e<=Lure.Date(Z[0]).DayEnd?"l-pp-selection-active":""),(this.Min&&e<this.Min||this.Max&&e>this.Max)&&(l="l-pp-deny"),a+=tt.MonthDay({Date:e,Day:0===s||6===s?"dayoff":"",Selected:r,SelectedTemp:o,Deny:l}),0===s&&(n+=tt.MonthRow(a),a=""),e=Lure.Date(e).AddDays(1).Date}return n+=a?tt.MonthRow(a):"",tt.Month({Date:Lure.Date(e).AddDays(-1).Date,Data:n})}.bind(this),TargetCaption:function(){return i._Date[0]?i.Settings.isOneDaySelection?tt.TargetSingle(i._Date[0]):tt.Target(i._Date):i.Settings.isOneDaySelection?i.Settings.Lang.ChooseDay:i.Settings.Lang.ChoosePeriod},Build:function(){for(var t="",e=0,i=0;i<this.Settings.Cells[0];i++){t+='<div class="row">';for(var n=0;n<this.Settings.Cells[1];n++)t+=tt.BuildMonth(Lure.Date(this.DateTarget).AddMonths(e).Date),e++;t+="</div>"}this.Settings.Cells[0]&&this.Settings.Cells[1]||(t+=tt.BuildMonth(this.DateTarget)),J.innerHTML=t,this._UpdateDateView()}.bind(this)};this._UpdateDateView=function(){i.Settings.isTargetImmutable||(i.Target.innerHTML=tt.TargetCaption()),j.value=i._Date[0]?Lure.Date(i._Date[0]).Format(w):"",q.value=i._Date[1]?Lure.Date(i._Date[1]).Format(w):""},this._Builder=tt;var et=function(){if(!i.Settings.isOneDaySelection&&!i.Settings.isDirectConfirm){if(!i._Date[0]&&!Z[0])return Lure.ErrorHint(j,"Выберите начальную дату");if(!Z[1]&&X>0)return Lure.ErrorHint(q,"Выберите конечную дату")}Y.call(i,i.Date),i._Hide()},it=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z[1];return Z[0]=t,Z[1]=e,i.Settings.isOneDaySelection?(i._Date[0]=Lure.Date(Z[0]).DayStart,i._Date[1]=Lure.Date(Z[0]).DayEnd,i.Refresh(),i.Settings.isAutoConfirm?et():(i.Settings.isDirectConfirm&&Y.call(i,i.Date),void(X=0))):i.Settings.isDirectConfirm?(i._Date[0]=t?Lure.Date(t).DayStart:i._Date[0],i._Date[1]=e?Lure.Date(e).DayEnd:Lure.Date(t).DayEnd,i._Date[0]>i._Date[1]&&(i._Date=[Lure.Date(i._Date[1]).DayStart,Lure.Date(i._Date[0]).DayEnd]),i.Refresh(),void Y.call(i,i.Date)):(e&&(i._Date[0]=t?Lure.Date(t).DayStart:i._Date[0],i._Date[1]=e?Lure.Date(e).DayEnd:i._Date[1],i._Date[0]>i._Date[1]&&(i._Date=[Lure.Date(i._Date[1]).DayStart,Lure.Date(i._Date[0]).DayEnd]),i.Refresh(),i.Settings.isAutoConfirm&&et()),void i.Refresh())},nt=function(t){var e=Lure.Date(t,"DD.MM.YYYY").Date;switch(X){case 0:Z[0]=e,Z[1]=null,X++;break;case 1:Z[1]=e,X=0}it()},at=function(){if(i.Content.classList.contains("l-pp-fullscreen"))return i.Settings.Cells=[y[0],y[1]],i.Content.classList.remove("l-pp-fullscreen"),i.Refresh();i.Content.classList.add("l-pp-fullscreen");var t=Lure.Select(".l-pp-month-block",i.Content),e=t.offsetWidth,n=t.offsetHeight,a=document.body.offsetWidth,s=document.body.offsetHeight;i.Settings.Cells=[Math.floor((s-70)/n),Math.floor((a-50)/e)],i.Refresh()};this._Show=function(t){x.call(i),i.DateTarget=i._Date[0]?i._Date[0]:new Date,i.isActive=!0,X=0,Z=[null,null],i.Refresh(),i.Content.style.zIndex=Lure._Dialog.zIndex+1,Q=Lure.AsyncToggle(i,t,i.Content,function(){i.Content.style.display=""},function(){},i.Settings.Animation.Hide,i.Settings.Animation.Show,i.Settings.Animation._DurationShow,Q)},this._Hide=function(t){i.isActive=!1,Q=Lure.AsyncToggle(i,t,i.Content,function(){},function(){this.Content.style.display="none"},i.Settings.Animation.Show,i.Settings.Animation.Hide,i.Settings.Animation._DurationHide,Q)},this._Refresh=function(){tt.Build()},this.Target.addEventListener("click",function(){i.Toggle()}),N.ondblclick=function(){at()},V.onclick=function(){i._Hide()},U&&(U.onclick=function(){at()}),Lure.AddEventListenerGlobal("click",".l-pp-month-cell, .l-pp-week-select",function(t){if(!t.currentTarget.classList.contains("l-pp-deny")){if(t.currentTarget.classList.contains("l-pp-week-select")){var e=Lure.Select(".l-pp-month-cell",t.currentTarget.parentNode).dataset.value,i=Lure.Date(e,"DD.MM.YYYY");X=0;var n=i.WeekStart,a=i.WeekEnd;if(this.Min&&a<this.Min||this.Max&&n>this.Max)return;return this.Min&&n<this.Min&&(n=Lure.Date(this.Min).DayStart),this.Max&&a>this.Max&&(a=Lure.Date(this.Max).DayEnd),it(n,a)}nt(t.currentTarget.dataset.value)}},this.Content,this),Lure.AddEventListenerGlobal("click",".l-pp-month-name",function(t){if(!this.Settings.isOneDaySelection){X=0;var e=Lure.Date(t.currentTarget.dataset.value,"MM.YYYY").Date,i=Lure.Date(e).MonthStart,n=Lure.Date(e).MonthEnd;this.Min&&n<this.Min||this.Max&&i>this.Max||(this.Min&&i<this.Min&&(i=Lure.Date(this.Min).DayStart),this.Max&&n>this.Max&&(n=Lure.Date(this.Max).DayEnd),it(i,n))}},this.Content,this),Lure.AddEventListenerGlobal("click",".l-pp-arrow",function(t){t.currentTarget.classList.contains("l-pp-arrow-left")?this.DateTarget=Lure.Date(this.DateTarget).AddMonths(-1).Date:this.DateTarget=Lure.Date(this.DateTarget).AddMonths(1).Date,this.Refresh()},this.Content,this),J.addEventListener("wheel",function(t){t.preventDefault(),t.deltaY>0?this.DateTarget=Lure.Date(this.DateTarget).AddMonths(-1).Date:this.DateTarget=Lure.Date(this.DateTarget).AddMonths(1).Date,this.Refresh()}.bind(this)),z.addEventListener("click",function(){et()}),document.addEventListener("click",function(t){if(this.isActive&&t.target!==this.Content&&!t.target.closest(".lure-periodpicker"))return this.Hide()}.bind(this),!0),tt.Build()}return _createClass(t,[{key:"Reset",value:function(){this.Date=[null,null],this._Refresh()}},{key:"Refresh",value:function(){this._Refresh()}},{key:"Hide",value:function(){this._Hide()}},{key:"Show",value:function(){this._Show()}},{key:"Toggle",value:function(){return this.isActive?this._Hide():void this._Show()}},{key:"Date",get:function(){return this.Settings.isOneDaySelection?this._Date[0]:this._Date},set:function(t){return this.Settings.isOneDaySelection?void(this._Date=[Lure.Date(t).DayStart,Lure.Date(t).DayEnd]):(this._Date[0]=t[0],this._Date[1]=t[1],t[0]>t[1]&&(this._Date=[Lure.Date(t[1]).DayStart,Lure.Date(t[0]).DayEnd]),void this._UpdateDateView())}}],[{key:"Version",get:function(){return"v0.1.0"}}]),t}(),Lure.Settings.PeriodPicker={DefaultSettings:{Animation:{Show:"l-animation_periodpicker-show",Hide:"l-animation_periodpicker-hide"}},CultureInfo:{en:{ChoosePeriod:"Select period",ChooseDay:"Select day",Ok:"Ok"},ru:{ChoosePeriod:"Выберите период",ChooseDay:"Выберите день",Ok:"Ок"}}};
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();"undefined"==typeof Lure&&console.error("[Lure] Lure core is not defined"),Lure.Content=function(){function t(e){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bt,e=this,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,arguments.length>2&&void 0!==arguments[2]?arguments[2]:f);if(this.Name=this.Name?this.Name:i,this.Parent=this.Parent?this.Parent:t,this.Type=S,this.isRoot&&Lure.ContentList._Root.push(this),this.Control=new Lure._Content.Control(lt,this),Lure.Settings.Content.Permission.Strict&&this._Permission&&this._Permission.Check(),Lure.Settings.Content.Permission.Strict&&this._Permission&&!this._Permission.isAllow)return void(this.isActive=!1);if(Lure.Settings.Content.Permission.Strict&&this.Parent&&this.Parent._Permission&&!this.Parent._Permission.isAllow)return void(this.isActive=!1);if(this.Parent&&(this.Target=v?Lure.Select(l):Lure.Select(l,this.Parent.Content),this.Target=this.Target?this.Target:this.Parent.Content),this.Target=this.Target?this.Target:Lure.Select(l),!this.Target)return Lure.System.ShowError("[Lure.Content] Target is not defined"),console.error(new Error("[Lure.Content] Target is not defined"),"\n",u),null;try{if(u)if(null===u.match(/<[^>]+>/))Lure.GetFileText(u).then(function(t){n.call(e,t),o.call(e)})["catch"](function(){Lure.System.Error("[Lure.Content] Error. Can not get file")});else{if(!n.call(this,u))return null;o.call(this)}else this.Content=this.Target,o.call(this)}catch(r){console.error(r,this.ID,this)}for(var s in this)this.hasOwnProperty(s)&&!vt.hasOwnProperty(s)&&"Parent"!==s&&this[s]&&this[s].isContent&&this[s]._Init&&this[s]._Init();this._Init=null}function n(t){St.call(this),ct.call(this),this.Controller={Data:[],Refresh:function(){}};for(var e in nt)nt.hasOwnProperty(e)&&!function(){var t=nt[e];nt[e]=function(e,i){return"undefined"==typeof e&&(!i||Object.keys(i).length<1)?Lure.Settings.Controller.Common.Undefined:t.call(this,e,i)}}();Q&&(Y&&(Q=Y),this.Proto=new Lure.Controller.TemplatorProto({Target:this.Target,Content:t,Data:Q,OnChange:$,PropTypes:et,PropFormat:nt,Owner:this}),this.Content=this.Proto._SmartRender.GenElement(Q,{RenderAnyway:!0,Controller:this.Proto}),this.Proto.Context=this.Proto._SmartRender.GetContext(this,this.Content),this.Proto.Content=this.Content),this.Content||Lure._Content.ContentGet(t,this);try{this.Target.appendChild(this.Content)}catch(i){return Lure.System.Error('[Lure.Content] Error: Content target "'+l+'" not found in Content "'+this.Name+'"',"\n",this),!1}return null!==this.Content&&null!==this.Target||(this.isContent=!1,Lure.System.Error('[Lure.Content] Target or Content of Content.Name = "'+this.Name+'" is null!'),!1)}function o(){var t=this;if(""!==c){var e=document.createElement("style");e.innerHTML=c,document.body.appendChild(e)}b?(this.Content.classList.add(Lure.Settings.Content.CSSDialog),L||(this.isActive=!1,U.call(this)),"undefined"!=typeof b.Wrapper&&(this.Settings.Dialog.Wrapper=b.Wrapper),"undefined"!=typeof b.Blur&&(this.Settings.Dialog.Blur=b.Blur),"undefined"!=typeof b.Animation&&("undefined"!=typeof b.Animation.Show&&(this.Settings.Dialog.Animation.Show=b.Animation.Show),"undefined"!=typeof b.Animation.Hide&&(this.Settings.Dialog.Animation.Hide=b.Animation.Hide))):this.Settings.Dialog=null,null!==w?""===w?this.Load=new Lure.Load({Target:this.Content}):this.Load=new Lure.Load({Target:this.Select(w)}):this.Load={Show:function(){},Hide:function(){}},N?("undefined"!=typeof N.Show&&(this.Settings.Animation.Show=N.Show),"undefined"!=typeof N.Hide&&(this.Settings.Animation.Hide=N.Hide)):!N&&b&&(this.Settings.Animation=this.Settings.Dialog.Animation),this.Settings.Animation._DurationShow=Lure.GetDurationAnimation(this.Settings.Animation.Show,this.Content),this.Settings.Animation._DurationHide=Lure.GetDurationAnimation(this.Settings.Animation.Hide,this.Content),ft.call(this),pt.call(this);var i=[];for(var n in vt)vt.hasOwnProperty(n)&&(i.push(n),Object.defineProperty(this,n,Object.getOwnPropertyDescriptor(vt,n)));if(q){this.Sort={_Reset:function(){for(var e=t.SelectAll(".l-sorter-up, .l-sorter-down"),i=0;i<e.length;i++)e[i].classList.remove("l-sorter-up"),e[i].classList.remove("l-sorter-down")}};var o=function(e){return q.hasOwnProperty(e)?(t.Sort[e]={Target:t.Select(q[e]),Delegate:function(i,n){var o=Lure.Object.GetProperty(i,e),r=Lure.Object.GetProperty(n,e);if(t.Controller.PropTypes[e])o=Lure.PropTypes.TryParse(t.Controller.PropTypes[e],Lure.Object.GetProperty(i,e),e),r=Lure.PropTypes.TryParse(t.Controller.PropTypes[e],Lure.Object.GetProperty(n,e),e);else if(o.localeCompare)return o.localeCompare(r,Lure.Settings.LocaleSort);return o>r?1:o<r?-1:0}},t.Sort[e].Target.classList.add("l-pointer"),t.Sort[e].Target.classList.add("l-rel"),t.Sort[e].Target.innerHTML=t.Sort[e].Target.innerHTML+'<div class="l-abs l-sorter"></div>',void t.Sort[e].Target.addEventListener("click",function(i){var n=Lure.Select(".l-sorter",i.currentTarget),o=n.classList.contains("l-sorter-down");t.Sort._Reset(),t.Controller._Sort(o?null:t.Sort[e].Delegate).then(function(t){o||(t>0?n.classList.add("l-sorter-up"):n.classList.add("l-sorter-down"))})})):"continue"};for(var r in q){o(r)}}this._Refresh=M.bind(this);var s=null;if(this._Shower=I.bind(this),this._Hider=U.bind(this),this._Show=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t._Permission&&!t._Permission.isAllow||(t.isActive=!0,t.Control&&t.Control.Activate(),"Untyped"!==t.Type&&Lure.ContentList[t.Type].forEach(function(e){e!==t&&e.isActive&&e.Hide()}),t.isGlobal||!t.Parent||t.Parent.isVisible||t.Parent._Permission&&!t.Parent._Permission.isAllow||(Lure.Route.LockParent=!0,t.Parent._Show(null,!0),Lure.Route.LockParent=!1),window.setTimeout(function(){if(Lure.Route.Enabled&&t.isRouteable&&!Lure.Route.Lock&&t.Name&&(Lure.Route.Lock=!0,Lure.Route.LockParent||(Lure.Route.Push(t),Lure._Content.Current=t),Lure.Route.Lock=!1),t.Settings.Dialog){var n=Lure._Dialog.zIndex;Lure._DialogCount++,t.Content.style.zIndex=n+2,t.Settings.Dialog.Wrapper&&(t._DialogWrapper||(t._DialogWrapper=Lure.CreateElementFromString('<div class="'+Lure.Settings.Content.CSSDialogWrapper+'">')),t._DialogWrapper.addEventListener("click",t._Hide),t.Target.appendChild(t._DialogWrapper),t._DialogWrapper.style.zIndex=n+1),t.Settings.Dialog.Blur&&(t._DialogWrapper.style.background="none",Lure.Select(t.Settings.Dialog.Blur).classList.add(Lure.Settings.Content.CSSBlur)),Lure._Dialog.Add(t.Content)}s=Lure.AsyncToggle(t,e,t.Content,function(){i||O.call(this,e),this._Shower.call(this)},i?function(){}:E,t.Settings.Animation.Hide,t.Settings.Animation.Show,t.Settings.Animation._DurationShow,s)},0))},this._Hide=function(e){t.isActive=!1,t.Control&&t.Control.Disactivate(),b&&(Lure._Dialog.Remove(t.Content),Lure._DialogCount--,t.Settings.Dialog.Wrapper&&t._DialogWrapper&&t._DialogWrapper.remove(),t.Settings.Dialog.Blur&&Lure._DialogCount<1&&Lure.Select(t.Settings.Dialog.Blur).classList.remove(Lure.Settings.Content.CSSBlur)),s=Lure.AsyncToggle(t,e,t.Content,D,function(){this._Hider.call(this),W.call(this,e)},t.Settings.Animation.Show,t.Settings.Animation.Hide,t.Settings.Animation._DurationHide,s)},this.__private={},this.Content.onclick=J?J.bind(this):this.Content.onclick,Array.isArray(_))for(var l=0;l<_.length;l++)_[l].Parent||(_[l].Parent=this),this[_[l].Name]=new Lure.Content(_[l]),this._SubContent[_[l].Name]=this[_[l].Name],this._SubContentList.push(this[_[l].Name]);else if(_ instanceof Function)_.call(this);else for(var a in _)_[a].Parent=this,_[a].Name=a,this[a]=new Lure.Content(_[a]),this._SubContent[a]=this[a],this._SubContentList.push(this[a]);"Untyped"!==S||L===!1||b?("Untyped"!==S&&L!==!0||b&&L!==!0)&&(L=!1):L=!0,L?(this._Shower.call(this),this.isActive=!0,this.Control&&this.Control.Activate()):(this.isActive=!1,this._Hider.call(this)),rt&&(rt.isController?(this.Controller=rt,this.Controller.Owner=this,this.Controller.PropTypes=et,this.Controller.PropFormat=nt):(rt.Target||(rt.Target=this.Content),rt.Type||(rt.Type="Templator"),rt.Owner=this,rt.PropTypes=et,rt.PropFormat=nt,this.Controller=new Lure.Controller[rt.Type](rt))),Lure.ContentList[this.Type]||(Lure.ContentList[this.Type]=[]),Lure.ContentList[this.Type].push(this),Lure._Content.List.push(this),Lure._Content.ByID[this.ID]=this,this.Name&&(Lure._Content.ByName[this.Name]=this),Lure._Content.ByType[this.Type]||(Lure._Content.ByType[this.Type]=[]),Lure._Content.ByType[this.Type].push(this);var u=this.Content.children.Where(function(t){return t.classList.contains("close")}).FirstOrDefault();u&&u.addEventListener("click",this._Hide);for(var h in this)!this.hasOwnProperty(h)||i.indexOf(h)>-1||("_Init"!==h&&this[h]instanceof Function?this[h]=this[h].bind(this):h&&"Parent"!==h&&this[h]instanceof Lure.Content&&(this[h].Parent=this[h].Parent?this[h].Parent:this,this[h].Name=this[h].Name?this[h].Name:h));this.Proto&&this.Proto.Refresh(),this.Controller&&!this.Controller._NoBuild&&this.Controller.Refresh(),setTimeout(function(){this._isInit=!1,Lt.call(this)}.bind(this),1)}var r=this,s=e.Target,l=void 0===s?null:s,a=e.Content,u=void 0===a?null:a,h=e.CSS,c=void 0===h?"":h,d=e.Name,f=void 0===d?null:d,C=e.Route,p=void 0===C?function(t){return r.Show(t)}:C,g=e.Global,v=void 0!==g&&g,m=e.Type,S=void 0===m?"Untyped":m,y=e.Visible,L=void 0===y?void 0:y,P=e.SubContent,_=void 0===P?[]:P,T=e.Dialog,b=void 0!==T&&T,A=e.Load,w=void 0===A?null:A,k=e.BeforeHide,D=void 0===k?function(){}:k,R=e.BeforeShow,O=void 0===R?function(){}:R,B=e.Show,E=void 0===B?function(){}:B,H=e.Hide,W=void 0===H?function(){}:H,G=e.Animation,N=void 0===G?null:G,x=e.Shower,I=void 0===x?function(){this.Content.style.display=""}:x,F=e.Hider,U=void 0===F?function(){this.Content.style.display="none"}:F,j=e.Refresh,M=void 0===j?function(t){this.Proto&&this.Proto.Refresh(),this.Controller&&this.Controller.Refresh(t)}:j,z=e.Sort,q=void 0!==z&&z,V=(e.Filter,e.OnClick),J=void 0===V?null:V,K=e.Proto,Q=void 0===K?{}:K,X=e.State,Y=void 0===X?null:X,Z=e.OnChange,$=void 0===Z?void 0:Z,tt=e.PropTypes,et=void 0===tt?{}:tt,it=e.PropFormat,nt=void 0===it?{}:it,ot=e.Controller,rt=void 0===ot?null:ot,st=e.Control,lt=void 0===st?null:st,at=e.Permission,ut=void 0===at?null:at,ht=e.Pre,ct=void 0===ht?function(){}:ht,dt=e.Props,ft=void 0===dt?function(){}:dt,Ct=e.Methods,pt=void 0===Ct?function(){}:Ct,gt=e.GetSet,vt=void 0===gt?{}:gt,mt=e.BeforeBuild,St=void 0===mt?function(){}:mt,yt=e.AfterBuild,Lt=void 0===yt?function(){}:yt,Pt=e.Disabled,_t=void 0!==Pt&&Pt,Tt=e.Parent,bt=void 0===Tt?null:Tt;if(_classCallCheck(this,t),!_t){if(this.ID=Lure.GetID(),this.isContent=!0,this.isActive=!0,this.isRoot=!0,this.isGlobal=v,this.isRouteable=null!==p&&p!==!1&&void 0!==p,this._RouteParam=null,this.isRouteable&&(this._RouteParam="",this._OnRoute=p.bind(this),this.Route=function(t){r._RouteParam=t,r._OnRoute(t)}),this.Settings=Lure.Clone(Lure.Settings.Content.Defaults.Settings),ut){if(ut.Attribute&&(this.Settings.Permission.Attribute=ut.Attribute),this.Settings.Permission.Actions=Lure.Settings.Content.Defaults.Settings.Permission.Actions,ut.Actions)for(var At in ut.Actions)ut.Actions.hasOwnProperty(At)&&(this.Settings.Permission.Actions[At.toLowerCase()]=ut.Actions[At].bind(this));if(ut.Action&&"string"==typeof ut.Action?this.Settings.Permission.Actions[ut.Action]&&(this.Settings.Permission.Action=this.Settings.Permission.Actions[ut.Action].bind(this)):ut.Action&&"function"==typeof ut.Action?this.Settings.Permission.Action=ut.Action.bind(this):this.Settings.Permission.Action=Lure.Settings.Content.Defaults.Settings.Permission.Action,ut.Users&&(this.Settings.Permission.Users=ut.Users),ut.Roles&&(this.Settings.Permission.Roles=ut.Roles),ut.Write&&(this.Settings.Permission.Write=ut.Write),ut.Rules&&(this.Settings.Permission.Rules=ut.Rules),ut.Rules)for(var wt in ut.Rules)ut.Rules.hasOwnProperty(wt)&&(this.Settings.Permission.Rules[wt.toLowerCase()]=ut.Rules[wt]);this._Permission={isAllow:!0,isAllowWrite:!0,CheckRole:function(t,e){if("number"===Lure.GetType(t))return Lure.User.Roles.indexOf(t)>-1||Lure.User.SubRoles[t]&&Lure.User.SubRoles[t].length>0;for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(Lure.User.SubRoles[n]){var o=void 0,s=i;"."===i.substring(0,1)?(o=e,s=i.substring(1)):o=r.Proto.Data;var l=Lure.Object.GetProperty(o,s),a=Lure.User.SubRoles[t[i]].indexOf(l)>-1||Lure.User.SubRoles[t[i]].indexOf(-1)>-1;if(a)return a}}},CheckRoles:function(t,e){var i=!1;if(!t||t.length<1||t.indexOf(-1)>-1)return!0;for(var n=0;n<t.length;n++){var o=t[n];if(r._Permission.CheckRole(o,e)){i=!0;break}}return i},CheckTheContent:function(){var t=r.Settings.Permission.Roles,e=!1;if(t.length<1||t.indexOf(-1)>-1)return!0;for(var i=0;i<t.length;i++){var n=t[i];if(r._Permission.CheckRole(n)){e=!0;break}}return!e&&r.Settings.Permission.Action&&r.Settings.Permission.Action.call(r),e},CheckTheContentWrite:function(){var t=r.Settings.Permission.Write,e=!1;if(t.length<1||t.indexOf(-1)>-1)return!0;for(var i=0;i<t.length;i++){var n=t[i];if(r._Permission.CheckRole(n)){e=!0;break}}return e},HideEdits:function(t){for(var e=Lure.SelectAll(".l-edit-btn-edit, .l-edit-btn-remove",t),i=0;i<e.length;i++)r.Settings.Permission.Actions.hide(e[i])},CheckRules:function(){for(var t=(r.Settings.Permission.Rules,r.SelectAll("["+r.Settings.Permission.Attribute+"]")),e=0;e<t.length;e++)r._Permission.CheckElement(t[e])},Check:function(){r._isInit;var t=r._Permission.CheckTheContent(),e=t&&r._Permission.CheckTheContentWrite();if(t){if(r.Control._ControlList)for(var i=0;i<r.Control._ControlList.length;i++)for(var n=0;n<r.Control._ControlList[i].Control.length;n++)r.Settings.Permission.Actions.show(r.Control._ControlList[i].Control[n])}else if(!t&&r._Permission.isAllow&&(r.Settings.Permission.Actions.hide(r.Content),r.Control._ControlList))for(var o=0;o<r.Control._ControlList.length;o++)for(var s=0;s<r.Control._ControlList[o].Control.length;s++)r.Settings.Permission.Actions.hide(r.Control._ControlList[o].Control[s]);if(e)for(var l=r.SelectAll(".l-edit-btn-edit, .l-edit-btn-remove"),a=0;a<l.length;a++)r.Settings.Permission.Actions.show(l[a]);else if(!e)for(var u=r.SelectAll(".l-edit-btn-edit, .l-edit-btn-remove"),h=0;h<u.length;h++)r.Settings.Permission.Actions.hide(u[h]);r._Permission.isAllow=t,r._Permission.isAllowWrite=e;for(var c=r.SelectAll("["+r.Settings.Permission.Attribute+"]"),d=0;d<c.length;d++)r._Permission.CheckElement(c[d])},HasPermissionElement:function(t,e){var i=t.attributes[r.Settings.Permission.Attribute];return!i||(i=i.value.toLowerCase(),r.Settings.Permission.Rules[i]?r._Permission.CheckRoles(r.Settings.Permission.Rules[i].Roles,e):void 0)},HasPermissionWriteElement:function(t,e){var i=t.attributes[r.Settings.Permission.Attribute];return!i||(i=i.value.toLowerCase(),r.Settings.Permission.Rules[i]?r._Permission.CheckRoles(r.Settings.Permission.Rules[i].Write,e):void 0)},CheckElement:function(t,e){var i=!1,n=!1,o=t.attributes[r.Settings.Permission.Attribute].value.toLowerCase();if(r.Settings.Permission.Rules[o])if(i=r._Permission.CheckRoles(r.Settings.Permission.Rules[o].Roles,e),n=r._Permission.CheckRoles(r.Settings.Permission.Rules[o].Write,e),n||(r._Permission.HideEdits(t),r.Settings.Permission.Rules[o].ActionWrite&&r.Settings.Permission.Rules[o].ActionWrite.call(r,t)),i)r.Settings.Permission.Actions.show(t);else{var s=r.Settings.Permission.Rules[o].Action?r.Settings.Permission.Rules[o].Action:r.Settings.Permission.DefaultAction;"string"==typeof s?r.Settings.Permission.Actions[s](t):"function"==typeof s&&s.call(r,t)}},CheckLine:function(t,e){t.attributes[r.Settings.Permission.Attribute]&&r._Permission.CheckElement(t,e);for(var i=Lure.SelectAll("["+r.Settings.Permission.Attribute+"]",t),n=0;n<i.length;n++)r._Permission.CheckElement(i[n],e);if(!r._Permission.isAllowWrite)for(var o=Lure.SelectAll(".l-edit-btn-edit, .l-edit-btn-remove",t),s=0;s<o.length;s++)r.Settings.Permission.Actions.hide(o[s]);return t}}}if(this._SubContent={},this._SubContentList=[],this._isInit=!0,this._Init=function(){i.call(r)},Lure.Settings.Content.AutoInit&&!_t||Lure.Application.isRun&&!_t)this._Init();else if(bt&&f&&(bt[f]=this,this.Parent=bt,this.Parent._SubContent[f]=this,this.Parent._SubContentList.push(this)),_&&"function"===Lure.GetType(_)){_.call(this),_=null;for(var kt in this)this.hasOwnProperty(kt)&&kt&&"Parent"!==kt&&this[kt]&&this[kt].isContent&&(this[kt].isRoot=!1,this[kt].Name=this[kt].Name?this[kt].Name:kt,this[kt].Parent=this[kt].Parent&&!this[kt].Parent.isRoot?this[kt].Parent:this,this._SubContent[this[kt].Name]=this[kt],this._SubContentList.push(this[kt]))}null===bt&&Lure.Application.Content.push(this)}}return _createClass(t,[{key:"Props",value:function(){}},{key:"Methods",value:function(){}},{key:"AfterBuild",value:function(){}},{key:"BeforeBuild",value:function(){}},{key:"Show",value:function(t){this._Show(t)}},{key:"Hide",value:function(t){this._Hide&&this._Hide(t)}},{key:"Toggle",value:function(t){return this.isActive?this._Hide(t):void this._Show(t)}},{key:"RefreshOne",value:function(t){this.Controller&&this.Controller.RefreshOne(t)}},{key:"Add",value:function(t,e){if(this.Controller)return this.Controller._Add(t,e)}},{key:"Edit",value:function(t,e,i){if(this.Controller)return this.Controller._Edit(t,e,i)}},{key:"Remove",value:function(t){if(this.Controller)return this.Controller._Remove(t)}},{key:"Refresh",value:function(t){return this._Refresh(t)}},{key:"GetIndex",value:function(t){return t=this.Select(t),Array.prototype.slice.call(t.parentElement.children).indexOf(t)}},{key:"AddEventListener",value:function(t,e,i){Lure.AddEventListenerGlobal(t,e,i,this.Content,this)}},{key:"AddTutor",value:function(t){this.MonsieurTutor=new MonsieurTutor(this.Select(t),this.Content)}},{key:"Dispose",value:function(){this.Content.remove(),this.Control.Disactivate(),this.Content=null,this.Control=null}},{key:"Select",value:function(t){return Lure.Select(t,this.Content)}},{key:"SelectAll",value:function(t){return Lure.SelectAll(t,this.Content)}},{key:"GetParent",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=this;null!==e.Parent&&e.Name!==t;)e=e.Parent;return e}},{key:"GetContent",value:function(){function t(i){for(var o in i)if(i.hasOwnProperty(o)&&"Parent"!==o&&i[o]&&i[o].isContent){if(i[o].Name===e)return i[o];n=t(i[o])}return n}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",i=this.GetParent(e);if(i.Name===e||"root"===e)return i;var n=null;return"root"===e?n:t(i)}},{key:"isAncestor",value:function(t){if(!t)return!1;for(var e=t.Parent;e;){if(e===this)return!0;e=e.Parent}return!1}},{key:"isDescendant",value:function(t){if(!t)return!1;for(var e=this.Parent;e;){if(e===t)return!0;e=e.Parent}return!1}},{key:"GetSubContentList",value:function(){return this._SubContentList.Where(function(t){return t.HasPermission})}},{key:"ShowSubContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t){var e=this._SubContentList.Where(function(t){return t.HasPermission&&"Untyped"!==t.Type}),i=e.FirstOrDefault();e.Where(function(t){return t.isActive}).length<1&&i&&!i.isActive&&i.Show()}else this._SubContent[t].Show()}},{key:"ChildrenBack",value:function(){for(var t=this.GetSubContentList(),e=0;e<t.length;e++)t[e].Target.appendChild(t[e].Content)}},{key:"ChildrenRefresh",value:function(){for(var t=this.GetSubContentList(),e=0;e<t.length;e++)t[e].isActive&&t[e].Refresh()}},{key:"HasElementPermission",value:function(t,e){var i=this._PermissionRules;return!i||i.HasPermissionElement(t,e)}},{key:"HasElementWritePermission",value:function(t,e){var i=this._PermissionRules;return!i||i.HasPermissionWriteElement(t,e)}},{key:"FullName",get:function(){for(var t=this.Parent,e=this.Name;t;)e=t.Name+"."+e,t=t.Parent;return e}},{key:"isVisible",get:function(){return Lure.isVisible(this.Content)}},{key:"Data",get:function(){return this.Controller?this.Controller.Data:this.Proto?this.Proto.Data:null},set:function(t){return this.Controller?void(this.Controller.Data=t):void(this.Proto&&(this.Proto.Data=t))}},{key:"State",get:function(){return this.Proto.Data},set:function(t){return this.Proto.Data=t}},{key:"Title",get:function(){return this.TitleContent.innerHTML},set:function(t){this.TitleContent.innerHTML=t}},{key:"HasPermission",get:function(){var t=this._PermissionRules;return!t||t.isAllow}},{key:"HasPermissionWrite",get:function(){var t=this._PermissionRules;return!t||t.isAllowWrite}},{key:"_PermissionRules",get:function(){for(var t=this;t;){if(t._Permission)return t._Permission;t=t.Parent}return null}}],[{key:"Version",get:function(){return"0.3.1"}}]),t}(),Lure._Content={Control:function(){function t(e,i){var n=this;if(_classCallCheck(this,t),!(!e||e.length<1&&!e.Target)){var o=function(t){var e={Control:Lure.SelectAll(t.Target),Type:t.Type?t.Type:"Untyped",isGlobal:!!t.Global,OnClick:t.OnClick?t.OnClick.bind(i):i.Show,OnChange:t.OnChange,Activate:function(){var t=this.Control;this.isGlobal&&(t=Lure.SelectAll(this._query,i.Content));for(var e=0;e<t.length;e++)t[e].classList.add("active")},Disactivate:function(){var t=this.Control;this.isGlobal&&(t=Lure.SelectAll(this._query,i.Content));for(var e=0;e<t.length;e++)t[e].classList.remove("active")},_query:t.Target};if(e.isGlobal)Lure.AddEventListenerGlobal("click",t.Target,e.OnClick,document,i),e.OnChange&&Lure.AddEventListenerGlobal("change",t.Target,e.OnChange,document,i);else for(var o=Lure.SelectAll(t.Target),r=0;r<o.length;r++)o[r].classList.add("l-control"),o[r].addEventListener("click",e.OnClick.bind(i)),e.OnChange&&o[r].addEventListener("click",e.OnChange.bind(i));n._ControlList.push(e),"Untyped"!==e.Type&&(n[e.Type]=e)};this._ControlList=[];for(var r=0;r<e.length;r++){var s=e[r];o(s)}e.Target&&o(e)}}return _createClass(t,[{key:"Activate",value:function(t){if(t)return this[t].Activate();if(this._ControlList)for(var e=0;e<this._ControlList.length;e++)this._ControlList[e].Activate()}},{key:"Disactivate",value:function(t){if(t)return this[t].Disactivate();if(this._ControlList)for(var e=0;e<this._ControlList.length;e++)this._ControlList[e].Disactivate()}}]),t}(),ContentGet:function(t,e){try{var i=Lure.CreateElementsFromString(t);if(i.length>1){e.Content=e.Target;for(var n=0;n<i.length;n++)e.Content.appendChild(i[n])}else e.Content=i[0]}catch(o){Lure.System.Error("[Lure.Content] ContentGet Error. "+e.Name+" "+o)}},Permission:{},Current:null,List:[],ByID:{},ByName:{},ByType:{}},Lure.Settings.Content={AutoInit:!1,CSSBlur:"l-blur",CSSDialog:"l-dialog",CSSDialogWrapper:"l-dialog-wrapper",Override:!1,Permission:{Strict:!1},Defaults:{Settings:{Animation:{Show:"",Hide:""},Dialog:{Animation:{Show:"l-animation_dialog-show",Hide:"l-animation_dialog-hide"},Blur:!1,Wrapper:!0},Permission:{Attribute:"data-permission",DefaultAction:"hide",Users:[],Roles:[],Write:[],Action:function(){},Rules:{DefaultSample:{Users:[],Roles:[],Write:[],ActionWrite:null,Action:"hide"}},Actions:{hide:function(t){t&&(t.style.display="none")},show:function(t){t&&(t.style.display="")},remove:function(t){t&&t.remove()}}}}}},Lure.Plugin.Tutor=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,t);var n=this;this.TargetButton=Lure.Select(e),this.TargetContent=Lure.Select(i);var o='<div class="lure-tutor">\n                        <div class="cd-caption">\n                            <span>Шаг </span>\n                            <span class="lure-tutor_step"></span>\n                        </div>\n                        <div class="lure-tutor_desc"></div>\n                        <div class="lure-tutor_btns">\n                            <button class="button btn-tutor btn-tutor-stop">Прервать обучение</button>\n                            <button class="button btn-tutor btn-tutor-next">Далeе →</button></div>\n                   </div>';this.Content=Lure.CreateElementFromString(o),this.ContentBG=Lure.CreateElementFromString('<div class="lure-tutor-bg dialog-wrapper"></div>'),this.Content.style.display="none",this.ContentBG.style.display="none",this._Description=this.Content.querySelector(".lure-tutor_desc"),this._Step=this.Content.querySelector(".lure-tutor_step"),this._ButtonNext=this.Content.querySelector(".btn-tutor-next"),this._ButtonStop=this.Content.querySelector(".btn-tutor-stop"),n.Data=[];var r=this._ButtonNext.innerHTML,s=0,l=document.createElement("div");l.style.display="none",document.body.appendChild(l);var a=window.getComputedStyle(l).backgroundColor;l.remove();var u=function(){var t=n.Data[s-1].obj;if("tr"!==t.tagName.toLowerCase())return t.style.zIndex="",t.style.position="",t.style.outline="",t.style.display="",void(t.style.backgroundColor="");var e=t.querySelectorAll("th, td");e.forEach(function(t){t.style.position="",t.style.zIndex=""})},h=function(t){if("tr"!==t.tagName.toLowerCase()){t.style.zIndex="11",t.style.position="relative",t.style.outline="5px #bee0ff solid";var e=window.getComputedStyle(t);return e.backgroundColor===a&&(t.style.backgroundColor="#fff"),void(Lure.isVisible(t)||("table"!==t.tagName.toLowerCase()?t.style.display="block":t.style.display="table"))}for(var i=Lure.SelectAll("th, td",t),n=0;n<i.length;n++){i[n].style.zIndex="11",i[n].style.position="relative";var o=window.getComputedStyle(i[n]);o.backgroundColor===a&&(i[n].style.backgroundColor="#fff")}},c=function(){if(console.log("tutor run"),null!==n.TargetContent){var t=n.TargetContent.querySelectorAll('*[data-tutor]:not([data-line]), *[data-tutor][data-line="0"]');if(t.length<1)return void Lure.Confirm("Сообщение","На этом экране нет подсказок");t.forEach(function(t){n.Data.push({obj:t,desc:t.dataset.tutor})}),n.Content.style.display="",n.ContentBG.style.display="",d()}},d=function(){if(s>0&&u(),s===n.Data.length)return void f();var t=n.Data[s].obj,e=n.Data[s].desc,i=e.match(/{([\s\S]+)}/);null!==i&&(i=i[1],e=e.replace(/{([\s\S]+)}/,""),t=t.closest(i),n.Data[s].obj=t),h(t),n._Step.innerHTML=s+1+"/"+n.Data.length,n._Description.innerHTML=e,s+1===n.Data.length&&(n._ButtonNext.innerHTML="Завершить",n._ButtonStop.style.opacity="0");var o=t.offsetLeft+t.clientWidth+10,r=t.offsetTop-n.Content.clientHeight-10;r<10&&(r=10),o+n.Content.clientWidth>window.innerWidth&&(o=t.offsetLeft-n.Content.clientWidth-10,window.innerWidth<n.Content.clientWidth+t.clientWidth&&(o=t.offsetLeft+t.clientWidth-n.Content.clientWidth-20)),(document.documentElement.scrollTop>r||document.documentElement.scrollTop+window.innerHeight<t.offsetTop+t.offsetHeight)&&(document.documentElement.scrollTop=r-10),o<10&&(o=10),n.Content.style.left=o+"px",n.Content.style.top=r+"px",s++},f=function(){u(),n.Content.style.display="none",n.ContentBG.style.display="none",n._ButtonNext.innerHTML=r,n._ButtonStop.style.opacity="",s=0,n.Data=[]};this.TargetButton.onclick=c,this._ButtonNext.onclick=d,this._ButtonStop.onclick=f,document.body.appendChild(this.Content),document.body.appendChild(this.ContentBG),this.Run=c},Lure.Plugin.Tooltip=function e(t){var i=t.Target,n=void 0===i?document:i,o=t.Attribute,r=void 0===o?"data-tooltip":o,s=t.Delay,l=void 0===s?400:s,a=t.Time,u=void 0===a?1100:a,h=t.Custom,c=void 0===h?'<div class="lure-tooltip">':h,d=t.AfterBuild,f=void 0===d?function(){}:d;_classCallCheck(this,e);var C=this;this.ToolTip=Lure.CreateElementFromString(c);var p=null,g=null;this.Target=Lure.Select(n);var v=function(t){this.ToolTip.innerHTML=t,C.Target.appendChild(this.ToolTip)}.bind(this);Lure.AddEventListenerGlobal("mouseover","["+r+"]",function(t){var e=t.currentTarget.dataset[r.replace("data-","")];clearTimeout(g),p=setTimeout(function(){v(e)},l)},this.Target),Lure.AddEventListenerGlobal("mouseout","["+r+"]",function(){clearTimeout(p),g=setTimeout(function(){},u)},this.Target),setTimeout(function(){f.bind(C)},0)},Lure.Tutor=Lure.Plugin.Tutor,Lure.Tooltip=Lure.Plugin.Tooltip,Lure.RunTutor=function(){var t=new Lure.Content({Target:"body",Name:"LureTT",Visible:!1,Content:'<div class="l-tutor">\n                    <div class="cd-caption">Шаг {{Step}}/{{StepCount}}</div>\n                    <div class="inner-content">\n                      <div class="tutor-description">{{Description}}</div>\n                      <div class="l-row">\n                        <button class="l-button button btn-tutor btn-tutor-stop">{{ButtonStopCaption}}</button>\n                        <button class="l-button button btn-tutor btn-tutor-next">{{ButtonNextCaption}}</button>\n                      </div>\n                    </div>\n                    \n                  </div>',State:{Step:1,StepCount:1,Description:"",ButtonNextCaption:"Далeе →",ButtonStopCaption:"Прервать обучение"},Props:function(){this._TutorBG=Lure.CreateElementFromString('<div class="l-tutor-bg dialog-wrapper" style="display: none"></div>'),this._ButtonNext=this.Select(".btn-tutor-next"),this._ButtonStop=this.Select(".btn-tutor-stop"),this._ButtonNextTextDefault="Далeе →",this.Options=null},Methods:function(){this.ElemCssRestore=function(){var t=this._DataTutor[this.TutorPosition-1].obj;if("tr"!==t.tagName.toLowerCase())return t.style.zIndex="",t.style.position="",t.style.outline="",t.style.display="",void(t.style.backgroundColor="");var e=t.querySelectorAll("th, td");e.forEach(function(t){t.style.position="",t.style.zIndex=""})},this.ElemCssSet=function(t){if("tr"!==t.tagName.toLowerCase()){for(var e in this.Options.Frame)this.Options.Frame.hasOwnProperty(e)&&"backgroundColor"!==e&&(t.style[e]=this.Options.Frame[e]);var i=window.getComputedStyle(t);return"absolute"!==i.position&&"relative"!==i.position&&"fixed"!==i.position&&(t.style.position="relative"),i.backgroundColor===this._ColorTransparent&&(t.style.backgroundColor=this.Options.Frame.backgroundColor),void(Lure.isVisible(t)||("table"!==t.tagName.toLowerCase()?t.style.display="block":t.style.display="table"))}for(var n=Lure.SelectAll("th, td",t),o=0;o<n.length;o++){n[o].style.zIndex=this.Options.Frame.zIndex,n[o].style.position="relative";var r=window.getComputedStyle(n[o]);r.backgroundColor===this._ColorTransparent&&(n[o].style.backgroundColor=this.Options.Frame.backgroundColor)}},this.SetOptions=function(t){if(this.Options=Lure.Clone(Lure.Settings.Tutor.Options),t&&t.Frame)for(var e in t.Frame)t.Frame.hasOwnProperty(e)&&(this.Options.Frame[e]=t.Frame[e])},this.Run=function(t,e){if(this.SetOptions(e),this.TargetContent=Lure.Select(t),this.TutorPosition=0,this._ButtonStop.style.display="",this.State.ButtonNextCaption=this._ButtonNextTextDefault,console.log("tutor run"),null!==this.TargetContent){var i=this.TargetContent.querySelectorAll('*[data-tutor]:not([data-line]), *[data-tutor][data-line="0"]');if(i.length<1)return void Lure.Confirm("Сообщение","На этом экране нет подсказок");this._DataTutor=[];for(var n=0;n<i.length;n++){var o=i[n];this._DataTutor.push({obj:o,desc:o.dataset.tutor})}this.Proto.Data.Step=1,this.Proto.Data.StepCount=this._DataTutor.length,this.GoStep(),this._TutorBG.style.display="",this.Show()}},this.GoStep=function(){if(this.TutorPosition>0&&this.ElemCssRestore(),this.TutorPosition===this._DataTutor.length)return void this.Stop();var t=this._DataTutor[this.TutorPosition].obj,e=this._DataTutor[this.TutorPosition].desc,i=e.match(/{([\s\S]+)}/);null!==i&&(i=i[1],e=e.replace(/{([\s\S]+)}/,""),t=t.closest(i),this._DataTutor[this.TutorPosition].obj=t),this.ElemCssSet(t),this.TutorPosition+1===this._DataTutor.length&&(this.State.ButtonNextCaption="Завершить",this._ButtonStop.style.display="none");var n=this.Content.clientWidth>0?this.Content.clientWidth:340,o=this.Content.clientHeight>0?this.Content.clientHeight:150,r=t.offsetLeft+t.clientWidth+10,s=t.offsetTop-o-10;s<10&&(s=10),r+n>window.innerWidth&&(r=t.offsetLeft-n-10,
window.innerWidth<n+t.clientWidth&&(r=t.offsetLeft+t.clientWidth-n-20)),(document.documentElement.scrollTop>s||document.documentElement.scrollTop+window.innerHeight<t.offsetTop+t.offsetHeight)&&(document.documentElement.scrollTop=s-10),r<10&&(r=10),this.Content.style.left=r+"px",this.Content.style.top=s+"px",this.TargetContent!==document.body?this.TargetContent.parentElement.appendChild(this._TutorBG):this.Content.appendChild(this._TutorBG),this.TutorPosition++,this.Proto.Data.Step=this.TutorPosition,this.Proto.Data.Description=e,this.Proto.Refresh()},this.Stop=function(){this._Hider(),this._TutorBG.style.display="none",this.ElemCssRestore()},this._GetTransparentColor=function(){var t=document.createElement("div");t.style.display="none",document.body.appendChild(t),this._ColorTransparent=window.getComputedStyle(t).backgroundColor,t.remove()}},AfterBuild:function(){this._GetTransparentColor(),this._ButtonNext.onclick=this.GoStep,this._ButtonStop.onclick=this.Stop}});return function(e,i){t.Run(e,i)}}(),Lure.Settings.Tutor={Options:{Frame:{zIndex:"11",outline:"5px #bee0ff solid",backgroundColor:"#fff"}}};
"use strict";Lure.Route={Lock:!1,LockParent:!1,_Enabled:!1,get Enabled(){return this._Enabled},set Enabled(e){this._Enabled=e,e?window.addEventListener("popstate",Lure.Route.Run):window.removeEventListener("popstate",Lure.Route.Run)},_PopState:!1,Init:function(){},Push:function(e){if(Lure.Route._PopState)return void(Lure.Route._PopState=!1);Lure.Route.CurrentContent=e;var t=Lure.Route._GetRoute(e),o=null!==e._RouteParam?e._RouteParam:"";history.pushState({ContentID:e.ID,Param:o},e.Name,"#"+t+"/"+(""!==o?""+o:""))},_GetRoute:function(e){for(var t=e.Name,o=e.Parent;o;)t=o.Name+"/"+t,o=o.Parent;return t},Back:function(){Lure.Route.Enabled&&history.back()}},Lure.Route.Run=function(e){Lure.Route._PopState=!0;var t=location.href.replace(location.origin+location.pathname,"").substring(1);return Lure.Route.GoTo(t)},Lure.Route.GoTo=function(e){if(!e||Lure.Route.Lock||!Lure.Application.isRun)return 0;console.log("%c[Route]  "+e,"color: green;");var t=e.split("/"),o=t.Last();t.splice(t.length-1,1);var n=new Function("return "+t.join(".")),u=n();return u&&(u.Route(o),Lure.Route.CurrentContent=u),1},Lure.Settings.Route={Auto:!0};
"use strict";Lure._Core||(Lure._Core={}),Lure._Core.Chart={},Lure._Core.Chart.Intitializer={isGraph:function(i){return Lure._Core.Chart.Intitializer.Type.Graph.indexOf(i.toLowerCase())>-1},isDraw:function(i){return Lure._Core.Chart.Intitializer.Type.Draw.indexOf(i.toLowerCase())>-1},Type:{Graph:["line","bar"],Draw:["pie","ring"]},Default:{Color:["red","green","cornflowerblue","purple","palevioletred","orange","tomato","darkblue","cadetblue","crimson"],R:{Target:"",Type:"line",Title:"",Animation:{Bar:"l-animate-svg-bar",Line:"l-animate-svg-line",Marker:"l-animate-svg-mark",Pie:"l-animate-svg-pie",Ring:"l-animate-svg-ring"},Legend:{Position:"top",Visible:!0},Grid:{Visible:!0},AxisX:{Data:[],Format:null,Rotation:"auto",Skip:null,Step:"auto",Position:"bottom",Visible:!0},AxisY:{Position:"left",Min:"auto",Max:"auto",Step:"auto",Visible:!0},Tooltip:{Format:null,FormatGraph:function(i){return'<div class="tip">\n                              <div class="tip-bg"></div>\n                              <div class="tip-value">\n                                <div class="l-row">\n                                  <div class="tip-icon" style="background-color: '+i.Episode.Color+'"></div>\n                                  <div class="tip-label">'+i.ValueX+'</div>\n                                </div>\n                                <div class="l-row">'+i.Episode.Name+": "+i.Value+"</div>\n                              </div>\n                            </div>"},FormatDraws:function(i){var e=i.Value/i.Episode.Sum*100;return isNaN(e)&&(e=0),e=e>1?Math.round(e):Math.round(100*e)/100,'<div class="tip">\n                              <div class="tip-bg"></div>\n                              <div class="tip-value">\n                                <div class="l-row l-flexa-center">\n                                  <div class="tip-icon" style="background-color: '+i.Color+'"></div>\n                                  <div class="tip-label">'+i.Name+": "+i.Value+" ("+e+"%)</div>\n                                </div>\n                              </div>\n                            </div>"},Template:"<div>Name: {{Name}}</div><div>Value: {{Value}}</div>",Visible:!0,Duration:200,Timeout:700,Tip:{Left:0,Top:0,Color:"#000"}},SeriesSample:{Type:"line",Data:[],Name:"",Title:"",Visible:!0,Format:null,AxisX:{Start:"auto",End:"auto",Step:"auto",Skip:null,Linear:!0},AxisY:{Position:"left",Min:"auto",Max:"auto",Step:"auto",Visible:!1},Marker:{Radius:"auto",Shape:"circle",Visible:!0},Width:2,Labels:{Data:[],Format:null,Visible:!0}},SeriesOptions:{Colors:["red","green","cornflowerblue","purple","palevioletred","orange","tomato","darkblue","cadetblue","crimson"],_Bar:{Stack:!1,Gradient:!0,_Count:0},BarStack:!1,BarGradient:!0,PieStack:!1,PieType:"pie",StartAngle:0,Marker:{Radius:"auto",Shape:"circle",Visible:!0}},Height:400,Width:600,Responsible:!0}},RAnimation:function(i){i.Animation?(i.Animation.Bar=void 0!==i.Animation.Bar?i.Animation.Bar:Lure._Core.Chart.Intitializer.Default.R.Animation.Bar,i.Animation.Line=void 0!==i.Animation.Line?i.Animation.Line:Lure._Core.Chart.Intitializer.Default.R.Animation.Line,i.Animation.Marker=void 0!==i.Animation.Marker?i.Animation.Marker:Lure._Core.Chart.Intitializer.Default.R.Animation.Marker,i.Animation.Pie=void 0!==i.Animation.Pie?i.Animation.Pie:Lure._Core.Chart.Intitializer.Default.R.Animation.Pie,i.Animation.Ring=void 0!==i.Animation.Ring?i.Animation.Ring:Lure._Core.Chart.Intitializer.Default.R.Animation.Ring):void 0===i.Animation?i.Animation=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.Animation):i.Animation={Bar:"",Line:"",Marker:"",Pie:"",Ring:""}},RLegend:function(i){i.Legend?(i.Legend.Position=void 0!==i.Legend.Position?i.Legend.Position:Lure._Core.Chart.Intitializer.Default.R.Legend.Position,i.Legend.Visible=void 0!==i.Legend.Visible?i.Legend.Visible:Lure._Core.Chart.Intitializer.Default.R.Legend.Visible):i.Legend=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.Legend)},RLabels:function(i){i.Labels?(i.Labels.Rotation=void 0!==i.Labels.Rotation?i.Labels.Rotation:Lure._Core.Chart.Intitializer.Default.R.Labels.Rotation,i.Labels.Visible=void 0!==i.Labels.Visible?i.Labels.Data:Lure._Core.Chart.Intitializer.Default.R.Labels.Visible,i.Labels.Data=void 0!==i.Labels.Data?i.Labels.Data:Lure._Core.Chart.Intitializer.Default.R.Labels.Data,i.Labels.Format=void 0!==i.Labels.Format?i.Labels.Format:Lure._Core.Chart.Intitializer.Default.R.Labels.Format):i.Labels=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.Labels)},RGrid:function(i){i.Grid?(i.Grid.Visible=void 0!==i.Grid.Visible?i.Grid.Visible:Lure._Core.Chart.Intitializer.Default.R.Grid.Visible,i.Grid.Html=""):i.Grid=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.Grid)},RAxisX:function(i){i.AxisX?(i.AxisX.Visible=void 0!==i.AxisX.Visible?i.AxisX.Visible:Lure._Core.Chart.Intitializer.Default.R.AxisX.Visible,i.AxisX.Position=void 0!==i.AxisX.Position?i.AxisX.Position:Lure._Core.Chart.Intitializer.Default.R.AxisX.Position,i.AxisX.Rotation=void 0!==i.AxisX.Rotation?i.AxisX.Rotation:Lure._Core.Chart.Intitializer.Default.R.AxisX.Rotation,i.AxisX.Data=void 0!==i.AxisX.Data?i.AxisX.Data:Lure._Core.Chart.Intitializer.Default.R.AxisX.Data,i.AxisX.Format=void 0!==i.AxisX.Format?i.AxisX.Format:Lure._Core.Chart.Intitializer.Default.R.AxisX.Format,i.AxisX.Skip=void 0!==i.AxisX.Skip?i.AxisX.Skip:Lure._Core.Chart.Intitializer.Default.R.AxisX.Skip,i.AxisX.Step=void 0!==i.AxisX.Step?i.AxisX.Step:Lure._Core.Chart.Intitializer.Default.R.AxisX.Step,i.AxisX.Linear="function"!=typeof i.AxisX.Skip):i.AxisX=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.AxisX)},RAxisY:function(i){i.AxisY?(i.AxisY.Visible=void 0!==i.AxisY.Visible?i.AxisY.Visible:Lure._Core.Chart.Intitializer.Default.R.AxisY.Visible,i.AxisY.Position=void 0!==i.AxisY.Position?i.AxisY.Position:Lure._Core.Chart.Intitializer.Default.R.AxisY.Position,i.AxisY.Min=void 0!==i.AxisY.Min?i.AxisY.Min:Lure._Core.Chart.Intitializer.Default.R.AxisY.Min,i.AxisY.Max=void 0!==i.AxisY.Max?i.AxisY.Max:Lure._Core.Chart.Intitializer.Default.R.AxisY.Max,i.AxisY.Step=void 0!==i.AxisY.Step?i.AxisY.Step:Lure._Core.Chart.Intitializer.Default.R.AxisY.Step):i.AxisY=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.AxisY)},RTooltip:function(i){i.Tooltip?(i.Tooltip.Visible=void 0!==i.Tooltip.Visible?i.Tooltip.Visible:Lure._Core.Chart.Intitializer.Default.R.Tooltip.Visible,i.Tooltip.Template=void 0!==i.Tooltip.Template?i.Tooltip.Template:Lure._Core.Chart.Intitializer.Default.R.Tooltip.Template,i.Tooltip.Format=void 0!==i.Tooltip.Format?i.Tooltip.Format:Lure._Core.Chart.Intitializer.Default.R.Tooltip.Format,i.Tooltip.Timeout=void 0!==i.Tooltip.Timeout?i.Tooltip.Timeout:Lure._Core.Chart.Intitializer.Default.R.Tooltip.Timeout,i.Tooltip.Duration=void 0!==i.Tooltip.Duration?i.Tooltip.Duration:Lure._Core.Chart.Intitializer.Default.R.Tooltip.Duration,i.Tooltip.Tip={}):i.Tooltip=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.Tooltip)},RSeries:function(i){},RSeriesOptions:function(i){i.SeriesOptions?(i.SeriesOptions.Colors=void 0!==i.SeriesOptions.Colors?i.SeriesOptions.Colors:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.Colors,i.SeriesOptions.BarStack=void 0!==i.SeriesOptions.BarStack?i.SeriesOptions.BarStack:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.BarStack,i.SeriesOptions.BarGradient=void 0!==i.SeriesOptions.BarGradient?i.SeriesOptions.BarGradient:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.BarGradient,i.SeriesOptions.PieStack=void 0!==i.SeriesOptions.PieStack?i.SeriesOptions.PieStack:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.PieStack,i.SeriesOptions.PieType=void 0!==i.SeriesOptions.PieType?i.SeriesOptions.PieType:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.PieType,i.SeriesOptions.StartAngle=void 0!==i.SeriesOptions.StartAngle?i.SeriesOptions.StartAngle:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.StartAngle,i.SeriesOptions.Marker=void 0!==i.SeriesOptions.Marker?i.SeriesOptions.Marker:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.Marker,i.SeriesOptions.Marker.Visible=void 0!==i.SeriesOptions.Marker.Visible?i.SeriesOptions.Marker.Visible:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.Marker.Visible,i.SeriesOptions.Marker.Radius=void 0!==i.SeriesOptions.Marker.Radius?i.SeriesOptions.Marker.Radius:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.Marker.Radius,i.SeriesOptions.Marker.Shape=void 0!==i.SeriesOptions.Marker.Shape?i.SeriesOptions.Marker.Shape:Lure._Core.Chart.Intitializer.Default.R.SeriesOptions.Marker.Shape):i.SeriesOptions=Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.SeriesOptions)},GetSeries:function(i){for(var e=i.Series,t=[],r=0;r<e.length;r++){var a=e[r];a.Line=r,a.Type=void 0!==a.Type?a.Type.toLowerCase():i.Type,a.Name=void 0!==a.Name?a.Name:"",a.Title=void 0!==a.Title?a.Title:"",a.Color=void 0!==a.Color?a.Color:i.SeriesOptions.Colors[r],a.Color=void 0!==a.Color?a.Color:"#000",a.Width=void 0!==a.Width?a.Width:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Width,a.Visible=void 0!==a.Visible?a.Visible:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Visible,a.Format=void 0!==a.Format?a.Format:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Format,a.AxisX=void 0!==a.AxisX?a.AxisX:Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisX),a.AxisX.Data=void 0!==a.AxisX.Data?a.AxisX.Data:i.AxisX.Data,a.AxisX.Start=void 0!==a.AxisX.Start?a.AxisX.Start:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisX.Start,a.AxisX.End=void 0!==a.AxisX.End?a.AxisX.End:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisX.End,a.AxisY=void 0!==a.AxisY?a.AxisY:Lure.Object.Clone(Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisY),a.AxisY.Visible=void 0!==a.AxisY.Visible?a.AxisY.Visible:void 0!==a.AxisY||Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisY.Visible,a.AxisY.Position=void 0!==a.AxisY.Position?a.AxisY.Position:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisY.Position,a.AxisY.Min=void 0!==a.AxisY.Min?a.AxisY.Min:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisY.Min,a.AxisY.Max=void 0!==a.AxisY.Max?a.AxisY.Max:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisY.Max,a.AxisY.Step=void 0!==a.AxisY.Step?a.AxisY.Step:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.AxisY.Step,a.Marker=void 0!==a.Marker?a.Marker:Lure.Object.Clone(i.SeriesOptions.Marker),a.Marker.Visible=void 0!==a.Marker.Visible?a.Marker.Visible:i.SeriesOptions.Marker.Visible,a.Marker.Shape=void 0!==a.Marker.Shape?a.Marker.Shape:i.SeriesOptions.Marker.Shape,a.Marker.Radius=void 0!==a.Marker.Radius?a.Marker.Radius:i.SeriesOptions.Marker.Radius,a.Marker.Radius="auto"!==a.Marker.Radius?a.Marker.Radius:4+a.Width/4,Lure._Core.Chart.Intitializer.Type.Draw.indexOf(a.Type)>-1&&(a.Colors=a.Colors?a.Colors:Lure._Core.Chart.Intitializer.Default.Color,a.Width=a.Width?a.Width:30,a.AngleStart=a.AngleStart?a.AngleStart:0,a.Margin=a.Margin?a.Margin:0,a.Labels=void 0!==a.Labels?a.Labels:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Labels,a.Labels.Visible=void 0!==a.Labels.Visible?a.Labels.Visible:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Labels.Visible,a.Labels.Data=void 0!==a.Labels.Data?a.Labels.Data:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Labels.Data,a.Labels.Format=void 0!==a.Labels.Format?a.Labels.Format:Lure._Core.Chart.Intitializer.Default.R.SeriesSample.Labels.Format,a.Visibles=void 0!==a.Visibles?a.Visibles:a.Data.Select(function(){return!0})),t.push(a)}return t},InitR:function(i){i.Name=void 0!==i.Name?i.Name:"",i.Title=void 0!==i.Title?i.Title:"",i.Type=void 0!==i.Type?i.Type.toLowerCase():"line",i.Height=void 0!==i.Height?i.Height:"auto",i.Width=void 0!==i.Width?i.Width:"auto",i.Responsible=void 0===i.Responsible||i.Responsible,Lure._Core.Chart.Intitializer.RAnimation(i),Lure._Core.Chart.Intitializer.RLegend(i),Lure._Core.Chart.Intitializer.RGrid(i),Lure._Core.Chart.Intitializer.RAxisX(i),Lure._Core.Chart.Intitializer.RAxisY(i),Lure._Core.Chart.Intitializer.RTooltip(i),Lure._Core.Chart.Intitializer.RSeriesOptions(i),i.DrawAfterInit=void 0===i.DrawAfterInit||i.DrawAfterInit,this.Options=i,this.Options.Series=Lure._Core.Chart.Intitializer.GetSeries(i),this.Options.Svg={Html:"",Height:0},this.Options.AxisX.Html="",this.Options.AxisY.HtmlLeft="",this.Options.AxisY.HtmlRight="",this.Options.Grid.Html="",this.Options.Legend.Html="",this.Options.Tooltip.Html="",this.isGraph=0===this.Options.Series.Where(function(i){return"line"!==i.Type.toLowerCase()&&"bar"!==i.Type.toLowerCase()}).length,this.Options._Series={Line:{Count:0,CountPrepared:0},Bar:{Count:this.Options.Series.Where(function(i){return"bar"===i.Type}).length,CountPrepared:0},Pie:{Count:this.Options.Series.Where(function(i){return"bar"===i.Type}).length,CountPrepared:0},Ring:{Count:this.Options.Series.Where(function(i){return"ring"===i.Type}).length,CountPrepared:0}}}};
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Lure._Core.Chart.BChartContent=function(){function t(e){var i=this;_classCallCheck(this,t),this.ID=Lure.GetID(),this.Chart=e,this.Options=e.Options,this.Content=this.GetContent(),this.ChartName=Lure.Select(".chart-name",this.Content),this.HookChart=Lure.Select(".hook-chart",this.Content),this.ChartLegend=Lure.Select(".legend",this.Content),this.ChartSvg=Lure.Select(".chart-svg",this.Content),this.ChartTooltip=Lure.Select(".chart-tooltip",this.Content),this.GenContentProps(),e.Target.appendChild(this.Content),Lure.AddEventListenerGlobal("change",".legend-checkbox",this.OnLegendChange.bind(this),this.Content),this.Tooltip={},this.Options.Tooltip.Visible&&(this.HookChart.addEventListener("mousemove",this.OnChartMouseMove.bind(this)),this.HookChart.addEventListener("mouseenter",this.OnChartMouseEnter.bind(this)),this.HookChart.addEventListener("mouseleave",this.OnChartMouseLeave.bind(this)),this.Tooltip={Timer:null,Format:this.Options.Tooltip.Format,Hide:function(){Lure.AsyncToggle(null,null,i.ChartTooltip,function(){},function(){i.ChartTooltip.style.display="none"},"l-appear","l-disappear",200,i.Tooltip.Timer)},Show:function(){Lure.AsyncToggle(null,null,i.ChartTooltip,function(){i.ChartTooltip.style.display=""},function(){},"l-disappear","l-appear",200,i.Tooltip.Timer)},Reset:function(){i.Tooltip.Timer&&clearTimeout(i.Tooltip.Timer)},Close:function(){clearTimeout(i.Tooltip.Timer),i.Tooltip.Timer=setTimeout(function(){i.Tooltip.Hide(),i.Tooltip.Timer=null,i.Options.Tooltip.Episode=null},i.Options.Tooltip.Timeout)},Refresh:function(){if(i.Tooltip.TipPrev!==i.Tooltip.Tip){i.Options.Tooltip.TipPrev=i.Tooltip.Tip;var t=i.Tooltip.Tip;i.ChartTooltip.innerHTML=i.Tooltip.Format(t),t.Width=i.ChartTooltip.clientWidth,t.Height=i.ChartTooltip.clientHeight,t.Left=t.x-30,t.Top=t.y-20-t.Height,i.ChartTooltip.style.left=t.Left+"px",i.ChartTooltip.style.top=t.Top+"px",t.Left+t.Width>=t.SvgWidth?(i.ChartTooltip.classList.add("reverse"),t.Left=t.x+30-t.Width,i.ChartTooltip.style.left=t.Left+"px",i.ChartTooltip.style.top=t.Top+"px"):i.ChartTooltip.classList.remove("reverse"),i.Tooltip.Show()}}})}return _createClass(t,[{key:"GetEpisodeWidthRange",value:function(t,e){var i=t.AxisX.Data,n=Lure.GetType(t.AxisX.Data[0]),o=0,s=e;if("date"===n&&(i=i.Select(function(t){return t.valueOf()})),"auto"!==t.AxisX.Start&&("number"===n||"date"===n)){var a="date"!==n?t.AxisX.Start:t.AxisX.Start.valueOf(),l=i.indexOf(a);l>-1&&(o=e*l/t.AxisX.Data.length)}if("auto"!==t.AxisX.End&&("number"===n||"date"===n)){var r="date"!==n?t.AxisX.Start:t.AxisX.End.valueOf(),h=i.indexOf(r);h>-1&&(s=e*h/t.AxisX.Data.length)}var p=s-o;return{Start:o,EpisodeWidth:p}}},{key:"GetValuesY",value:function(t,e,i,n){var o=[],s=i.Values.Last(),a=i.Values.First();s=null===e?s:e.Values.Last(),a=null===e?a:e.Values.First();for(var l=0;l<t.Data.length;l++)o.push(n-(t.Data[l]-a)*n/(s-a));return o}},{key:"GetValuesX",value:function(t,e){if(t.Data.length<=1)return[0];var i=this.GetEpisodeWidthRange(t,e-2*this.Options._Series.Padding),n=i.EpisodeWidth,o=n/(t.Data.length-1);return t.Data.Select(function(t,e){return i.Start+e*o})}},{key:"GetPoints",value:function(t,e){for(var i=[],n=0;n<e.length;n++)i.push([t[n]+this.Options._Series.Padding,e[n]]);return i}},{key:"GetContent",value:function(){var t='<div class="legend"></div>';return Lure.CreateElementFromString('<div class="l-chart l-col">\n                        <table class="l-chart-t">\n                            <tr class="hook-top">\n                                <td colspan="5" class="td-hook-top">\n                                    <div class="chart-name"></div>\n                                    '+(this.Options.Legend.Visible&&"top"===this.Options.Legend.Position?t:"")+'\n                                </td>\n                            </tr>\n                            \n                            <tr class="tr-hook-mid">\n                                <td>'+(this.Options.Legend.Visible&&"left"===this.Options.Legend.Position?t:"")+'</td> \n                                <td rowspan="1">\n                                    <div class="hook-axis-y hook left"></div>\n                                </td>\n                                <td rowspan="1" class="hook-chart">\n                                    <div class="chart-svg-wrapper"><svg class="chart-svg"></svg></div>\n                                    <div class="chart-grid"></div>\n                                    <div class="chart-tooltip"></div>\n                                    <div class="v-stick"></div>\n                                </td> \n                                <td rowspan="1">\n                                    <div class="hook-axis-y hook right"></div>\n                                </td> \n                                <td>'+(this.Options.Legend.Visible&&"right"===this.Options.Legend.Position?t:"")+'</td>\n                            </tr>\n                            \n                            <tr class="tr-hook-axis-x">\n                                <td colspan="1" class="td-hook-null"></td> \n                                <td colspan="1" class="td-hook-null"></td> \n                                <td colspan="1" class="hook-axis-x">\n                                    <div class="axis-x"></div>\n                                </td> \n                                <td colspan="1" class="td-hook-null"></td>\n                                <td colspan="1" class="td-hook-null"></td>\n                            </tr>\n                            <tr class="tr-hook-bottom">\n                                '+(this.Options.Legend.Visible&&"bottom"===this.Options.Legend.Position?t:"")+"\n                            </tr>\n                        </table>\n                      </div>")}},{key:"GenContentProps",value:function(){}},{key:"MakeLegend",value:function(){}},{key:"OnLegendChange",value:function(t){var e=t.currentTarget.dataset.line,i=this.Options.Graph[e];return i.Visible=t.currentTarget.checked,this.Options.Graph.Where(function(t){return t.Visible}).length<1?(i.Visible=!0,void(t.currentTarget.checked=!0)):void this.Refresh()}},{key:"OnChartMouseMove",value:function(t){if("path"===t.target.tagName||"circle"===t.target.tagName){var e=t.target.dataset.line;this.Options.Tooltip.Episode=this.Options.Graph[e]}if(this.Options.Tooltip.Episode){var i=t.clientX-this.Options.Svg.Rect.left,n=this.GetTip(i);this.Tooltip.Tip=n,this.StickV.style.left=n.x+"px",this.Tooltip.Refresh()}}},{key:"OnChartMouseEnter",value:function(){this.Tooltip.Reset()}},{key:"OnChartMouseLeave",value:function(){this.Tooltip.Close()}}]),t}();
"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();Lure._Core.Chart.ChartContentGraph=function(t){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._FirstRedraw=!0,e.Tooltip.Format=e.Tooltip.Format?e.Tooltip.Format:Lure._Core.Chart.Intitializer.Default.R.Tooltip.FormatGraph,e}return _inherits(i,t),_createClass(i,[{key:"GenContentProps",value:function(){this.ChartGrid=Lure.Select(".chart-grid",this.Content),this.AxisX=Lure.Select(".axis-x",this.Content),this.AxisYLeft=Lure.Select(".hook-axis-y.left",this.Content),this.AxisYRight=Lure.Select(".hook-axis-y.right",this.Content),this.StickV=Lure.Select(".v-stick",this.Content)}},{key:"GetPathLine",value:function(t,i,e){for(var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=t.length,a=[],r=[],o=[],h=[],l=[],p=[],c=0;c<n;c++)a[c]=t[c][0],r[c]=t[c][1];for(var d=0;d<n-1;d++)o[d]=r[d+1]-r[d],h[d]=a[d+1]-a[d],l[d]=o[d]/h[d];p[0]=l[0],p[n-1]=l[n-2];for(var x=1;x<n-1;x++)0===l[x]||0===l[x-1]||l[x-1]>0!=l[x]>0?p[x]=0:(p[x]=3*(h[x-1]+h[x])/((2*h[x]+h[x-1])/l[x-1]+(h[x]+2*h[x-1])/l[x]),isFinite(p[x])||(p[x]=0));var u="M "+a[0]+","+r[0],g=this.Options.Animation.Line,O=this.Options.Animation.Marker;g=s.Animation===!1?"":g,O=s.Animation===!1?"":O;for(var v='<g class="chart-markers">',f=0;f<n-1;f++)u+=" C "+(a[f]+h[f]/3)+","+(r[f]+p[f]*h[f]/3)+" "+(a[f+1]-h[f]/3)+","+(r[f+1]-p[f+1]*h[f]/3)+" "+a[f+1]+","+r[f+1],i.Marker.Visible&&(v+='<circle class="chart-marker '+O+'" data-line="'+e+'" data-item="'+f+'" cx="'+a[f]+'" cy="'+r[f]+'" r="'+i.Marker.Radius+'" stroke="'+i.Color+'" stroke-width="2" fill="#fff" ></circle>');return i.Marker.Visible&&(v+='<circle class="chart-marker" data-line="'+e+'" data-item="'+(n-1)+'" cx="'+a[n-1]+'" cy="'+r[n-1]+'" r="'+i.Marker.Radius+'" stroke="'+i.Color+'" stroke-width="2" fill="#fff" ></circle>'),v+="</g>",'<g class="chart-episode"><path class="'+g+'" data-line="'+e+'" d="'+u+'" fill="none" stroke="'+i.Color+'" stroke-width="'+i.Width+'"></path> '+v+"</g>"}},{key:"GetPathLineMarker",value:function(t,i,e,s,n,a){return'<circle class="chart-marker" data-line="'+e+'" data-item="'+s+'" cx="'+t+'" cy="'+i+'" r="'+a+'" stroke="'+n+'" stroke-width="2" fill="#fff" ></circle>'}},{key:"GetPathBar",value:function(t,i,e){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=this.Options._Series.Bar.Count,a=this.Options._Series.Bar.CountPrepared,r=1;this.Options.SeriesOptions.BarStack||(r=.8*n);var o=this.HookChart.clientWidth/this.Options.AxisX.Data.length/2/r,h=this.HookChart.clientHeight,l=1.2*o*a-(1.2*o*n/2-1.2*o/2);this.Options.SeriesOptions.BarStack&&(l=0);var p=this.Options.Animation.Bar;p=s.Animation===!1?"":p;var c='<g class="chart-episode" data-type="bar" data-line="'+e+'">',d="";this.Options.SeriesOptions.BarGradient&&(d="lc-gradient-"+Lure.GetID(),c+='<linearGradient id="'+d+'"  x1="0" y1="0%"><stop offset="0%" stop-color="rgba(0,0,0,0.2)"/><stop offset="33%" stop-color="rgba(255,255,255,0.2)"/><stop offset="100%" stop-color="rgba(0,0,0,0.3)"/></linearGradient>');for(var x="",u=0;u<t.length;u++){var g=Lure.GetID();c+='<g class="lc-bar-elem"><rect class="chart-bar-elem '+p+'" id="chart-b-'+g+'" x="'+(l+t[u][0]-o/2)+'" y="'+t[u][1]+'" width="'+o+'" height="'+(h-t[u][1])+'" fill="'+i.Color+'" data-line="'+e+'" data-item="'+u+'"></rect>',this.Options.SeriesOptions.BarGradient&&(c+='<rect class="lc-bar-elem-gradient '+p+'" id="chart-bg-'+g+'" x="'+(l+t[u][0]-o/2)+'" y="'+t[u][1]+'" width="'+o+'" height="'+(h-t[u][1])+'" fill="url(#'+d+')" data-line="'+e+'" data-item="'+u+'"></rect>'),c+="</g>"}return c+=x+"</g>",this.Options._Series.Bar.CountPrepared++,c}},{key:"GetPath",value:function(t){switch(t){case"line":return this.GetPathLine.bind(this);case"bar":return this.GetPathBar.bind(this);default:return this.GetPathLine.bind(this)}}},{key:"GetSeries",value:function(){this.Options.Graph=this.Options.Series.Where(function(t){return Lure._Core.Chart.Intitializer.isGraph(t.Type)})}},{key:"ChartSvgInit",value:function(){this.ChartSvg.style.height="1px",this.Options.Svg.Height=this.HookChart.clientHeight,this.ChartSvg.style.height=this.Options.Svg.Height+"px",this.Options._Series.Padding=0,this.Options._Series.Bar.Count=this.Options.Series.Where(function(t){return"bar"===t.Type}).length,this.Options._Series.Bar.Count>0&&(this.Options._Series.Bar.Delimit=1,this.Options.SeriesOptions.BarStack||(this.Options._Series.Bar.Delimit=.8*this.Options._Series.Bar.Count),this.Options._Series.Bar.Width=this.HookChart.clientWidth/this.Options.AxisX.Data.length/2/this.Options._Series.Bar.Delimit,1===this.Options._Series.Bar.Count?this.Options._Series.Padding=this.Options._Series.Bar.Width/2:this.Options._Series.Padding=1.2*this.Options._Series.Bar.Width/2*this.Options._Series.Bar.Count),this.AxisX.style.paddingLeft=this.Options._Series.Padding+"px",this.AxisX.style.paddingRight=this.Options._Series.Padding+"px",this.Options.Svg.Rect=this.HookChart.getBoundingClientRect(),this.ChartGrid.classList.remove("no-right"),""!==this.Options.AxisY.HtmlRight&&this.ChartGrid.classList.add("no-right"),""===this.Options.Name?this.ChartName.style.display="none":this.ChartName.style.display=""}},{key:"MakeLegend",value:function(){if(this.Options.Legend.Visible){this.Options.Legend.Html="";for(var t=0;t<this.Options.Graph.length;t++){var i=this.Options.Graph[t],e=i.Name,s=i.Data[t],n=i.Color,a=e;null!==i.Format&&(a=i.Format.call(Chart,e,s,i,t));var r=this.Options.Series[t].Visible?'checked="checked"':"";this.Options.Legend.Html+='<div class="legend-item">\n                <input class="legend-checkbox" type="checkbox" '+r+' id="legend-ch-'+this.ID+"-"+t+'" data-line="'+t+'" data-name="'+e+'">\n                <label class="legend-label" for="legend-ch-'+this.ID+"-"+t+'">\n                    <div class="legend-icon" style="background-color: '+n+'"></div>\n                    <div>'+a+"</div>\n                </label>\n              </div>"}this.Options.Legend.Html='<div class="legend-box">'+this.Options.Legend.Html+"</div>"}}},{key:"MakeAxisX",value:function(){var t=this,i=this.Options.AxisX.Data,e=(i.length,""),s="",n="",a="";if(this.Options.AxisX.Linear){for(var r=0;r<i.length;r++)if(r%this.Options.AxisX.Skip===0||null===this.Options.AxisX.Skip){var o=null!==this.Options.AxisX.Format?this.Options.AxisX.Format.call(this,i[r]):i[r],h=-Lure.GetTextWidth(o)/2;e+='<div class="axis-x-label '+(o.toString().length>0?"":"label-empty")+'"><span class="axis-x-label-text" style="left: '+h+'px">'+o+"</span></div>",n+=" "+o,a=a.length<o.length?o:a,r>0&&(s+='<div class="chart-grid-cell"></div>')}}else{var l=0,p=0,c=[],d=i.Where(function(i,e){var s=!t.Options.AxisX.Skip.call(t.Chart,i)||!e%t.Options.AxisX.Skip===0||null===t.Options.AxisX.Skip;return s?(l>0&&(c.push(l),p+=l),l=1):l++,s}),x=d.length;c.push(l-1);for(var u=0;u<d.length;u++){var g=null!==this.Options.AxisX.Format?this.Options.AxisX.Format.call(this.Chart,d[u]):d[u],O=1*c[u]/x;e+='<div class="axis-x-label no-linear '+(g.toString().length>0?"":"label-empty")+'" style="flex: '+O+'"><span class="axis-x-label-text">'+g+"</span></div>",s+='<div class="chart-grid-cell" style="flex: '+O+'"></div>'}}this.AxisX.style.setProperty("--axis-x-label-rotation","0deg"),this.AxisX.style.setProperty("--axis-x-label-translateX","0px"),this.AxisX.style.setProperty("--axis-x-label-translateY","0px"),this.AxisX.style.setProperty("--axis-x-label-height","auto");var v=window.getComputedStyle(this.AxisX),f=1.05*Lure.GetTextWidth(n,v.fontFamily,v.fontSize);if(this.Options.AxisX.Visible&&this.AxisX.clientWidth<f){var S=(f-this.AxisX.clientWidth)/i.length,A=Lure.GetTextWidth(a,v.fontFamily,v.fontSize),y=10*(Math.PI/2+Math.atan(1-A/S))/9,M=180*y/Math.PI;M=M>90?90:M,y=y>Math.PI/2?Math.PI/2:y;var m=parseInt(v.height);0===m&&(m=27);var k=Math.sin(y)*A,C=S/2,b=k;this.AxisX.style.setProperty("--axis-x-label-rotation","-"+M+"deg"),this.AxisX.style.setProperty("--axis-x-label-translateY",k+"px"),this.AxisX.style.setProperty("--axis-x-label-translateX",C+"px"),this.AxisX.style.setProperty("--axis-x-label-height",b+"px")}this.Options.AxisX.Html=e,this.Options.Grid.HtmlLine=s}},{key:"MakeAxisY",value:function(){var t=0;if(this.Options.AxisY.Visible||(this.Options.AxisY.Html="",t=1,!(this.Options.Graph.Where(function(t){return t.AxisY}).length<1))){var i=this.GetScaleY(this.HookChart.clientHeight),e="",s="";for(this.Options.AxisY.HtmlLeft="",this.Options.AxisY.HtmlRight="",t;t<i.length;t++){for(var n=i[t],a='<div class="y axis-y-caption">\n    <div class="axis-y-caption-value">'+(t>0?this.Options.Graph[n.SIndex].Title:this.Options.Title)+"</div>\n</div>",r="",o=0;o<n.Values.length;o++)r+='<div class="axis-y-label"><span class="axis-y-label-text">'+n.Values[o]+"</span></div>";var h='<div class="axis-y" '+(t>0?'style="color: '+this.Options.Graph[n.SIndex].Color+'; font-weight: bold;"':"")+' data-line="'+t+'">\n    '+a+'\n    <div class="axis-y-labels">'+r+"</div>\n</div>";n.SIndex<0&&"left"===this.Options.AxisY.Position?e+=h:n.SIndex<0&&"right"===this.Options.AxisY.Position?s+=h:n.SIndex>-1&&"right"!==this.Options.Graph[n.SIndex].AxisY.Position?e+=h:n.SIndex>-1&&"right"===this.Options.Graph[n.SIndex].AxisY.Position&&(s+=h)}this.Options.AxisY.HtmlLeft=e,this.Options.AxisY.HtmlRight=s}}},{key:"GetScaleY",value:function(t){for(var i=this.Options.Graph,e={Min:"auto"!==this.Options.AxisY.Min?this.Options.AxisY.Min:Number.MAX_VALUE,Max:"auto"!==this.Options.AxisY.Max?this.Options.AxisY.Max:-Number.MAX_VALUE,Step:"auto"!==this.Options.AxisY.Step?this.Options.AxisY.Step:"auto",_Min:this.Options.AxisY.Min,_Max:this.Options.AxisY.Max,_Step:this.Options.AxisY.Step,SIndex:-1},s=[e],n=0;n<i.length;n++){var a=i[n];if(a.Visible){var r=i[n].Data,o={Min:r[0],Max:r[0],Step:"auto",SIndex:-1};a.AxisY.Visible&&(o.SIndex=n,o.Min="auto"!==a.AxisY.Min?a.AxisY.Min:o.Min,o.Max="auto"!==a.AxisY.Max?a.AxisY.Max:o.Max,o.Step="auto"!==a.AxisY.Step?a.AxisY.Step:o.Step,o._Min=a.AxisY.Min,o._Max=a.AxisY.Max,o._Step=a.AxisY.Step,s.push(o));for(var h=0;h<r.length;h++){var l=r[h];"auto"===e._Min&&l<e.Min&&(e.Min=l),"auto"===e._Max&&l>e.Max&&(e.Max=l),a.AxisY&&"auto"===a.AxisY.Min&&l<o.Min&&(o.Min=l),a.AxisY&&"auto"===a.AxisY.Max&&l>o.Max&&(o.Max=l)}}}for(var p=20,c=0;c<s.length;c++){var d=s[c],x=d.Step,u=Lure.GetNumberOrder(d.Max);if("auto"===x){var g=d.Max-d.Min,O=5*Math.pow(10,u-2);x=Lure.RoundBy(g*p/t,O)}if("auto"===d._Min&&u>-1&&d.Min%5>0){var v=Lure.GetNumberOrder(d.Max),f=v<0?-v:0;d.Min=Lure.RoundBy(d.Min,x)-x,d.Min=parseFloat(d.Min.toFixed(2+f).replace(".00"+"0".repeat(f),""))}var S=u<0?-u:0,A=[],y=d.Min,M=0;for(d.Min===d.Max&&(x=1);0!==x&&(y<=d.Max&&"auto"===d._Max||y<d.Max&&"auto"!==d._Max)&&M<1e4;)M++,A.push(y),y+=x,y=parseFloat(y.toFixed(2+S).replace(".00"+"0".repeat(S),""));M>=1e3&&console.warn("Chart.GetScaleYError",this),A.push(y),d.Values=A}return this.Options.Scales=s,s}},{key:"MakeGrid",value:function(){if(this.Options.Grid.Html="",this.Options.Grid.Visible){this.Options._Series.Padding>0&&(this.Options.Grid.HtmlLine='<div class="chart-grid-cell" style="min-width: '+this.Options._Series.Padding+'px; flex: 0;"></div>'+this.Options.Grid.HtmlLine,this.Options.Grid.HtmlLine+='<div class="chart-grid-cell" style="min-width: '+this.Options._Series.Padding+'px; flex: 0;"></div>');for(var t=this.Options.Scales[0].Values.length-1,i="",e=0;e<t;e++)i+='<div class="chart-grid-line" >'+this.Options.Grid.HtmlLine+"</div>";this.Options.Grid.Html=i,this.ChartGrid.innerHTML=this.Options.Grid.Html}}},{key:"MakeSvg",value:function(t){var i=this;this.Options.Svg.Html="",this.Options.Svg.Width=this.HookChart.clientWidth,this.Options._Series.Line.CountPrepared=0,this.Options._Series.Bar.CountPrepared=0,this.Options._Series.Pie.CountPrepared=0;for(var e=function(e){var s=i.Options.Graph[e];if(!s.Visible)return"continue";s.Prepared={};var n=i.Options.Scales.Where(function(t){return t.SIndex===e}).FirstOrDefault(),a=i.GetValuesY(s,n,i.Options.Scales[0],i.Options.Svg.Height),r=i.GetValuesX(s,i.Options.Svg.Width);s.Points=i.GetPoints(r,a),i.Options.Svg.Html+=i.GetPath(s.Type)(s.Points,s,e,t)},s=0;s<this.Options.Graph.length;s++){e(s)}this.ChartSvg.innerHTML=this.Options.Svg.Html}},{key:"GetTip",value:function(t){var i=this.Options.Tooltip.Episode,e=i.Points,s=Math.round(t/e.Last()[0]*(e.length-1));s>e.length-1&&(s=e.length-1),s<1&&(s=0);var n=this.Options.Tooltip.TipPrev,a={Name:i.Name,Color:i.Color,ValueX:i.AxisX.Data[s],ValueY:i.Data[s],Value:i.Data[s],Episode:i,x:e[s][0],y:e[s][1],SvgWidth:this.HookChart.clientWidth,SvgHeight:this.HookChart.clientHeight};return n&&n.x===a.x&&n.y===a.y?n:a}},{key:"FillLegend",value:function(){this.Options.Legend.Visible&&(this.ChartLegend.innerHTML=this.Options.Legend.Html)}},{key:"FillAxisX",value:function(){this.Options.AxisX.Visible&&(this.AxisX.innerHTML=this.Options.AxisX.Html)}},{key:"FillAxisY",value:function(){this.Options.AxisY.Visible&&(this.AxisYLeft.innerHTML=this.Options.AxisY.HtmlLeft,this.AxisYRight.innerHTML=this.Options.AxisY.HtmlRight)}},{key:"Fill",value:function(){this.ChartName.innerHTML=this.Options.Name,this.FillLegend(),this.FillAxisX(),this.FillAxisY()}},{key:"Refresh",value:function(t){this.MakeAxisX(),this.MakeAxisY(),this.MakeGrid(),this.AxisYLeft.innerHTML=this.Options.AxisY.HtmlLeft,this.AxisYRight.innerHTML=this.Options.AxisY.HtmlRight,this.MakeSvg(t)}},{key:"Redraw",value:function(t){this.GetSeries(),this.MakeLegend(),this.MakeAxisX(),this.MakeAxisY(),"right"!==this.Options.Legend.Position&&"left"!==this.Options.Legend.Position||this.FillLegend(),this.FillAxisY(),this.MakeAxisX(),this.Fill(),this.ChartSvgInit(),this.MakeSvg(t),this.MakeGrid()}},{key:"OnLegendChange",value:function(t){var i=t.currentTarget.dataset.line,e=this.Options.Graph[i];return e.Visible=t.currentTarget.checked,this.Options.Graph.Where(function(t){return t.Visible}).length<1?(e.Visible=!0,void(t.currentTarget.checked=!0)):void this.Refresh({Animation:!1})}},{key:"OnChartMouseMove",value:function(t){if("rect"===t.target.tagName||"path"===t.target.tagName||"circle"===t.target.tagName){var i=t.target.dataset.line;this.Options.Tooltip.Episode=this.Options.Graph[i]}if(this.Options.Tooltip.Episode){this.Options.Svg.Rect=this.HookChart.getBoundingClientRect();var e=t.clientX-this.Options.Svg.Rect.left,s=this.GetTip(e);this.Tooltip.Tip=s,this.StickV.style.left=s.x+"px",this.Tooltip.Refresh()}}}]),i}(Lure._Core.Chart.BChartContent);
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();Lure._Core.Chart.ChartContentDraw=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Tooltip.Format=i.Tooltip.Format?i.Tooltip.Format:Lure._Core.Chart.Intitializer.Default.R.Tooltip.FormatDraws,i}return _inherits(e,t),_createClass(e,[{key:"PolarToCartesius",value:function(t,e,i,s){var n=(s-0)*Math.PI/180;return{x:t+i*Math.cos(n),y:e+i*Math.sin(n)}}},{key:"GetPathPie",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",i=this.HookChart.clientWidth,s=this.HookChart.clientHeight;"right"===this.Options.Legend.Position||"left"===this.Options.Legend.Position;var n=s<i?s:i;n-=2;var o=-1,a=-1,r=this.Options.Animation.Pie;r=t.Animation===!1?"":r;for(var l=Lure.GetDurationAnimation(r),h=0;h<this.Options.Draws.length;h++)if(this.Options.Draws[h].Visible){var p=this.Options.Draws[h],c=0,d=p.AngleStart,u=n/2*(this.Options.Draws.length-h)/this.Options.Draws.length,g=2*u;"pie"===p.Type&&h>0&&(u=o-a-p.Margin/2-.2,u<0&&(u=o-h/this.Options.Draws.length*o)),"ring"===p.Type&&(g=p.Width,h>0&&(u=o-(a-.2)-p.Margin)),o=u,a="pie"===p.Type?p.Width:g;var v=[],f=0;p.Sum=0;for(var y=0;y<p.Data.length;y++)p.Sum+=p.Data[y],p.Visibles[y]?(f++,v.push(p.Data[y]),c+=p.Data[y]):v.push(null);f<1&&(v=p.Data.Select(function(){return 1})),f=v.length;for(var C=p.Visibles.Where(function(t){return t}).length,O=0;O<v.length;O++)if(null!==v[O]){var k=v[O]/c*360;0===c&&(k=360/C),360===k&&(k=359.99,d=0);var b="";r&&(b="opacity: 0;transform: scale(0.01,0.01) ;  animation-delay: "+O*l/f/2+"ms"),e+="<g>","pie"!==p.Type&&(e+='<path class="'+r+'" style="'+b+'" d="'+this.GetRing(i/2,s/2,u,d,d+k,g)+'" fill="'+p.Colors[O]+'" stroke="noe" stroke-width="0" fill-opacity="1" data-type="'+p.Type+'" data-line="'+h+'" data-sector="'+O+'"></path>',this.Options.Tooltip.Visible&&(e+='<path class="chart-hover '+r+'" style="'+b+'" data-type="pie" data-line="'+h+'" data-item="'+O+'" d="'+this.GetRing(i/2,s/2,u,d,d+k,g)+'" fill="#fff" stroke="none" stroke-width="0" fill-opacity="0" data-line="'+h+'" data-sector="'+O+'"></path>')),"pie"===p.Type&&(e+='<path class="'+r+'" style="'+b+'" d="'+this.GetSector(i/2,s/2,u,d,d+k)+'" fill="'+p.Colors[O]+'" stroke="none" data-type="'+p.Type+'" data-line="'+h+'" data-sector="'+O+'"></path>',this.Options.Tooltip.Visible&&(e+='<path class="chart-hover '+r+'" style="'+b+'" data-type="pie" data-line="'+h+'" data-item="'+O+'" d="'+this.GetSector(i/2,s/2,u,d,d+k)+'" fill="#fff" stroke="none"  stroke-width="0" fill-opacity="0" data-line="'+h+'" data-sector="'+O+'"></path>')),e+="</g>",d+=k}}return e}},{key:"GetArc",value:function(t,e,i,s,n){var o=this.PolarToCartesius(t,e,i,n),a=this.PolarToCartesius(t,e,i,s),r=n-s<=180?"0":"1";return"M "+o.x+" "+o.y+" A "+i+" "+i+" 0 "+r+" 0 "+a.x+" "+a.y}},{key:"GetSector",value:function(t,e,i,s,n){var o=this.PolarToCartesius(t,e,i,n),a=this.PolarToCartesius(t,e,i,s),r=n-s<=180?"0":"1";return["M",o.x,o.y,"A",i,i,0,r,0,a.x,a.y,"L",t,e,"Z"].join(" ")}},{key:"GetRing",value:function(t,e,i,s,n,o){var a=this.PolarToCartesius(t,e,i,n),r=this.PolarToCartesius(t,e,i,s),l=this.PolarToCartesius(t,e,i-o,n),h=this.PolarToCartesius(t,e,i-o,s),p=n-s<=180?"0":"1";return["M",a.x,a.y,"A",i,i,0,p,0,r.x,r.y,"L",h.x,h.y,"M",h.x,h.y,"A",i-o,i-o,0,p,1,l.x,l.y,"L",a.x,a.y].join(" ")}},{key:"GetContent",value:function(){var t='<div class="legend"></div>';return Lure.CreateElementFromString('<div class="l-chart l-col">\n                        <table class="l-chart-t">\n                            <tr class="tr-hook-top">\n                                <td colspan="5" class="hook-top">\n                                    <div class="chart-name"></div>\n                                    '+(this.Options.Legend.Visible&&"top"===this.Options.Legend.Position?t:"")+'\n                                </td>\n                            </tr>\n                            \n                            <tr class="tr-hook-mid">\n                                <td>'+(this.Options.Legend.Visible&&"left"===this.Options.Legend.Position?t:"")+'</td> \n                                <td rowspan="1">\n                                    <div class="hook-axis-y hook left"></div>\n                                </td>\n                                <td rowspan="1" class="hook-chart">\n                                    <div class="chart-svg-wrapper"><svg class="chart-svg"></svg></div>\n                                    <div class="chart-tooltip"></div>\n                                </td> \n                                <td rowspan="1">\n                                    <div class="hook-axis-y hook right"></div>\n                                </td> \n                                <td>'+(this.Options.Legend.Visible&&"right"===this.Options.Legend.Position?t:"")+'</td>\n                            </tr>\n                            \n                            <tr class="tr-hook-bottom">\n                                '+(this.Options.Legend.Visible&&"bottom"===this.Options.Legend.Position?t:"")+"\n                            </tr>\n                        </table>\n                      </div>")}},{key:"GenContentProps",value:function(){}},{key:"GetSeries",value:function(){this.Options.Draws=this.Options.Series.Where(function(t){return Lure._Core.Chart.Intitializer.isDraw(t.Type)})}},{key:"ChartSvgInit",value:function(){this.Options.Svg.Rect=this.HookChart.getBoundingClientRect(),""===this.Options.Name?this.ChartName.style.display="none":this.ChartName.style.display=""}},{key:"MakeLegend",value:function(){if(this.Options.Legend.Visible){this.Options.Legend.Html="";for(var t=0;t<this.Options.Draws.length;t++){for(var e=this.Options.Draws[t],i="",s=0;s<e.Labels.Data.length;s++){var n=e.Labels.Data[s],o=e.Data[s],a=n;null!==e.Labels.Format&&(a=e.Labels.Format.call(Chart,n,o,e,s));var r=e.Colors[s]?e.Colors[s]:"#"+Lure.GetRandom(1e5,999999),l=this.Options.Series[t].Visibles[s]?'checked="checked"':"";i+='<div class="legend-item">\n                                  <input class="legend-checkbox" type="checkbox" '+l+' id="legend-ch-'+this.ID+"-"+t+"-"+s+'" data-line="'+t+'" data-sector="'+s+'">\n                                  <label class="legend-label" for="legend-ch-'+this.ID+"-"+t+"-"+s+'">\n                                     <div class="legend-icon" style="background-color: '+r+'"></div>\n                                     <div>'+a+"</div>\n                                  </label>\n                                </div>"}this.Options.Legend.Html+='<div class="legend-box">'+i+"</div>"}}}},{key:"MakeSvg",value:function(t){this.Options._Series.Pie.CountPrepared=0,this.Options.Svg.Html=this.GetPathPie(t),this.ChartSvg.innerHTML=this.Options.Svg.Html}},{key:"Fill",value:function(){this.ChartName.innerHTML=this.Options.Name,this.Options.Legend.Visible&&(this.ChartLegend.innerHTML=this.Options.Legend.Html)}},{key:"Refresh",value:function(t){this.MakeSvg(t)}},{key:"Redraw",value:function(t){this.GetSeries(),this.MakeLegend(),this.Fill(),this.ChartSvgInit(),this.MakeSvg(t)}},{key:"OnLegendChange",value:function(t){var e=t.currentTarget.dataset.line,i=t.currentTarget.dataset.sector,s=this.Options.Draws[e];return s.Visibles[i]=t.currentTarget.checked,s.Visibles.Where(function(t){return t}).length<1?(s.Visibles[i]=!0,void(t.currentTarget.checked=!0)):void this.Refresh({Animation:!1})}},{key:"OnChartMouseMove",value:function(t){if("path"!==t.target.tagName.toLowerCase())return!1;var e=t.target.dataset.line,i=t.target.dataset.sector;if(this.Options.Tooltip.Episode=this.Options.Draws[e],this.Options.Svg.Rect=this.HookChart.getBoundingClientRect(),this.Options.Tooltip.Episode){var s=t.clientX-this.Options.Svg.Rect.left,n=t.clientY-this.Options.Svg.Rect.top;this.Tooltip.Tip={Name:this.Options.Tooltip.Episode.Labels.Data[i],Label:this.Options.Tooltip.Episode.Labels.Data[i],Color:this.Options.Tooltip.Episode.Colors[i],ValueX:this.Options.Tooltip.Episode.Labels.Data[i],ValueY:this.Options.Tooltip.Episode.Data[i],Value:this.Options.Tooltip.Episode.Data[i],Episode:this.Options.Tooltip.Episode,x:s,y:n,SvgWidth:this.HookChart.clientWidth,SvgHeight:this.HookChart.clientHeight},this.Tooltip.Refresh()}}}]),e}(Lure._Core.Chart.BChartContent);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Lure.Chart=function(){function e(t){var n=this;_classCallCheck(this,e),this._t=window.performance.now(),t.Disabled||(this._locked=!1,this.Target=Lure.Select(t.Target),Lure._Core.Chart.Intitializer.InitR.call(this,t),this.isGraph?this._ContentManager=new Lure._Core.Chart.ChartContentGraph(this):this._ContentManager=new Lure._Core.Chart.ChartContentDraw(this),t.Responsible&&setTimeout(function(){n.Listener=new Lure.Listener({Target:n._ContentManager.Content,Freq:20,Delay:20,OnEvent:function(){n.Listener.Height>0&&!n._locked&&n.Redraw({Animation:!1})}}),n.Listener.Run()}),t.DrawAfterInit&&this.Redraw())}return _createClass(e,[{key:"Redraw",value:function(e){var t=this;this._ContentManager.Content.clientHeight&&(this._locked=!0,this._ContentManager.Redraw(e),setTimeout(function(){t._locked=!1}))}},{key:"Refresh",value:function(e){var t=this;return this._ContentManager.Options.Graph||this._ContentManager.Options.Draws?(this._locked=!0,this._ContentManager.Refresh(e),void setTimeout(function(){t._locked=!1})):this._ContentManager.Redraw(e)}},{key:"SerieSwitch",value:function(e,t){this.Options.Series[e].Visibles[t]=!this.Options.Series[e].Visibles[t];var n=document.getElementById("legend-ch-"+this._ContentManager.ID+"-"+t);null!==n&&(n.checked=this.Options.Series[e].Visibles[t]),this.Refresh({Animation:!1})}},{key:"Series",get:function(){return this.Options.Series},set:function(e){this.Options.Series=e,Lure._Core.Chart.Intitializer.GetSeries(this.Options)}}]),e}();